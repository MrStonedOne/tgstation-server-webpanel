{"version":3,"file":"926.012ec3a2613071a39de8.bundle.js","mappings":"iOAMe,MAAMA,UAAkBC,EAAAA,UAC5BC,SACH,OACI,gBAAC,IAAD,CAAMC,UAAU,iBAAiBC,OAAO,QACpC,gBAAC,WAAD,CAAaD,UAAU,sCACnB,gBAAC,IAAD,CAAkBE,GAAG,iBAEzB,gBAAC,SAAD,KACI,gBAAC,UAAD,KACI,gBAAC,IAAD,CAAkBA,GAAG,qBACrB,qBAAGC,KAAK,8EAAR,+EAIJ,gBAAC,SAAD,CAAWC,GAAI,MAAOJ,UAAU,4BAC5B,4BACM,YAAWK,EAAAA,sBAA2BC,EAAAA,sBAAwBC,OAAOC,SAASC,oB,odCY5G,MAAMC,EAAwB,CAACC,EAAkBC,KAE7C,MAAMC,EAAaN,OAAOO,UAE1B,GAAID,GAAcA,EAAWE,iBAGzBF,EAAWE,iBAAiBH,EAAUD,OACnC,CAEH,MAAMK,EAAIC,SAASC,cAAc,KACjCD,SAASE,KAAKC,YAAYJ,GAC1B,MAAMK,EAAUC,IAAIC,gBAAgBX,GACpCI,EAAEb,KAAOkB,EAETL,EAAEQ,SAAWb,EACbK,EAAES,QACFH,IAAII,gBAAgBV,EAAEb,MACtBa,EAAEW,WAUV,MAAMC,EAOKC,YAAYC,EAAyCC,GAAwB,KAN7EA,YAM6E,OAL7EC,cAK6E,OAJ7EF,kBAI6E,OAH7EG,gBAG6E,OAF7EC,aAAc,EAGjBC,KAAKL,aAAeA,EACpBK,KAAKJ,OAASA,GAAU,KACnBD,EAAaM,cAAaD,KAAKD,aAAc,GAClDC,KAAKH,SAAW,IAcxB,MAAMK,UAAcvC,EAAAA,UAGT+B,YAAYS,GACfC,MAAMD,GAENH,KAAKK,MAAQ,CACTC,OAAQ,GACRC,cAAe,KACfC,SAAS,EACTC,aAAc,KACdC,mBAAoB,MAGxBV,KAAKW,aAAeX,KAAKW,aAAaC,KAAKZ,MAC3CA,KAAKa,WAAab,KAAKa,WAAWD,KAAKZ,MACvCA,KAAKc,iBAAmBd,KAAKc,iBAAiBF,KAAKZ,MACnDA,KAAKe,WAAaf,KAAKe,WAAWH,KAAKZ,MACvCA,KAAKgB,cAAgBhB,KAAKgB,cAAcJ,KAAKZ,MAC7CA,KAAKiB,eAAiBjB,KAAKiB,eAAeL,KAAKZ,MAG3CkB,SAASC,GACbnB,KAAKoB,UAASC,IACV,MAAMf,EAASgB,MAAMC,KAAKF,EAAUf,QAEpC,OADAA,EAAOkB,KAAKL,GACL,CACHb,OAAAA,MAKkB,gCACpBN,KAAKyB,cAGU,oBACrB,IAAIC,EAAAA,EAAAA,IAAc1B,KAAK2B,QAAQC,sBAAuBC,EAAAA,GAAAA,MAA2B,CAC7E7B,KAAKoB,SAAS,CACVZ,SAAS,IAEb,MAKMD,EAAgB,IAAId,EALL,CACjBqC,KAAM,IACN7B,aAAa,EACb8B,WAAY,WAGV/B,KAAKgB,cAAcT,GAEzBP,KAAKoB,SAAS,CACVb,cAAeA,EACfC,SAAS,SAGbR,KAAKoB,SAAS,CACVZ,SAAS,IAKS,uBAACwB,GAC3B,MAAMC,EAAgBD,IAGtB,IAAIE,GAAc,EAClB,MAAMC,EAAiB,IAAIC,SAAQC,GAAKC,WAAWD,EAAG,OAAME,MAAK,KAC7DL,GAAc,WAGZE,QAAQI,KAAK,CAACP,EAAeE,IAE/BD,GACAlC,KAAKoB,SAAS,CACVZ,SAAS,UAGPyB,EAENjC,KAAKoB,SAAS,CACVZ,SAAS,KAEVR,KAAKyC,cAGa,sBAACC,GAC1B,MAAMC,QAAiBC,EAAAA,EAAAA,gBAAwC5C,KAAK2B,QAAQkB,SAAS9E,GAAI,CACrF+D,KAAMY,EAAI/C,aAAamC,OAG3B,GAAIa,EAASG,OAASC,EAAAA,EAAAA,IAClB,GAAkB,MAAdL,EAAI9C,OAAgB,CACpB,MAAMoD,EAAcN,EAAI9C,OAAOC,SAASoD,QAAQP,GAChDA,EAAI9C,OAAOC,SAASqD,OAAOF,EAAa,GACxChD,KAAKyC,oBAGTzC,KAAKkB,SAASyB,EAASxB,OAIJ,oBAACgC,GACxB,IAAIzB,EAAAA,EAAAA,IAAc1B,KAAK2B,QAAQC,sBAAuBC,EAAAA,GAAAA,MAA2B,CAC7E7B,KAAKiB,eAAekC,GAEpB,MAAMrB,EACiC,OAAnCqB,EAAUxD,aAAamC,KAAK,IAAkD,MAAnCqB,EAAUxD,aAAamC,KAAK,GACjEqB,EAAUxD,aAAamC,KAAKsB,MAAM,GAClCD,EAAUxD,aAAamC,KACjC,IAAIuB,EAAW,EACf,IAAK,IAAIC,EAAO,EAAGA,GAAQD,IAAYC,EAAM,CACzC,MAAMX,QAAiBC,EAAAA,EAAAA,aACnB5C,KAAK2B,QAAQkB,SAAS9E,GACtB+D,EACA,CACIwB,KAAAA,IAGR,GAAIX,EAASG,OAASC,EAAAA,EAAAA,GASf,CACH/C,KAAKkB,SAASyB,EAASxB,OACvB,MAXiC,CACjCkC,EAAWV,EAASY,QAAQC,WACxBH,GAAYC,IAAMH,EAAUpD,aAAc,GAC9C,MAAM0D,EAAcd,EAASY,QAAQG,QAAQC,KACzCC,GAAK,IAAInE,EAAcmE,EAAGT,KAE9B,IAAK,MAAMS,KAAKH,EACZN,EAAUtD,SAAS2B,KAAKoC,MAUpB,iBAACC,GACrB,GAAI7D,KAAKK,MAAMI,eAAiBoD,EAI5B,YAHA7D,KAAKoB,SAAS,CACVX,aAAc,OAKtB,IAAIqD,EAAeD,EAAKlE,aAAamC,KACrC,KAAOgC,EAAaC,WAAW,MAAMD,EAAeA,EAAaE,UAAU,GAE3E,IAAKH,EAAKlE,aAAaM,YAAa,CAChC,MAAM0C,QAAiBC,EAAAA,EAAAA,cACnB5C,KAAK2B,QAAQkB,SAAS9E,GACtB+F,GACA,GAGYnB,EAASG,OAASC,EAAAA,EAAAA,GAE9Bc,EAAKlE,aAAegD,EAASY,SAE7BvD,KAAKkB,SAASyB,EAASxB,OACvB0C,EAAKlE,aAAasE,aAAe,MAIzCjE,KAAKoB,SAAS,CACVX,aAAcoD,EACdnD,mBAAoB,OAIJ,mBACpB,MAAMD,EAAeT,KAAKK,MAAMI,aAC1BkC,QAAiBC,EAAAA,EAAAA,gBACnB5C,KAAK2B,QAAQkB,SAAS9E,GACtB,CACI+D,KAAMrB,EAAad,aAAamC,KAChCmC,aAAcxD,EAAad,aAAasE,cAE5C,IAAIC,YAGR,GAAIvB,EAASG,OAASC,EAAAA,EAAAA,GAAe,CACjC,MAAMoB,EAAkB1D,EAAab,OAC/BoD,EAAcmB,EAAgBtE,SAASoD,QAAQxC,GACrD0D,EAAgBtE,SAASqD,OAAOF,EAAa,GAC7ChD,KAAKoB,SAAS,CACVX,aAAc,YAEfT,KAAKkB,SAASyB,EAASxB,OAGH,wBAACgC,GAC5B,IACKiB,QACGpE,KAAKG,MAAMkE,KAAKC,cACZ,CAAEvG,GAAI,mCACN,CAAE+D,KAAMqB,EAAUxD,aAAamC,QAIvC,OAEJ9B,KAAKoB,SAAS,CACVZ,SAAS,IAGb,MAAM+D,EAAqBC,MAAAA,IAGvB,IAAI3E,EAAwC,GACxCwD,EAAW,EAEf,MAAMvB,EAAuB,OAAhBY,EAAIZ,KAAK,IAA+B,MAAhBY,EAAIZ,KAAK,GAAaY,EAAIZ,KAAKsB,MAAM,GAAKV,EAAIZ,KACnF,IAAK,IAAIwB,EAAO,EAAGA,GAAQD,IAAYC,EAAM,CACzC,MAAMmB,QAA0B7B,EAAAA,EAAAA,aAC5B5C,KAAK2B,QAAQkB,SAAS9E,GACtB+D,EACA,CACIwB,KAAAA,IAGR,GAAImB,EAAkB3B,OAASC,EAAAA,EAAAA,GAK3B,OADA/C,KAAKkB,SAASuD,EAAkBtD,OACzB,KAJPkC,EAAWoB,EAAkBlB,QAAQC,WACrC3D,EAAWA,EAAS6E,OAAOD,EAAkBlB,QAAQG,SAO7D,OAAO7D,GAGX,IAAI8E,GAAmB,EACvB,MAAMC,EAAqBJ,MAAAA,IAGvB,MAAM7E,QAAqBiD,EAAAA,EAAAA,cACvB5C,KAAK2B,QAAQkB,SAAS9E,GACtB8F,EAAK/B,MACL,GAGE+C,EAAYhB,EAAK/B,KAAKkC,UAAUb,EAAUxD,aAAamC,KAAKgD,QAClE,GAAInF,EAAamD,OAASC,EAAAA,EAAAA,GAAe,CAcrC,OAbeyB,UACX,MAAMO,QAAiBC,EAAAA,EAAAA,SAAwBrF,EAAa4D,QAAQxB,YAEpE,GAAIgD,EAASjC,MAAQC,EAAAA,EAAAA,GAEjB,OADA/C,KAAKkB,SAAS6D,EAAS5D,OAChB,KAGX,MAAM9B,EAAW0F,EAASxB,QAE1B,OADa,IAAI0B,KAAK,CAAC5F,GAAWwF,IAS1C,OAFA7E,KAAKkB,SAASvB,EAAawB,OAC3BwD,GAAmB,EACZ,IAAMvC,QAAQ8C,QAAQ,OAGjC,IAAIC,EAAsD,CAAChC,EAAUxD,cAErE,MAAMyF,EAAwC,GAE9C,KAAOD,EAAuBL,OAAS,GAAG,CACtC,MAAMO,EAAuD,GAC7D,IAAK,MAAMlC,KAAagC,EAAwB,CAC5C,MAAMG,EAAOf,EAAmBpB,SAC1BmC,EACND,EAAM7D,KAAK8D,GAKf,GAFAH,EAAyB,GAErBR,EAIA,YAHA3E,KAAKoB,SAAS,CACVZ,SAAS,IAKjB,IAAK,MAAM8E,KAAQD,EAAO,CACtB,MAAME,QAAgBD,EACtB,GAAe,MAAXC,EAIA,YAHAvF,KAAKoB,SAAS,CACVZ,SAAS,IAKjB,IAAK,MAAMgF,KAAkBD,EACzB,GAAIC,EAAevF,YACfkF,EAAuB3D,KAAKgE,OACzB,CACH,MAAMC,QAAyBb,EAAmBY,GAClDJ,EAAc5D,KAAKiE,OAOnC,SADMrD,QAAQsD,IAAIN,GACdT,EAIA,YAHA3E,KAAKoB,SAAS,CACVZ,SAAS,IAKjB,MAAMmF,EAAwB,GAC9B,IAAK,MAAMC,KAAgBR,EACvBO,EAAcnE,WAAYoE,GAG9B,MAAMC,QAAgBC,EAAAA,EAAAA,IAAYH,GAAeI,OAE3CC,EAAQC,KAAKC,IACf/C,EAAUxD,aAAamC,KAAKqE,YAAY,MACxChD,EAAUxD,aAAamC,KAAKqE,YAAY,MAGtC3H,EAAW2E,EAAUxD,aAAamC,KAAKsB,MAAM4C,EAAQ,GAAK,OAChEzH,EAAsBC,EAAUqH,GAEhC7F,KAAKoB,SAAS,CACVZ,SAAS,IAIS,qBACtBR,KAAKoB,SAAS,CACVZ,SAAS,IAGb,MAAMC,EAAeT,KAAKK,MAAMI,aAC1BkC,QAAiBC,EAAAA,EAAAA,cACnB5C,KAAK2B,QAAQkB,SAAS9E,GACtB0C,EAAad,aAAamC,MAC1B,GAGJ,GAAIa,EAASG,OAASC,EAAAA,EAAAA,GAAe,CACjC,MAAMiD,EAAQC,KAAKC,IACfzF,EAAad,aAAamC,KAAKqE,YAAY,MAC3C1F,EAAad,aAAamC,KAAKqE,YAAY,MAEzC3H,EAAWiC,EAAad,aAAamC,KAAKsB,MAAM4C,EAAQ,GAE9DzH,EAAsBC,EAAUmE,EAASY,QAAQG,cAC9C1D,KAAKkB,SAASyB,EAASxB,OAE9BnB,KAAKoB,SAAS,CACVZ,SAAS,IAIS,mBACtB4F,EACAxG,GAEA,IAAInB,EACJ,GAAI2H,EAASnG,YACTxB,EAAW,IAAIyF,eACZ,CACH,MAAMmC,EAAe,IAAIjE,SAAqB8C,IAC1C,MAAMoB,EAAQxH,SAASC,cAAc,SACrCuH,EAAMC,KAAO,OACbD,EAAME,SAAWC,IACb,MAAMC,EAASD,EAAEE,QAA6BD,MACnCxB,EAAPwB,EAAeA,EAAM,GACZ,OAEjBJ,EAAMhH,WAGJsH,QAAkBP,EACxB,IAAKO,EAAW,OAGhBnI,QAAiBmI,EAAUC,cAG/B7G,KAAKoB,SAAS,CAAEZ,SAAS,IAEzB,IAAIsG,EAAiBlH,EAAOD,aAAamC,KACpCsE,EAASW,QACTD,EAAiB,IAAMA,EADLA,GAAkB,IAAMV,EAASY,WAEpDF,EAAe/C,WAAW,QAAO+C,EAAiBA,EAAe9C,UAAU,IAC3EoC,EAASnG,cAAa6G,GAAkB,4BAE5C,MAAMnE,QAAiBC,EAAAA,EAAAA,gBACnB5C,KAAK2B,QAAQkB,SAAS9E,GACtB,CACI+D,KAAMgF,EACN7C,aAAcmC,EAASW,QAAUnH,EAAOD,aAAasE,aAAe,MAExExF,GAGAkE,EAASG,OAASC,EAAAA,EAAAA,GAClB/C,KAAKkB,SAASyB,EAASxB,OAChBiF,EAASW,UAChBnH,EAAOD,aAAegD,EAASY,SAG9B6C,EAASW,UACVnH,EAAOG,aAAc,QACfC,KAAKgB,cAAcpB,IAG7B,IAAIqH,EAAuBH,EAAeC,QAAQ,KAAM,KACpDE,EAAqBlD,WAAW,OAChCkD,EAAuBA,EAAqBjD,UAAU,IAC1D,MAAMkD,EACFtH,EAAOC,SAASsH,MAAKC,GACjBH,EAAqBlD,WAAWqD,EAAMzH,aAAamC,KAAKiF,QAAQ,KAAM,SACrE,KAELG,IACId,EAASnG,mBACHD,KAAKgB,cAAckG,GACzBlH,KAAKoB,SAAS,CACVV,mBAAoB,KACpBD,aAAc,cAETT,KAAKa,WAAWqG,IAEjClH,KAAKoB,SAAS,CACVZ,SAAS,IAITS,eAAekC,GAEnBA,EAAUpD,aAAc,EACxBoD,EAAUtD,SAASwH,SAAQD,IACnBA,IAAUpH,KAAKK,MAAMI,aACrBT,KAAKoB,SAAS,CACVX,aAAc,OAEb2G,IAAUpH,KAAKK,MAAMK,oBAC1BV,KAAKoB,SAAS,CACVV,mBAAoB,OAExB0G,EAAMzH,aAAaM,aAAaD,KAAKiB,eAAemG,MAG5DjE,EAAUtD,SAAW,GAGlBjC,SACH,GAAIoC,KAAKK,MAAMG,QACX,OAAO,gBAAC,IAAD,CAAS8G,KAAK,2BAKzB,GAF2BtH,KAAK2B,QAAQkB,SAAS0E,oBAEtBC,EAAAA,GAAAA,WACvB,OACI,uBAAK3J,UAAU,eACX,gBAAC,IAAD,CAAc4J,MAAM,oCAKhC,MAAMC,GAAqBhG,EAAAA,EAAAA,IACvB1B,KAAK2B,QAAQC,sBACbC,EAAAA,GAAAA,MAGE8F,GAAWjG,EAAAA,EAAAA,IACb1B,KAAK2B,QAAQC,sBACbC,EAAAA,GAAAA,OAGJ,OACI,2BACI,gBAAC,IAAD,CAAiB+F,IAAK5H,KAAKK,QAC3B,sBAAIxC,UAAU,eACV,gBAAC,IAAD,CAAkBE,GAAG,sCAExBiC,KAAKK,MAAMC,OAAOqD,KAAI,CAACkE,EAAK7B,KACzB,GAAK6B,EACL,OACI,gBAAC,KAAD,CACIC,IAAK9B,EACL7E,MAAO0G,EACPE,QAAS,IACL/H,KAAKoB,UAAS4G,IACV,MAAMC,EAAS3G,MAAMC,KAAKyG,EAAK1H,QAE/B,OADA2H,EAAOjC,QAASkC,EACT,CACH5H,OAAQ2H,WAOhC,uBAAKpK,UAAU,mBACV6J,EACG,uBACI7J,UAAU,YACVsK,MAAO,CACHC,aAAc,OACdC,UAAW,QACXC,SAAU,QACVC,UAAW,WAEdvI,KAAKwI,gBAAgBxI,KAAKK,MAAME,gBAGrC,uBACI4H,MAAO,CACHM,SAAU,UAEd,gBAAC,IAAD,CAAchB,MAAM,8CAG5B,uBACI5J,UAAU,sDACVsK,MAAO,CAAEO,QAAS,SAChBf,EAGE,gBAAC,WAAD,MAFA,gBAAC,IAAD,CAAcF,MAAM,yCAIvBzH,KAAKK,MAAMK,mBACRV,KAAK2I,eACL3I,KAAKK,MAAMI,aACXT,KAAK4I,qBACLlB,EACA,0BACI,gBAAC,IAAD,CAAkB3J,GAAG,qCAGzBiC,KAAK6I,4BAQrBL,gBAAgB9F,GACpB,MAAMsD,EAAQC,KAAKC,IACfxD,EAAI/C,aAAamC,KAAKqE,YAAY,MAClCzD,EAAI/C,aAAamC,KAAKqE,YAAY,MAEhC2C,EAAWpG,IAAQ1C,KAAKK,MAAMI,aACpC,IAAKiC,EAAI/C,aAAaM,YAAa,CAC/B,MAAMzB,EAAWkE,EAAI/C,aAAamC,KAAKsB,MAAM4C,EAAQ,GACrD,OACI,sBAAInI,UAAU,cACV,gBAAC,IAAD,CACIkL,QAASD,EAAW,YAAc,UAClCE,QAAS,KAAWhJ,KAAKc,kBAAiB,IAAMd,KAAKa,WAAW6B,MAChE7E,UAAU,UACV,gBAAC,IAAD,CAAiBoL,KAAMC,EAAAA,MAJ3B,OAKW1K,IAMvB,MAAM2K,EACFzG,GAAO1C,KAAKK,MAAME,cACZ,gBACAmC,EAAI/C,aAAamC,KAAKsB,MAAM4C,EAAQ,GAE9C,OACI,uBAAKnI,UAAU,QACX,gBAAC,IAAD,KACI,gBAAC,IAAD,CACIkL,QAAUrG,EAAI3C,YAA4B,UAAd,YAC5BiJ,QAAS,KACDtG,EAAI3C,aACJC,KAAKiB,eAAeyB,GACpB1C,KAAKyC,eAEAzC,KAAKc,kBAAiB,IAAMd,KAAKgB,cAAc0B,OAG5D,gBAAC,IAAD,CAAiBuG,KAAMvG,EAAI3C,YAAcqJ,EAAAA,IAAgBC,EAAAA,OAE7D,gBAAC,IAAD,CACIxL,UAAU,SACVkL,QAASD,EAAW,YAAc,UAClCE,QAAS,KAAWhJ,KAAKc,kBAAiB,IAAMd,KAAKa,WAAW6B,OAC/DyG,IAGT,sBAAItL,UAAU,cACT6E,EAAI7C,SAAS8D,KAAI2F,GACd,sBAAIxB,IAAKwB,EAAO3J,aAAamC,MAAO9B,KAAKwI,gBAAgBc,QAOrEX,eACJ,MAAMY,EAAS,CACXvC,WAAY,CACRT,KAAMiD,EAAAA,GAAAA,OACNC,KAAM,oCACNC,QAAS,wCACTC,aAAc,IAElB1J,YAAa,CACTsG,KAAMiD,EAAAA,GAAAA,QACNC,KAAM,yCACNE,cAAc,IAIhBC,EAAa5J,KAAKK,MAAMK,mBAE9B,OACI,gBAAC,WAAD,KACI,0BACKkJ,EAAWjK,aAAamC,KACxB8H,EAAWhK,OAAS,IAAM,IAE/B,0BACI,gBAAC,IAAD,CAAkB7B,GAAG,gCAEzB,2BACA,gBAAC,IAAD,CACIwL,OAAQA,EACRM,OAASN,IACAvJ,KAAKW,aAAa4I,EAAQK,IAEnCE,cAAc,kCAMtBlB,qBACJ,MAAMmB,GAAUrI,EAAAA,EAAAA,IAAc1B,KAAK2B,QAAQC,sBAAuBC,EAAAA,GAAAA,MAC5D8F,GAAWjG,EAAAA,EAAAA,IACb1B,KAAK2B,QAAQC,sBACbC,EAAAA,GAAAA,OAGEmI,EAAoBhK,KAAKK,MAAMI,aAC/BuF,EAAQC,KAAKC,IACf8D,EAAkBrK,aAAamC,KAAKqE,YAAY,MAChD6D,EAAkBrK,aAAamC,KAAKqE,YAAY,MAE9C3H,EAAWwL,EAAkBrK,aAAamC,KAAKsB,MAAM4C,EAAQ,GAE7DiE,GACDD,EAAkBrK,aAAaM,cAC/B+J,EAAkBrK,aAAasE,aAE9BkF,EACFa,GAAqBhK,KAAKK,MAAME,cAC1B,gBACAyJ,EAAkBrK,aAAamC,KAAKsB,MAAM4C,EAAQ,GACtDtF,EAAqBV,KAAKK,MAAMK,qBAAuBsJ,EAEvDE,GAAuBxI,EAAAA,EAAAA,IACzB1B,KAAK2B,QAAQC,sBACbC,EAAAA,GAAAA,QAGJ,IAAIsI,EAAaH,EAAkBrK,aAAamC,KAAKsI,WAAW,KAAM,KAGtE,OAFKD,EAAWpG,WAAW,OAAMoG,EAAa,IAAMA,GAGhD,gBAAC,WAAD,KACI,0BAAKA,GACL,2BACA,uBAAKtM,UAAU,QACTmM,EAAkBrK,aAAaM,YAqE7B,gBAAC,WAAD,KACI,gBAAC,IAAD,CACI8I,QAAQ,UACRlL,UAAU,cACVmL,QAAS,KAAWhJ,KAAKqK,kBAAkBL,KAC3C,gBAAC,IAAD,CAAiBf,KAAMqB,EAAAA,MAJ3B,OAMI,gBAAC,IAAD,CAAkBvM,GAAG,4CAEzB,gBAAC,IAAD,CACIgL,QAASrI,EAAqB,YAAc,UAC5C7C,UAAU,cACVmL,QAAS,KACDhJ,KAAKK,MAAMK,oBAAsBsJ,GACjChK,KAAKoB,SAAS,CACVV,mBAAoBsJ,MAIhC,gBAAC,IAAD,CAAiBf,KAAMsB,EAAAA,MAV3B,OAYI,gBAAC,IAAD,CAAkBxM,GAAG,gCAEzB,gBAAC,IAAD,CACIyM,UAAU,MACVC,OACIP,IACAF,EAAkBjK,aACoB,IAAtCiK,EAAkBnK,SAASiF,cAErBoD,EAEVwC,QAASvK,GACL,gBAAC,IAAD,GAASpC,GAAG,2BAA8BoC,GACtC,gBAAC,IAAD,CACIpC,GACKiM,EAAkBjK,YAEbmK,EACA,iDACA,kDAHA,8DAQtB,gBAAC,IAAD,CACInB,QAAQ,SACRlL,UAAU,cACV8M,UACKX,EAAkBjK,cAClBmK,GACDF,EAAkBnK,SAASiF,OAAS,GACpCkF,GAAqBhK,KAAKK,MAAME,cAEpCyI,QAAS,KAED5E,QACIpE,KAAKG,MAAMkE,KAAKC,cACZ,CACIvG,GACI,gDAER,CAAEoL,cAAAA,MAILnJ,KAAKc,kBAAiB,IACvBd,KAAK4K,gBAAgBZ,OAGjC,gBAAC,IAAD,CAAiBf,KAAM4B,EAAAA,MAzB3B,OA2BI,gBAAC,IAAD,CAAkB9M,GAAG,4CA5IjC,gBAAC,WAAD,KACI,gBAAC,IAAD,CACIyM,UAAU,MACVE,QAASvK,GACL,gBAAC,IAAD,GAASpC,GAAG,kCAAqCoC,GAC7C,gBAAC,IAAD,CAAkBpC,GAAG,4CAG7B,gBAAC,IAAD,CACIF,UAAU,OACV8M,UAAWZ,EACXf,QAAS,KAAWhJ,KAAK8K,iBACzB,gBAAC,IAAD,CAAkB/M,GAAG,mCAG7B,gBAAC,IAAD,CACIyM,UAAU,MACVC,QAAO9C,IAAasC,SAA6B/B,EACjDwC,QAASvK,GACL,gBAAC,IAAD,GAASpC,GAAG,8BAAiCoC,GACzC,gBAAC,IAAD,CAAkBpC,GAAG,wCAG7B,gBAAC,IAAD,CACIgL,QAAQ,UACRlL,UAAU,OACV8M,UAAWhD,GAAYsC,EACvBjB,QAAS,KACAhJ,KAAKW,aACN,CACIqG,WAAYxI,EACZyB,aAAa,EACb8G,SAAS,GAEbiD,KAGR,gBAAC,IAAD,CAAkBjM,GAAG,kCAG7B,gBAAC,IAAD,CACIyM,UAAU,MACVC,QAAO9C,IAAasC,SAA6B/B,EACjDwC,QAASvK,GACL,gBAAC,IAAD,GAASpC,GAAG,qCAAwCoC,GAChD,gBAAC,IAAD,CAAkBpC,GAAG,wCAG7B,gBAAC,IAAD,CACIgL,QAAQ,SACRlL,UAAU,OACV8M,UAAWhD,GAAYsC,EACvBjB,QAAS,KAED5E,QACIpE,KAAKG,MAAMkE,KAAKC,cACZ,CAAEvG,GAAI,sCACN,CAAE+D,KAAMkI,EAAkBrK,aAAamC,SAI1C9B,KAAKc,kBAAiB,IAAMd,KAAKe,iBAE9C,gBAAC,IAAD,CAAkBhD,GAAG,oCAuF7C8K,yBACJ,OAAO,gBAAC,IAAD,OAIf3I,EAAM6K,YAAcC,EAAAA,EACpB,WAAeC,EAAAA,EAAAA,IAAW/K","sources":["webpack://tgstation-server-control-panel/./src/components/utils/WIPNotice.tsx","webpack://tgstation-server-control-panel/./src/components/views/Instance/Edit/Files.tsx"],"sourcesContent":["import React, { ReactNode } from \"react\";\nimport Card from \"react-bootstrap/Card\";\nimport { FormattedMessage } from \"react-intl\";\n\nimport { MODE, VERSION } from \"../../definitions/constants\";\n\nexport default class WIPNotice extends React.Component {\n    public render(): ReactNode {\n        return (\n            <Card className=\"bg-transparent\" border=\"info\">\n                <Card.Header className=\"bg-info text-dark font-weight-bold\">\n                    <FormattedMessage id=\"generic.wip\" />\n                </Card.Header>\n                <Card.Body>\n                    <Card.Title>\n                        <FormattedMessage id=\"generic.wip.desc\" />\n                        <a href=\"https://github.com/tgstation/Tgstation.Server.ControlPanel/releases/latest\">\n                            https://github.com/tgstation/Tgstation.Server.ControlPanel/releases/latest\n                        </a>\n                    </Card.Title>\n                    <Card.Text as={\"pre\"} className=\"bg-transparent text-info\">\n                        <code>\n                            {`Version: ${VERSION}\\nWebpanel Mode: ${MODE}\\nCurrent route: ${window.location.toString()}`}\n                        </code>\n                    </Card.Text>\n                </Card.Body>\n            </Card>\n        );\n    }\n}\n","import {\r\n    faDownload,\r\n    faFile,\r\n    faFileAlt,\r\n    faFolderMinus,\r\n    faFolderPlus,\r\n    faTimes\r\n} from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { downloadZip } from \"client-zip\";\r\nimport React from \"react\";\r\nimport { Button, ButtonGroup, OverlayTrigger, Tooltip } from \"react-bootstrap\";\r\nimport { FormattedMessage, injectIntl, WrappedComponentProps } from \"react-intl\";\r\n\r\nimport ConfigurationFileClient from \"../../../../ApiClient/ConfigurationFileClient\";\r\nimport {\r\n    ConfigurationFileResponse,\r\n    ConfigurationRights,\r\n    ConfigurationType\r\n} from \"../../../../ApiClient/generatedcode/generated\";\r\nimport InternalError, { ErrorCode } from \"../../../../ApiClient/models/InternalComms/InternalError\";\r\nimport { StatusCode } from \"../../../../ApiClient/models/InternalComms/InternalStatus\";\r\nimport TransferClient from \"../../../../ApiClient/TransferClient\";\r\nimport { InstanceEditContext } from \"../../../../contexts/InstanceEditContext\";\r\nimport { hasFilesRight } from \"../../../../utils/misc\";\r\nimport ErrorAlert from \"../../../utils/ErrorAlert\";\r\nimport GenericAlert from \"../../../utils/GenericAlert\";\r\nimport { FieldType } from \"../../../utils/InputField\";\r\nimport InputForm from \"../../../utils/InputForm\";\r\nimport { DebugJsonViewer } from \"../../../utils/JsonViewer\";\r\nimport Loading from \"../../../utils/Loading\";\r\nimport WIPNotice from \"../../../utils/WIPNotice\";\r\n\r\n// https://stackoverflow.com/questions/24007073/open-links-made-by-createobjecturl-in-ie11/45732897#45732897\r\nconst downloadFileUsingBlob = (fileName: string, fileData: Blob) => {\r\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-explicit-any\r\n    const unknownNav = window.navigator as any;\r\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\r\n    if (unknownNav && unknownNav.msSaveOrOpenBlob) {\r\n        // for IE\r\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call\r\n        unknownNav.msSaveOrOpenBlob(fileData, fileName);\r\n    } else {\r\n        // for Non-IE (chrome, firefox etc.)\r\n        const a = document.createElement(\"a\");\r\n        document.body.appendChild(a);\r\n        const fileUrl = URL.createObjectURL(fileData);\r\n        a.href = fileUrl;\r\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n        a.download = fileName;\r\n        a.click();\r\n        URL.revokeObjectURL(a.href);\r\n        a.remove();\r\n    }\r\n};\r\n\r\ninterface CreateEntitySettings {\r\n    entityName: string;\r\n    isDirectory: boolean;\r\n    replace?: boolean;\r\n}\r\n\r\nclass DirectoryTree {\r\n    public parent: DirectoryTree | null;\r\n    public children: DirectoryTree[];\r\n    public fileResponse: ConfigurationFileResponse;\r\n    public totalFiles: number | undefined;\r\n    public fullyLoaded = false;\r\n\r\n    public constructor(fileResponse: ConfigurationFileResponse, parent?: DirectoryTree) {\r\n        this.fileResponse = fileResponse;\r\n        this.parent = parent ?? null;\r\n        if (!fileResponse.isDirectory) this.fullyLoaded = true;\r\n        this.children = [];\r\n    }\r\n}\r\n\r\ninterface IProps extends WrappedComponentProps {}\r\n\r\ninterface IState {\r\n    errors: Array<InternalError<ErrorCode> | undefined>;\r\n    rootDirectory: DirectoryTree | null;\r\n    loading: boolean;\r\n    selectedFile: DirectoryTree | null;\r\n    selectedCreateNode: DirectoryTree | null;\r\n}\r\n\r\nclass Files extends React.Component<IProps, IState> {\r\n    public declare context: InstanceEditContext;\r\n\r\n    public constructor(props: IProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            errors: [],\r\n            rootDirectory: null,\r\n            loading: true,\r\n            selectedFile: null,\r\n            selectedCreateNode: null\r\n        };\r\n\r\n        this.createEntity = this.createEntity.bind(this);\r\n        this.selectFile = this.selectFile.bind(this);\r\n        this.shortAsyncAction = this.shortAsyncAction.bind(this);\r\n        this.deleteFile = this.deleteFile.bind(this);\r\n        this.loadDirectory = this.loadDirectory.bind(this);\r\n        this.clearDirectory = this.clearDirectory.bind(this);\r\n    }\r\n\r\n    private addError(error: InternalError<ErrorCode>): void {\r\n        this.setState(prevState => {\r\n            const errors = Array.from(prevState.errors);\r\n            errors.push(error);\r\n            return {\r\n                errors\r\n            };\r\n        });\r\n    }\r\n\r\n    public async componentDidMount(): Promise<void> {\r\n        await this.loadRootDir();\r\n    }\r\n\r\n    private async loadRootDir() {\r\n        if (hasFilesRight(this.context.instancePermissionSet, ConfigurationRights.List)) {\r\n            this.setState({\r\n                loading: true\r\n            });\r\n            const mockResponse = {\r\n                path: \"/\",\r\n                isDirectory: true,\r\n                fileTicket: \"\"\r\n            };\r\n            const rootDirectory = new DirectoryTree(mockResponse);\r\n            await this.loadDirectory(rootDirectory);\r\n\r\n            this.setState({\r\n                rootDirectory: rootDirectory,\r\n                loading: false\r\n            });\r\n        } else {\r\n            this.setState({\r\n                loading: false\r\n            });\r\n        }\r\n    }\r\n\r\n    private async shortAsyncAction(action: () => Promise<void>): Promise<void> {\r\n        const actionPromise = action();\r\n\r\n        // only set state to loading if it's taking more than 750ms\r\n        let tookTooLong = false;\r\n        const tooLongPromise = new Promise(r => setTimeout(r, 750)).then(() => {\r\n            tookTooLong = true;\r\n        });\r\n\r\n        await Promise.race([actionPromise, tooLongPromise]);\r\n\r\n        if (tookTooLong) {\r\n            this.setState({\r\n                loading: true\r\n            });\r\n\r\n            await actionPromise;\r\n\r\n            this.setState({\r\n                loading: false\r\n            });\r\n        } else this.forceUpdate();\r\n    }\r\n\r\n    private async deleteDirectory(dir: DirectoryTree): Promise<void> {\r\n        const response = await ConfigurationFileClient.deleteDirectory(this.context.instance.id, {\r\n            path: dir.fileResponse.path\r\n        });\r\n\r\n        if (response.code === StatusCode.OK) {\r\n            if (dir.parent != null) {\r\n                const parentIndex = dir.parent.children.indexOf(dir);\r\n                dir.parent.children.splice(parentIndex, 1);\r\n                this.forceUpdate();\r\n            }\r\n        } else {\r\n            this.addError(response.error);\r\n        }\r\n    }\r\n\r\n    private async loadDirectory(directory: DirectoryTree): Promise<void> {\r\n        if (hasFilesRight(this.context.instancePermissionSet, ConfigurationRights.List)) {\r\n            this.clearDirectory(directory);\r\n\r\n            const path =\r\n                directory.fileResponse.path[0] === \"\\\\\" || directory.fileResponse.path[0] === \"/\"\r\n                    ? directory.fileResponse.path.slice(1)\r\n                    : directory.fileResponse.path;\r\n            let maxPages = 1;\r\n            for (let page = 1; page <= maxPages; ++page) {\r\n                const response = await ConfigurationFileClient.getDirectory(\r\n                    this.context.instance.id,\r\n                    path,\r\n                    {\r\n                        page\r\n                    }\r\n                );\r\n                if (response.code === StatusCode.OK) {\r\n                    maxPages = response.payload.totalPages;\r\n                    if (maxPages <= page) directory.fullyLoaded = true;\r\n                    const newChildren = response.payload.content.map(\r\n                        c => new DirectoryTree(c, directory)\r\n                    );\r\n                    for (const c of newChildren) {\r\n                        directory.children.push(c);\r\n                    }\r\n                } else {\r\n                    this.addError(response.error);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private async selectFile(file: DirectoryTree): Promise<void> {\r\n        if (this.state.selectedFile === file) {\r\n            this.setState({\r\n                selectedFile: null\r\n            });\r\n            return;\r\n        }\r\n\r\n        let doctoredPath = file.fileResponse.path;\r\n        while (doctoredPath.startsWith(\"/\")) doctoredPath = doctoredPath.substring(1);\r\n\r\n        if (!file.fileResponse.isDirectory) {\r\n            const response = await ConfigurationFileClient.getConfigFile(\r\n                this.context.instance.id,\r\n                doctoredPath,\r\n                false\r\n            );\r\n\r\n            const success = response.code === StatusCode.OK;\r\n            if (success) {\r\n                file.fileResponse = response.payload;\r\n            } else {\r\n                this.addError(response.error);\r\n                file.fileResponse.lastReadHash = null;\r\n            }\r\n        }\r\n\r\n        this.setState({\r\n            selectedFile: file,\r\n            selectedCreateNode: null\r\n        });\r\n    }\r\n\r\n    private async deleteFile(): Promise<void> {\r\n        const selectedFile = this.state.selectedFile!;\r\n        const response = await ConfigurationFileClient.writeConfigFile(\r\n            this.context.instance.id,\r\n            {\r\n                path: selectedFile.fileResponse.path,\r\n                lastReadHash: selectedFile.fileResponse.lastReadHash\r\n            },\r\n            new Uint8Array()\r\n        );\r\n\r\n        if (response.code === StatusCode.OK) {\r\n            const parentDirectory = selectedFile.parent!;\r\n            const parentIndex = parentDirectory.children.indexOf(selectedFile);\r\n            parentDirectory.children.splice(parentIndex, 1);\r\n            this.setState({\r\n                selectedFile: null\r\n            });\r\n        } else this.addError(response.error);\r\n    }\r\n\r\n    private async downloadDirectory(directory: DirectoryTree): Promise<void> {\r\n        if (\r\n            !confirm(\r\n                this.props.intl.formatMessage(\r\n                    { id: \"view.instance.files.zip.confirm\" },\r\n                    { path: directory.fileResponse.path }\r\n                )\r\n            )\r\n        ) {\r\n            return;\r\n        }\r\n        this.setState({\r\n            loading: true\r\n        });\r\n\r\n        const enumerateDirectory = async (\r\n            dir: ConfigurationFileResponse\r\n        ): Promise<ConfigurationFileResponse[] | null> => {\r\n            let children: ConfigurationFileResponse[] = [];\r\n            let maxPages = 1;\r\n\r\n            const path = dir.path[0] === \"\\\\\" || dir.path[0] === \"/\" ? dir.path.slice(1) : dir.path;\r\n            for (let page = 1; page <= maxPages; ++page) {\r\n                const directoryResponse = await ConfigurationFileClient.getDirectory(\r\n                    this.context.instance.id,\r\n                    path,\r\n                    {\r\n                        page\r\n                    }\r\n                );\r\n                if (directoryResponse.code === StatusCode.OK) {\r\n                    maxPages = directoryResponse.payload.totalPages;\r\n                    children = children.concat(directoryResponse.payload.content);\r\n                } else {\r\n                    this.addError(directoryResponse.error);\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return children;\r\n        };\r\n\r\n        let errorEncountered = false;\r\n        const downloadSingleFile = async (\r\n            file: ConfigurationFileResponse\r\n        ): Promise<() => Promise<File | null>> => {\r\n            const fileResponse = await ConfigurationFileClient.getConfigFile(\r\n                this.context.instance.id,\r\n                file.path,\r\n                false\r\n            );\r\n\r\n            const pathInZip = file.path.substring(directory.fileResponse.path.length);\r\n            if (fileResponse.code === StatusCode.OK) {\r\n                const phase2 = async (): Promise<File | null> => {\r\n                    const contents = await TransferClient.Download(fileResponse.payload.fileTicket);\r\n\r\n                    if (contents.code != StatusCode.OK) {\r\n                        this.addError(contents.error);\r\n                        return null;\r\n                    }\r\n\r\n                    const download = contents.payload;\r\n                    const file = new File([download], pathInZip);\r\n                    return file;\r\n                };\r\n\r\n                return phase2;\r\n            }\r\n\r\n            this.addError(fileResponse.error);\r\n            errorEncountered = true;\r\n            return () => Promise.resolve(null);\r\n        };\r\n\r\n        let directoriesToEnumerate: ConfigurationFileResponse[] = [directory.fileResponse];\r\n\r\n        const fileDownloads: Promise<File | null>[] = [];\r\n\r\n        while (directoriesToEnumerate.length > 0) {\r\n            const tasks: Promise<ConfigurationFileResponse[] | null>[] = [];\r\n            for (const directory of directoriesToEnumerate) {\r\n                const task = enumerateDirectory(directory);\r\n                await task;\r\n                tasks.push(task);\r\n            }\r\n\r\n            directoriesToEnumerate = [];\r\n\r\n            if (errorEncountered) {\r\n                this.setState({\r\n                    loading: false\r\n                });\r\n                return;\r\n            }\r\n\r\n            for (const task of tasks) {\r\n                const dirInfo = await task;\r\n                if (dirInfo == null) {\r\n                    this.setState({\r\n                        loading: false\r\n                    });\r\n                    return;\r\n                }\r\n\r\n                for (const directoryEntry of dirInfo) {\r\n                    if (directoryEntry.isDirectory) {\r\n                        directoriesToEnumerate.push(directoryEntry);\r\n                    } else {\r\n                        const innerPromiseFunc = await downloadSingleFile(directoryEntry);\r\n                        fileDownloads.push(innerPromiseFunc());\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        await Promise.all(fileDownloads);\r\n        if (errorEncountered) {\r\n            this.setState({\r\n                loading: false\r\n            });\r\n            return;\r\n        }\r\n\r\n        const downloadFiles: File[] = [];\r\n        for (const fileDownload of fileDownloads) {\r\n            downloadFiles.push((await fileDownload)!);\r\n        }\r\n\r\n        const zipBlob = await downloadZip(downloadFiles).blob();\r\n\r\n        const index = Math.max(\r\n            directory.fileResponse.path.lastIndexOf(\"\\\\\"),\r\n            directory.fileResponse.path.lastIndexOf(\"/\")\r\n        );\r\n\r\n        const fileName = directory.fileResponse.path.slice(index + 1) + \".zip\";\r\n        downloadFileUsingBlob(fileName, zipBlob);\r\n\r\n        this.setState({\r\n            loading: false\r\n        });\r\n    }\r\n\r\n    private async downloadFile(): Promise<void> {\r\n        this.setState({\r\n            loading: true\r\n        });\r\n\r\n        const selectedFile = this.state.selectedFile!;\r\n        const response = await ConfigurationFileClient.getConfigFile(\r\n            this.context.instance.id,\r\n            selectedFile.fileResponse.path,\r\n            true\r\n        );\r\n\r\n        if (response.code === StatusCode.OK) {\r\n            const index = Math.max(\r\n                selectedFile.fileResponse.path.lastIndexOf(\"\\\\\"),\r\n                selectedFile.fileResponse.path.lastIndexOf(\"/\")\r\n            );\r\n            const fileName = selectedFile.fileResponse.path.slice(index + 1);\r\n\r\n            downloadFileUsingBlob(fileName, response.payload.content!);\r\n        } else this.addError(response.error);\r\n\r\n        this.setState({\r\n            loading: false\r\n        });\r\n    }\r\n\r\n    private async createEntity(\r\n        settings: CreateEntitySettings,\r\n        parent: DirectoryTree\r\n    ): Promise<void> {\r\n        let fileData: ArrayBuffer;\r\n        if (settings.isDirectory) {\r\n            fileData = new Uint8Array();\r\n        } else {\r\n            const inputPromise = new Promise<File | null>(resolve => {\r\n                const input = document.createElement(\"input\");\r\n                input.type = \"file\";\r\n                input.onchange = e => {\r\n                    const files = (e.target as HTMLInputElement)?.files;\r\n                    if (files) resolve(files[0]);\r\n                    else resolve(null);\r\n                };\r\n                input.click();\r\n            });\r\n\r\n            const localFile = await inputPromise;\r\n            if (!localFile) return;\r\n\r\n            // https://stackoverflow.com/questions/423376/how-to-get-the-file-name-from-a-full-path-using-javascript\r\n            fileData = await localFile.arrayBuffer();\r\n        }\r\n\r\n        this.setState({ loading: true });\r\n\r\n        let remoteFilePath = parent.fileResponse.path;\r\n        if (!settings.replace) remoteFilePath += \"/\" + settings.entityName;\r\n        else remoteFilePath = \"/\" + remoteFilePath;\r\n        if (remoteFilePath.startsWith(\"//\")) remoteFilePath = remoteFilePath.substring(1);\r\n        if (settings.isDirectory) remoteFilePath += \"/webpanel.dir.create.tmp\";\r\n\r\n        const response = await ConfigurationFileClient.writeConfigFile(\r\n            this.context.instance.id,\r\n            {\r\n                path: remoteFilePath,\r\n                lastReadHash: settings.replace ? parent.fileResponse.lastReadHash : null\r\n            },\r\n            fileData\r\n        );\r\n\r\n        if (response.code !== StatusCode.OK) {\r\n            this.addError(response.error);\r\n        } else if (settings.replace) {\r\n            parent.fileResponse = response.payload;\r\n        }\r\n\r\n        if (!settings.replace) {\r\n            parent.fullyLoaded = false;\r\n            await this.loadDirectory(parent);\r\n        }\r\n\r\n        let normalizedRemotePath = remoteFilePath.replace(\"\\\\\", \"/\");\r\n        if (normalizedRemotePath.startsWith(\"/\"))\r\n            normalizedRemotePath = normalizedRemotePath.substring(1);\r\n        const newFileNode =\r\n            parent.children.find(child =>\r\n                normalizedRemotePath.startsWith(child.fileResponse.path.replace(\"\\\\\", \"/\"))\r\n            ) ?? null;\r\n\r\n        if (newFileNode)\r\n            if (settings.isDirectory) {\r\n                await this.loadDirectory(newFileNode);\r\n                this.setState({\r\n                    selectedCreateNode: null,\r\n                    selectedFile: null\r\n                });\r\n            } else await this.selectFile(newFileNode);\r\n\r\n        this.setState({\r\n            loading: false\r\n        });\r\n    }\r\n\r\n    private clearDirectory(directory: DirectoryTree): void {\r\n        // reload the directory\r\n        directory.fullyLoaded = false;\r\n        directory.children.forEach(child => {\r\n            if (child === this.state.selectedFile)\r\n                this.setState({\r\n                    selectedFile: null\r\n                });\r\n            else if (child === this.state.selectedCreateNode)\r\n                this.setState({\r\n                    selectedCreateNode: null\r\n                });\r\n            if (child.fileResponse.isDirectory) this.clearDirectory(child);\r\n        });\r\n\r\n        directory.children = [];\r\n    }\r\n\r\n    public render(): React.ReactNode {\r\n        if (this.state.loading) {\r\n            return <Loading text=\"loading.instance.files\" />;\r\n        }\r\n\r\n        const instanceConfigMode = this.context.instance.configurationType;\r\n\r\n        if (instanceConfigMode === ConfigurationType.Disallowed) {\r\n            return (\r\n                <div className=\"text-center\">\r\n                    <GenericAlert title=\"view.instance.files.disallowed\" />\r\n                </div>\r\n            );\r\n        }\r\n\r\n        const canListDirectories = hasFilesRight(\r\n            this.context.instancePermissionSet,\r\n            ConfigurationRights.List\r\n        );\r\n\r\n        const canWrite = hasFilesRight(\r\n            this.context.instancePermissionSet,\r\n            ConfigurationRights.Write\r\n        );\r\n\r\n        return (\r\n            <div>\r\n                <DebugJsonViewer obj={this.state} />\r\n                <h2 className=\"text-center\">\r\n                    <FormattedMessage id=\"view.instance.files.file_browser\" />\r\n                </h2>\r\n                {this.state.errors.map((err, index) => {\r\n                    if (!err) return;\r\n                    return (\r\n                        <ErrorAlert\r\n                            key={index}\r\n                            error={err}\r\n                            onClose={() =>\r\n                                this.setState(prev => {\r\n                                    const newarr = Array.from(prev.errors);\r\n                                    newarr[index] = undefined;\r\n                                    return {\r\n                                        errors: newarr\r\n                                    };\r\n                                })\r\n                            }\r\n                        />\r\n                    );\r\n                })}\r\n                <div className=\"d-flex flex-row\">\r\n                    {canListDirectories ? (\r\n                        <div\r\n                            className=\"text-left\"\r\n                            style={{\r\n                                paddingRight: \"16px\",\r\n                                maxHeight: \"800px\",\r\n                                minWidth: \"200px\",\r\n                                overflowY: \"scroll\"\r\n                            }}>\r\n                            {this.renderDirectory(this.state.rootDirectory!)}\r\n                        </div>\r\n                    ) : (\r\n                        <div\r\n                            style={{\r\n                                maxWidth: \"200px\"\r\n                            }}>\r\n                            <GenericAlert title=\"view.instance.files.disallowed.directory\" />\r\n                        </div>\r\n                    )}\r\n                    <div\r\n                        className=\"flex-fill flex-column text-center align-self-center\"\r\n                        style={{ padding: \"16px\" }}>\r\n                        {!canWrite ? (\r\n                            <GenericAlert title=\"view.instance.files.disallowed.write\" />\r\n                        ) : (\r\n                            <React.Fragment />\r\n                        )}\r\n                        {this.state.selectedCreateNode ? (\r\n                            this.renderCreate()\r\n                        ) : this.state.selectedFile ? (\r\n                            this.renderSelectedFile()\r\n                        ) : canListDirectories ? (\r\n                            <h4>\r\n                                <FormattedMessage id=\"view.instance.files.select_item\" />\r\n                            </h4>\r\n                        ) : (\r\n                            this.renderBrowserlessForms()\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderDirectory(dir: DirectoryTree): React.ReactNode {\r\n        const index = Math.max(\r\n            dir.fileResponse.path.lastIndexOf(\"\\\\\"),\r\n            dir.fileResponse.path.lastIndexOf(\"/\")\r\n        );\r\n        const selected = dir === this.state.selectedFile;\r\n        if (!dir.fileResponse.isDirectory) {\r\n            const fileName = dir.fileResponse.path.slice(index + 1);\r\n            return (\r\n                <li className=\"browser-li\">\r\n                    <Button\r\n                        variant={selected ? \"secondary\" : \"primary\"}\r\n                        onClick={() => void this.shortAsyncAction(() => this.selectFile(dir))}\r\n                        className=\"nowrap\">\r\n                        <FontAwesomeIcon icon={faFileAlt} />\r\n                        &nbsp;{fileName}\r\n                    </Button>\r\n                </li>\r\n            );\r\n        }\r\n\r\n        const directoryName =\r\n            dir == this.state.rootDirectory\r\n                ? \"Configuration\"\r\n                : dir.fileResponse.path.slice(index + 1);\r\n\r\n        return (\r\n            <div className=\"mb-2\">\r\n                <ButtonGroup>\r\n                    <Button\r\n                        variant={!dir.fullyLoaded ? \"secondary\" : \"primary\"}\r\n                        onClick={() => {\r\n                            if (dir.fullyLoaded) {\r\n                                this.clearDirectory(dir);\r\n                                this.forceUpdate();\r\n                            } else {\r\n                                void this.shortAsyncAction(() => this.loadDirectory(dir));\r\n                            }\r\n                        }}>\r\n                        <FontAwesomeIcon icon={dir.fullyLoaded ? faFolderMinus : faFolderPlus} />\r\n                    </Button>\r\n                    <Button\r\n                        className=\"nowrap\"\r\n                        variant={selected ? \"secondary\" : \"primary\"}\r\n                        onClick={() => void this.shortAsyncAction(() => this.selectFile(dir))}>\r\n                        {directoryName}\r\n                    </Button>\r\n                </ButtonGroup>\r\n                <ul className=\"browser-ul\">\r\n                    {dir.children.map(subDir => (\r\n                        <li key={subDir.fileResponse.path}>{this.renderDirectory(subDir)}</li>\r\n                    ))}\r\n                </ul>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderCreate(): React.ReactNode {\r\n        const fields = {\r\n            entityName: {\r\n                type: FieldType.String as FieldType.String,\r\n                name: \"fields.instance.files.create.name\",\r\n                tooltip: \"fields.instance.files.create.name.tip\",\r\n                defaultValue: \"\"\r\n            },\r\n            isDirectory: {\r\n                type: FieldType.Boolean as FieldType.Boolean,\r\n                name: \"fields.instance.files.create.directory\",\r\n                defaultValue: false\r\n            }\r\n        };\r\n\r\n        const createNode = this.state.selectedCreateNode!;\r\n\r\n        return (\r\n            <React.Fragment>\r\n                <h5>\r\n                    {createNode.fileResponse.path}\r\n                    {createNode.parent ? \"/\" : \"\"}\r\n                </h5>\r\n                <h5>\r\n                    <FormattedMessage id=\"view.instance.files.create\" />\r\n                </h5>\r\n                <hr />\r\n                <InputForm\r\n                    fields={fields}\r\n                    onSave={(fields: CreateEntitySettings) =>\r\n                        void this.createEntity(fields, createNode)\r\n                    }\r\n                    saveMessageId=\"fields.instance.files.create\"\r\n                />\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    private renderSelectedFile(): React.ReactNode {\r\n        const canRead = hasFilesRight(this.context.instancePermissionSet, ConfigurationRights.Read);\r\n        const canWrite = hasFilesRight(\r\n            this.context.instancePermissionSet,\r\n            ConfigurationRights.Write\r\n        );\r\n\r\n        const fileDirectoryTree = this.state.selectedFile!;\r\n        const index = Math.max(\r\n            fileDirectoryTree.fileResponse.path.lastIndexOf(\"\\\\\"),\r\n            fileDirectoryTree.fileResponse.path.lastIndexOf(\"/\")\r\n        );\r\n        const fileName = fileDirectoryTree.fileResponse.path.slice(index + 1);\r\n\r\n        const fileIsNotRefreshed =\r\n            !fileDirectoryTree.fileResponse.isDirectory &&\r\n            !fileDirectoryTree.fileResponse.lastReadHash;\r\n\r\n        const directoryName =\r\n            fileDirectoryTree == this.state.rootDirectory\r\n                ? \"Configuration\"\r\n                : fileDirectoryTree.fileResponse.path.slice(index + 1);\r\n        const selectedCreateNode = this.state.selectedCreateNode === fileDirectoryTree;\r\n\r\n        const canDeleteDirectories = hasFilesRight(\r\n            this.context.instancePermissionSet,\r\n            ConfigurationRights.Delete\r\n        );\r\n\r\n        let headerText = fileDirectoryTree.fileResponse.path.replaceAll(\"\\\\\", \"/\");\r\n        if (!headerText.startsWith(\"/\")) headerText = \"/\" + headerText;\r\n\r\n        return (\r\n            <React.Fragment>\r\n                <h5>{headerText}</h5>\r\n                <hr />\r\n                <div className=\"mb-3\">\r\n                    {!fileDirectoryTree.fileResponse.isDirectory ? (\r\n                        <React.Fragment>\r\n                            <OverlayTrigger\r\n                                placement=\"top\"\r\n                                overlay={props => (\r\n                                    <Tooltip id=\"file-download-location-tooltip\" {...props}>\r\n                                        <FormattedMessage id=\"view.instance.files.download.location\" />\r\n                                    </Tooltip>\r\n                                )}>\r\n                                <Button\r\n                                    className=\"mx-2\"\r\n                                    disabled={!canRead}\r\n                                    onClick={() => void this.downloadFile()}>\r\n                                    <FormattedMessage id=\"view.instance.files.download\" />\r\n                                </Button>\r\n                            </OverlayTrigger>\r\n                            <OverlayTrigger\r\n                                placement=\"top\"\r\n                                show={!canWrite || !fileIsNotRefreshed ? false : undefined}\r\n                                overlay={props => (\r\n                                    <Tooltip id=\"file-not-refreshed-tooltip\" {...props}>\r\n                                        <FormattedMessage id=\"view.instance.files.replace.stale\" />\r\n                                    </Tooltip>\r\n                                )}>\r\n                                <Button\r\n                                    variant=\"warning\"\r\n                                    className=\"mx-2\"\r\n                                    disabled={!canWrite || fileIsNotRefreshed}\r\n                                    onClick={() =>\r\n                                        void this.createEntity(\r\n                                            {\r\n                                                entityName: fileName,\r\n                                                isDirectory: false,\r\n                                                replace: true\r\n                                            },\r\n                                            fileDirectoryTree\r\n                                        )\r\n                                    }>\r\n                                    <FormattedMessage id=\"view.instance.files.replace\" />\r\n                                </Button>\r\n                            </OverlayTrigger>\r\n                            <OverlayTrigger\r\n                                placement=\"top\"\r\n                                show={!canWrite || !fileIsNotRefreshed ? false : undefined}\r\n                                overlay={props => (\r\n                                    <Tooltip id=\"file-not-refreshed-tooltip-delete\" {...props}>\r\n                                        <FormattedMessage id=\"view.instance.files.replace.stale\" />\r\n                                    </Tooltip>\r\n                                )}>\r\n                                <Button\r\n                                    variant=\"danger\"\r\n                                    className=\"mx-2\"\r\n                                    disabled={!canWrite || fileIsNotRefreshed}\r\n                                    onClick={() => {\r\n                                        if (\r\n                                            confirm(\r\n                                                this.props.intl.formatMessage(\r\n                                                    { id: \"view.instance.files.delete.confirm\" },\r\n                                                    { path: fileDirectoryTree.fileResponse.path }\r\n                                                )\r\n                                            )\r\n                                        )\r\n                                            void this.shortAsyncAction(() => this.deleteFile());\r\n                                    }}>\r\n                                    <FormattedMessage id=\"view.instance.files.delete\" />\r\n                                </Button>\r\n                            </OverlayTrigger>\r\n                        </React.Fragment>\r\n                    ) : (\r\n                        <React.Fragment>\r\n                            <Button\r\n                                variant=\"primary\"\r\n                                className=\"mx-2 nowrap\"\r\n                                onClick={() => void this.downloadDirectory(fileDirectoryTree)}>\r\n                                <FontAwesomeIcon icon={faDownload} />\r\n                                &nbsp;\r\n                                <FormattedMessage id=\"view.instance.files.download.directory\" />\r\n                            </Button>\r\n                            <Button\r\n                                variant={selectedCreateNode ? \"secondary\" : \"primary\"}\r\n                                className=\"mx-2 nowrap\"\r\n                                onClick={() => {\r\n                                    if (this.state.selectedCreateNode != fileDirectoryTree) {\r\n                                        this.setState({\r\n                                            selectedCreateNode: fileDirectoryTree\r\n                                        });\r\n                                    }\r\n                                }}>\r\n                                <FontAwesomeIcon icon={faFile} />\r\n                                &nbsp;\r\n                                <FormattedMessage id=\"view.instance.files.create\" />\r\n                            </Button>\r\n                            <OverlayTrigger\r\n                                placement=\"top\"\r\n                                show={\r\n                                    canDeleteDirectories &&\r\n                                    fileDirectoryTree.fullyLoaded &&\r\n                                    fileDirectoryTree.children.length === 0\r\n                                        ? false\r\n                                        : undefined\r\n                                }\r\n                                overlay={props => (\r\n                                    <Tooltip id=\"cant-delete-dir-tooltip\" {...props}>\r\n                                        <FormattedMessage\r\n                                            id={\r\n                                                !fileDirectoryTree.fullyLoaded\r\n                                                    ? \"view.instance.files.delete.directory.populated.unloaded\"\r\n                                                    : canDeleteDirectories\r\n                                                    ? \"view.instance.files.delete.directory.populated\"\r\n                                                    : \"view.instance.files.disallowed.directory.delete\"\r\n                                            }\r\n                                        />\r\n                                    </Tooltip>\r\n                                )}>\r\n                                <Button\r\n                                    variant=\"danger\"\r\n                                    className=\"mx-2 nowrap\"\r\n                                    disabled={\r\n                                        !fileDirectoryTree.fullyLoaded ||\r\n                                        !canDeleteDirectories ||\r\n                                        fileDirectoryTree.children.length > 0 ||\r\n                                        fileDirectoryTree == this.state.rootDirectory\r\n                                    }\r\n                                    onClick={() => {\r\n                                        if (\r\n                                            confirm(\r\n                                                this.props.intl.formatMessage(\r\n                                                    {\r\n                                                        id:\r\n                                                            \"view.instance.files.delete.directory.confirm\"\r\n                                                    },\r\n                                                    { directoryName }\r\n                                                )\r\n                                            )\r\n                                        )\r\n                                            void this.shortAsyncAction(() =>\r\n                                                this.deleteDirectory(fileDirectoryTree)\r\n                                            );\r\n                                    }}>\r\n                                    <FontAwesomeIcon icon={faTimes} />\r\n                                    &nbsp;\r\n                                    <FormattedMessage id=\"view.instance.files.delete.directory\" />\r\n                                </Button>\r\n                            </OverlayTrigger>\r\n                        </React.Fragment>\r\n                    )}\r\n                </div>\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    private renderBrowserlessForms(): React.ReactNode {\r\n        return <WIPNotice />;\r\n    }\r\n}\r\n\r\nFiles.contextType = InstanceEditContext;\r\nexport default injectIntl(Files);\r\n"],"names":["WIPNotice","React","render","className","border","id","href","as","VERSION","MODE","window","location","toString","downloadFileUsingBlob","fileName","fileData","unknownNav","navigator","msSaveOrOpenBlob","a","document","createElement","body","appendChild","fileUrl","URL","createObjectURL","download","click","revokeObjectURL","remove","DirectoryTree","constructor","fileResponse","parent","children","totalFiles","fullyLoaded","this","isDirectory","Files","props","super","state","errors","rootDirectory","loading","selectedFile","selectedCreateNode","createEntity","bind","selectFile","shortAsyncAction","deleteFile","loadDirectory","clearDirectory","addError","error","setState","prevState","Array","from","push","loadRootDir","hasFilesRight","context","instancePermissionSet","ConfigurationRights","path","fileTicket","action","actionPromise","tookTooLong","tooLongPromise","Promise","r","setTimeout","then","race","forceUpdate","dir","response","ConfigurationFileClient","instance","code","StatusCode","parentIndex","indexOf","splice","directory","slice","maxPages","page","payload","totalPages","newChildren","content","map","c","file","doctoredPath","startsWith","substring","lastReadHash","Uint8Array","parentDirectory","confirm","intl","formatMessage","enumerateDirectory","async","directoryResponse","concat","errorEncountered","downloadSingleFile","pathInZip","length","contents","TransferClient","File","resolve","directoriesToEnumerate","fileDownloads","tasks","task","dirInfo","directoryEntry","innerPromiseFunc","all","downloadFiles","fileDownload","zipBlob","downloadZip","blob","index","Math","max","lastIndexOf","settings","inputPromise","input","type","onchange","e","files","target","localFile","arrayBuffer","remoteFilePath","replace","entityName","normalizedRemotePath","newFileNode","find","child","forEach","text","configurationType","ConfigurationType","title","canListDirectories","canWrite","obj","err","key","onClose","prev","newarr","undefined","style","paddingRight","maxHeight","minWidth","overflowY","renderDirectory","maxWidth","padding","renderCreate","renderSelectedFile","renderBrowserlessForms","selected","variant","onClick","icon","faFileAlt","directoryName","faFolderMinus","faFolderPlus","subDir","fields","FieldType","name","tooltip","defaultValue","createNode","onSave","saveMessageId","canRead","fileDirectoryTree","fileIsNotRefreshed","canDeleteDirectories","headerText","replaceAll","downloadDirectory","faDownload","faFile","placement","show","overlay","disabled","deleteDirectory","faTimes","downloadFile","contextType","InstanceEditContext","injectIntl"],"sourceRoot":""}