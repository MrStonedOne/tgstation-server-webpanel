"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[182],{6642:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(7294),i=n(5881),s=n(4012),r=n(6755);class o extends a.Component{render(){return a.createElement(i.Z,{className:"bg-transparent",border:"info"},a.createElement(i.Z.Header,{className:"bg-info text-dark font-weight-bold"},a.createElement(s.Z,{id:"generic.wip"})),a.createElement(i.Z.Body,null,a.createElement(i.Z.Title,null,a.createElement(s.Z,{id:"generic.wip.desc"}),a.createElement("a",{href:"https://github.com/tgstation/Tgstation.Server.ControlPanel/releases/latest"},"https://github.com/tgstation/Tgstation.Server.ControlPanel/releases/latest")),a.createElement(i.Z.Text,{as:"pre",className:"bg-transparent text-info"},a.createElement("code",null,`Version: ${r.q4}\nWebpanel Mode: ${r.IK}\nCurrent route: ${window.location.toString()}`))))}}},2685:function(e,t,n){n.r(t);var a=n(7294),i=n(5977),s=n(8509),r=n(6352),o=n(3803),c=n(6190),l=n(6964),d=n(3e3),m=n(9049),u=n(5619),f=n(8425);class p extends a.Component{constructor(e){super(e),this.editInstance=this.editInstance.bind(this),this.state={errors:[]}}addError(e){this.setState((t=>{const n=Array.from(t.errors);return n.push(e),{errors:n}}))}async editInstance(e){const t=await r.Z.editInstance({...e,id:this.context.instance.id});t.code===o.G.OK?this.context.reloadInstance():this.addError(t.error)}render(){const e=e=>(0,l.D0)((0,l.Zg)(this.context.user),e),t={name:{name:"fields.instance.name",type:m.fS.String,defaultValue:this.context.instance.name,disabled:!e(s.c2.Rename)},path:{name:"fields.instance.path",type:m.fS.String,defaultValue:this.context.instance.path,disabled:!e(s.c2.Relocate)},chatBotLimit:{name:"fields.instance.chatbotlimit",type:m.fS.Number,min:0,defaultValue:this.context.instance.chatBotLimit,disabled:!e(s.c2.SetChatBotLimit)},autoUpdateInterval:{name:"fields.instance.autoupdate",type:m.fS.Number,min:0,defaultValue:this.context.instance.autoUpdateInterval,disabled:!e(s.c2.SetAutoUpdate)},configurationType:{name:"fields.instance.filemode",type:m.fS.Enum,enum:s.c7,defaultValue:this.context.instance.configurationType,disabled:!e(s.c2.SetConfiguration)}};return a.createElement("div",{className:"text-center"},a.createElement(f.t,{obj:this.context}),this.state.errors.map(((e,t)=>{if(e)return a.createElement(d.ZP,{key:t,error:e,onClose:()=>this.setState((e=>{const n=Array.from(e.errors);return n[t]=void 0,{errors:n}}))})})),a.createElement(u.Z,{fields:t,onSave:this.editInstance}))}}p.contextType=c.g,t.default=(0,i.EN)(p)},5921:function(e,t,n){n.r(t),n.d(t,{default:function(){return p}});var a=n(7294),i=n(3204),s=n(3803),r=n(9521),o=n(6190),c=n(1320),l=n(3e3),d=n(3128),m=n(8425),u=n(5855),f=n(9905);function p(){const e=a.useContext(o.g),[t,n]=(0,a.useState)([]),[p,h]=(0,a.useState)([]),[E,v]=(0,a.useState)(!0),[S,y]=(0,a.useState)(c.Mq.jobhistorypage.get(e.instance.id)??1),[b,g]=(0,a.useState)(void 0);function Z(e){h((t=>{const n=Array.from(t);return n.push(e),n}))}async function w(e){const t=await i.Z.deleteJob(e.instanceid,e.id);t.code===s.G.OK?r.Z.fastmode=5:Z(t.error)}return(0,a.useEffect)((()=>{c.Mq.jobhistorypage.set(e.instance.id,S),v(!0),async function(){const t=await i.Z.listJobs(e.instance.id,{page:S});t.code===s.G.OK?(S>t.payload.totalPages&&0!==t.payload.totalPages&&y(1),n(t.payload.content),g(t.payload.totalPages)):Z(t.error),v(!1)}()}),[S,e.instance.id]),(0,a.useEffect)((()=>{}),[p]),E?a.createElement(u.Z,{text:"loading.instance.jobs.list"}):a.createElement("div",null,a.createElement(m.t,{obj:t}),p.map(((e,t)=>{if(e)return a.createElement(l.ZP,{key:t,error:e,onClose:()=>h((e=>{const n=Array.from(e);return n[t]=void 0,n}))})})),t.sort(((e,t)=>t.id-e.id)).filter((e=>!!e.stoppedAt)).map((e=>a.createElement(d.Z,{job:e,key:e.id,onCancel:w}))),a.createElement(f.Z,{selectPage:e=>y(e),totalPages:b??1,currentPage:S}))}},6046:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});var a,i=n(7294),s=n(7977),r=n(5005),o=n(5293),c=n(3489),l=n(4012),d=n(7179),m=n(8509),u=n(3803),f=n(9521),p=n(6190),h=n(6964),E=n(3e3),v=n(9635),S=n(9049),y=n(5619),b=n(8425),g=n(5855),Z=n(6642);function w(){const e=(0,i.useContext)(p.g),[t,n]=(0,i.useState)(),[w,x]=(0,i.useState)(!1),P=(0,i.useState)([]);async function C(){if(!(0,h.mg)(e.instancePermissionSet,m.py.ReadMetadata))return n({});const t=await d.Z.getWatchdogStatus(e.instance.id);t.code===u.G.ERROR?(0,E.iT)(P,t.error):n(t.payload)}async function N(t){x(!0);const n=await d.Z.updateWatchdogStatus(e.instance.id,t);n.code===u.G.ERROR&&(0,E.iT)(P,n.error),await C(),x(!1)}if((0,i.useEffect)((()=>{C()}),[e.instance.id]),!t)return i.createElement(i.Fragment,null,(0,E.hP)(P));if(w)return i.createElement(g.Z,null);const R={autoStart:{type:S.fS.Boolean,name:"fields.instance.watchdog.autostart",defaultValue:t.autoStart,disabled:!(0,h.mg)(e.instancePermissionSet,m.py.SetAutoStart)},port:{type:S.fS.Number,name:"fields.instance.watchdog.port",defaultValue:t.port,min:0,max:65535,disabled:!(0,h.mg)(e.instancePermissionSet,m.py.SetPort)},visibility:{type:S.fS.Enum,name:"fields.instance.watchdog.visibility",defaultValue:t.visibility,enum:m.Ye,disabled:!(0,h.mg)(e.instancePermissionSet,m.py.SetVisibility)},securityLevel:{type:S.fS.Enum,name:"fields.instance.watchdog.securitylevel",defaultValue:t.securityLevel,enum:m.ns,disabled:!(0,h.mg)(e.instancePermissionSet,m.py.SetSecurity)},startupTimeout:{type:S.fS.Number,name:"fields.instance.watchdog.timeout.startup",defaultValue:t.startupTimeout,min:0,disabled:!(0,h.mg)(e.instancePermissionSet,m.py.SetStartupTimeout)},topicRequestTimeout:{type:S.fS.Number,name:"fields.instance.watchdog.timeout.topic",defaultValue:t.topicRequestTimeout,min:0,disabled:!(0,h.mg)(e.instancePermissionSet,m.py.SetTopicTimeout)},heartbeatSeconds:{type:S.fS.Number,name:"fields.instance.watchdog.heartbeat",defaultValue:t.heartbeatSeconds,min:0,disabled:!(0,h.mg)(e.instancePermissionSet,m.py.SetHeartbeatInterval)},allowWebClient:{type:S.fS.Boolean,name:"fields.instance.watchdog.allowwebclient",defaultValue:t.allowWebClient,disabled:!(0,h.mg)(e.instancePermissionSet,m.py.SetWebClient)},additionalParameters:{type:S.fS.String,name:"fields.instance.watchdog.additionalparams",defaultValue:t.additionalParameters,disabled:!(0,h.mg)(e.instancePermissionSet,m.py.SetAdditionalParameters)}},O=Object.values(R).some((e=>!e.disabled)),I=i.createElement(c.Z,{id:"generic.no_perm"},i.createElement(l.Z,{id:"generic.no_perm"})),T=(0,h.mg)(e.instancePermissionSet,m.py.Start),k=(0,h.mg)(e.instancePermissionSet,m.py.Shutdown),K=(0,h.mg)(e.instancePermissionSet,m.py.Restart),V=(0,h.mg)(e.instancePermissionSet,m.py.CreateDump),_=(0,h.mg)(e.instancePermissionSet,m.py.ReadMetadata),A=(0,h.mg)(e.instancePermissionSet,m.py.SoftShutdown)||(0,h.mg)(e.instancePermissionSet,m.py.SoftRestart),D=T||k||K||V;return i.createElement("div",null,i.createElement(b.t,{obj:t}),(0,E.hP)(P),i.createElement("h2",{className:"text-center"},i.createElement(l.Z,{id:"view.instance.server.status"}),i.createElement(s.Z,{pill:!0,variant:t.status===m.Ni.Online?"success":t.status===m.Ni.Offline?"danger":"warning"},i.createElement(l.Z,{id:`view.instance.server.status.${m.Ni[t.status]}`}))),i.createElement("hr",null),i.createElement("h3",{className:"text-center"},i.createElement(l.Z,{id:"view.instance.server.settings"})),_?null:O?i.createElement(v.Z,{title:"view.instance.server.no_metadata"}):i.createElement(v.Z,{title:"view.instance.server.no_metadata_and_no_settings"}),i.createElement(y.Z,{fields:R,onSave:N,hideDisabled:!_}),i.createElement("hr",null),i.createElement("h3",{className:"text-center"},i.createElement(l.Z,{id:"view.instance.server.actions"})),D?i.createElement(i.Fragment,null,_?null:i.createElement(v.Z,{title:"view.instance.server.no_metadata_actions"}),i.createElement("div",{className:"text-center mb-3"},i.createElement(o.Z,{overlay:I,show:!T&&void 0},i.createElement(r.Z,{variant:"success",className:"mx-2",onClick:async function(){x(!0);const t=await d.Z.startWatchdog(e.instance.id);t.code===u.G.ERROR?(0,E.iT)(P,t.error):(f.Z.registerCallback(t.payload.id,(()=>{C()})),f.Z.fastmode=5,await C()),x(!1)},disabled:_&&t.status!=m.Ni.Offline||!T},i.createElement(l.Z,{id:"view.instance.server.start"}))),i.createElement(o.Z,{overlay:I,show:!k&&void 0},i.createElement(r.Z,{variant:"danger",className:"mx-2",onClick:async function(){x(!0);const t=await d.Z.stopWatchdog(e.instance.id);t.code===u.G.ERROR?(0,E.iT)(P,t.error):await C(),x(!1)},disabled:_&&t.status!=m.Ni.Online||!k},i.createElement(l.Z,{id:"view.instance.server.stop"}))),i.createElement(o.Z,{overlay:I,show:!K&&void 0},i.createElement(r.Z,{variant:"warning",className:"mx-2",onClick:async function(){x(!0);const t=await d.Z.restartWatchdog(e.instance.id);t.code===u.G.ERROR?(0,E.iT)(P,t.error):(f.Z.registerCallback(t.payload.id,(()=>{C()})),f.Z.fastmode=5,await C()),x(!1)},disabled:_&&t.status!=m.Ni.Online||!K},i.createElement(l.Z,{id:"view.instance.server.restart"}))),i.createElement(o.Z,{overlay:I,show:!V&&void 0},i.createElement(r.Z,{variant:"info",className:"mx-2",onClick:async function(){x(!0);const t=await d.Z.dumpWatchdog(e.instance.id);t.code===u.G.ERROR?(0,E.iT)(P,t.error):f.Z.fastmode=5,x(!1)},disabled:_&&t.status!=m.Ni.Online||!V},i.createElement(l.Z,{id:"view.instance.server.dump"}))))):i.createElement(v.Z,{title:"view.instance.server.no_actions"}),!_&&A?i.createElement(v.Z,{title:"view.instance.server.no_metadata_graceful"}):null,_||A?i.createElement("div",{className:"w-75 mx-auto"},i.createElement(S.ZP,{name:"view.instance.graceful",type:S.fS.Enum,enum:a,tooltip:"view.instance.graceful.desc",defaultValue:t.softRestart?a.Restart:t.softShutdown?a.Stop:a.None,disabled:!A,onChange:e=>{switch(e){case a.None:if(!t?.softRestart&&!t?.softShutdown)return;N({softShutdown:!t.softShutdown&&void 0,softRestart:!t.softRestart&&void 0});break;case a.Stop:if(t?.softShutdown)return;N({softShutdown:!0});break;case a.Restart:if(t?.softRestart)return;N({softRestart:!0})}}})):D?i.createElement(v.Z,{title:"view.instance.server.no_graceful"}):null,i.createElement("hr",null),i.createElement("h3",{className:"text-center"},i.createElement(l.Z,{id:"view.instance.server.deployment_info"})),i.createElement(Z.Z,null))}!function(e){e[e.None=0]="None",e[e.Stop=1]="Stop",e[e.Restart=2]="Restart"}(a||(a={}))},9182:function(e,t,n){n.r(t);var a=n(7814),i=n(7294),s=n(5881),r=n(3361),o=n(6841),c=n(4012),l=n(5977),d=n(8509),m=n(6352),u=n(5870),f=n(3803),p=n(7961),h=n(4615),E=n(6190),v=n(1320),S=n(7888),y=n(5855),b=n(6642),g=n(161),Z=n(2685),w=n(5921),x=n(247),P=n(6046);const C=d.D8.ReadActive|d.D8.ListInstalled|d.D8.InstallOfficialOrChangeActiveVersion|d.D8.InstallCustomVersion,N=d.py.SetPort|d.py.SetAutoStart|d.py.SetSecurity|d.py.ReadMetadata|d.py.SetWebClient|d.py.SoftRestart|d.py.SoftShutdown|d.py.Restart|d.py.Shutdown|d.py.Start|d.py.SetStartupTimeout|d.py.SetHeartbeatInterval|d.py.CreateDump|d.py.SetTopicTimeout|d.py.SetAdditionalParameters|d.py.SetVisibility;class R extends i.Component{constructor(e){super(e),this.reloadInstance=this.reloadInstance.bind(this),this.deleteContextError=this.deleteContextError.bind(this),v.Mq.selectedinstanceid=parseInt(this.props.match.params.id),this.state={tab:e.match.params.tab??R.tabs[0][0],errors:new Set,instance:null,instancePermissionSet:null,reloadInstance:this.reloadInstance,deleteError:this.deleteContextError,instanceid:parseInt(this.props.match.params.id)}}deleteContextError(e){this.setState((t=>{const n=new Set(t.errors);return n.delete(e),{errors:n}}))}async componentDidMount(){await this.reloadInstance()}componentDidUpdate(e){this.props.match.params.tab&&e.match.params.tab!=this.props.match.params.tab&&this.setState({tab:this.props.match.params.tab})}async reloadInstance(){this.setState({instance:null,instancePermissionSet:null});const e=await m.Z.getInstance(this.state.instanceid);if(e.code===f.G.OK){this.setState({instance:e.payload});const t=await u.Z.getCurrentInstancePermissionSet(this.state.instanceid);t.code===f.G.OK?this.setState({instancePermissionSet:t.payload}):this.setState((e=>{const n=new Set(e.errors);return n.add(t.error),{instancePermissionSet:null,errors:n}}))}else this.setState((t=>{const n=new Set(t.errors);return n.add(e.error),{instance:null,errors:n}}))}render(){if(!this.state.instance||!this.state.instancePermissionSet)return i.createElement(y.Z,{text:"loading.instance"});return i.createElement(E.g.Provider,{value:Object.assign({user:this.context.user,serverInfo:this.context.serverInfo},this.state)},i.createElement(s.Z,null,i.createElement(s.Z.Header,{className:"text-center mb-2 sticky-top"},i.createElement("h3",null,i.createElement(c.Z,{id:"view.instanceedit.title",values:{instanceid:this.props.match.params.id,instancename:this.state.instance.name}})),i.createElement("h5",{className:"text-white-50"},i.createElement(c.Z,{id:`view.instanceedit.tabs.${this.state.tab}`}))),i.createElement(o.Z.Container,{mountOnEnter:!0,unmountOnExit:!0,id:"instanceedit",activeKey:this.state.tab},i.createElement("div",{className:"d-flex flex-row"},i.createElement(s.Z.Body,{className:"flex-grow-0"},(()=>i.createElement(r.Z,{defaultActiveKey:this.state.tab,onSelect:e=>{e=e??R.tabs[0][0],v.Mq.selectedinstanceedittab=e,this.props.history.push(v.$w.instanceedit.link??v.$w.instanceedit.route),this.setState({tab:e??R.tabs[0][0]})},fill:!0,variant:"pills",activeKey:this.state.tab,className:"flex-nowrap text-nowrap flex-column hover-bar sticky-top "+(p.ZP.instanceeditsidebar.value===p.mf.COLLAPSE?"pin-close":p.ZP.instanceeditsidebar.value===p.mf.EXPAND?"pin-open":""),style:{top:"8em"}},R.tabs.map((([e,t,n,s])=>{if(!this.state.instancePermissionSet)throw Error("this.state.instancePermissionSet is null in instanceedit nav map");const o=!s,l=!n(this.state.instancePermissionSet,this.context);return i.createElement(r.Z.Item,{key:e},i.createElement(r.Z.Link,{eventKey:e,bsPrefix:"nav-link instanceedittab",className:(o?"no-access text-white":"")+(l?"no-access text-white font-italic":"")+" text-left"},i.createElement(i.Fragment,null,i.createElement(a.G,{icon:l?"lock":t,fixedWidth:!0}),i.createElement("div",{className:"tab-text d-inline-block "+(l?"font-weight-lighter":"")},i.createElement("span",{className:"pl-1"},i.createElement(c.Z,{id:`view.instanceedit.tabs.${e}`}))))))}))))()),i.createElement(s.Z.Body,{className:"bg-body"},i.createElement(o.Z.Content,null,R.tabs.map((([e,,t,n])=>{if(!this.state.instancePermissionSet)throw Error("this.state.instancePermissionSet is null in render card map");return i.createElement(o.Z.Pane,{eventKey:e,key:e},n?t(this.state.instancePermissionSet,this.context)?i.createElement(n,null):i.createElement(S.Z,null):i.createElement(b.Z,null))}))))))))}}R.tabs=[["info","info",()=>!0],["repository","code-branch",()=>!0,x.default],["deployment","hammer",()=>!0],["dd","server",e=>!!(e.dreamDaemonRights&N),P.default],["byond","list-ul",e=>!!(e.byondRights&C),g.default],["chatbots","comments",()=>!0],["files","folder-open",()=>!0],["users","users",()=>!0],["jobs","stream",()=>!0,w.default],["config","cogs",()=>!0,Z.default]],R.contextType=h.f,t.default=(0,l.EN)(R)},6841:function(e,t,n){var a=n(1721),i=n(7294),s=n(7184),r=n(8752),o=n(5103),c=function(e){function t(){return e.apply(this,arguments)||this}return(0,a.Z)(t,e),t.prototype.render=function(){throw new Error("ReactBootstrap: The `Tab` component is not meant to be rendered! It's an abstract component that is only valid as a direct Child of the `Tabs` Component. For custom tabs components use TabPane and TabsContainer directly")},t}(i.Component);c.Container=s.Z,c.Content=r.Z,c.Pane=o.Z,t.Z=c},7184:function(e,t,n){var a=n(7294),i=n(4289),s=n(4426),r=n(5017);t.Z=function(e){var t=(0,i.Ch)(e,{activeKey:"onSelect"}),n=t.id,o=t.generateChildId,c=t.onSelect,l=t.activeKey,d=t.transition,m=t.mountOnEnter,u=t.unmountOnExit,f=t.children,p=(0,a.useMemo)((function(){return o||function(e,t){return n?n+"-"+t+"-"+e:null}}),[n,o]),h=(0,a.useMemo)((function(){return{onSelect:c,activeKey:l,transition:d,mountOnEnter:m||!1,unmountOnExit:u||!1,getControlledId:function(e){return p(e,"tabpane")},getControllerId:function(e){return p(e,"tab")}}}),[c,l,d,m,u,p]);return a.createElement(s.Z.Provider,{value:h},a.createElement(r.Z.Provider,{value:c||null},f))}},8752:function(e,t,n){var a=n(7462),i=n(3366),s=n(4184),r=n.n(s),o=n(7294),c=n(6792),l=["bsPrefix","as","className"],d=o.forwardRef((function(e,t){var n=e.bsPrefix,s=e.as,d=void 0===s?"div":s,m=e.className,u=(0,i.Z)(e,l),f=(0,c.vE)(n,"tab-content");return o.createElement(d,(0,a.Z)({ref:t},u,{className:r()(m,f)}))}));t.Z=d},5103:function(e,t,n){var a=n(7462),i=n(3366),s=n(4184),r=n.n(s),o=n(7294),c=n(6792),l=n(4426),d=n(5017),m=n(9280),u=["activeKey","getControlledId","getControllerId"],f=["bsPrefix","className","active","onEnter","onEntering","onEntered","onExit","onExiting","onExited","mountOnEnter","unmountOnExit","transition","as","eventKey"];var p=o.forwardRef((function(e,t){var n=function(e){var t=(0,o.useContext)(l.Z);if(!t)return e;var n=t.activeKey,s=t.getControlledId,r=t.getControllerId,c=(0,i.Z)(t,u),f=!1!==e.transition&&!1!==c.transition,p=(0,d.h)(e.eventKey);return(0,a.Z)({},e,{active:null==e.active&&null!=p?(0,d.h)(n)===p:e.active,id:s(e.eventKey),"aria-labelledby":r(e.eventKey),transition:f&&(e.transition||c.transition||m.Z),mountOnEnter:null!=e.mountOnEnter?e.mountOnEnter:c.mountOnEnter,unmountOnExit:null!=e.unmountOnExit?e.unmountOnExit:c.unmountOnExit})}(e),s=n.bsPrefix,p=n.className,h=n.active,E=n.onEnter,v=n.onEntering,S=n.onEntered,y=n.onExit,b=n.onExiting,g=n.onExited,Z=n.mountOnEnter,w=n.unmountOnExit,x=n.transition,P=n.as,C=void 0===P?"div":P,N=(n.eventKey,(0,i.Z)(n,f)),R=(0,c.vE)(s,"tab-pane");if(!h&&!x&&w)return null;var O=o.createElement(C,(0,a.Z)({},N,{ref:t,role:"tabpanel","aria-hidden":!h,className:r()(p,R,{active:h})}));return x&&(O=o.createElement(x,{in:h,onEnter:E,onEntering:v,onEntered:S,onExit:y,onExiting:b,onExited:g,mountOnEnter:Z,unmountOnExit:w},O)),o.createElement(l.Z.Provider,{value:null},o.createElement(d.Z.Provider,{value:null},O))}));p.displayName="TabPane",t.Z=p}}]);
//# sourceMappingURL=182.02480eeb109a075bb2a8.bundle.js.map