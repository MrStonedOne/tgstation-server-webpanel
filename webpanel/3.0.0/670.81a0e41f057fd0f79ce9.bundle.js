"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[670],{8425:function(e,t,a){a.d(t,{t:function(){return c}});var s=a(7294),r=a(5171),n=a.n(r),i=a(7961);function l(e){return s.createElement(n(),{src:e.obj,name:"JSON",theme:"tube",iconStyle:"triangle",collapsed:!0,displayDataTypes:!1})}function c(e){return i.ZP.showjson.value?s.createElement("div",{className:"text-left"},s.createElement(l,{obj:e.obj})):s.createElement(s.Fragment,null)}},9905:function(e,t,a){a.d(t,{Z:function(){return _}});var s=a(7814),r=a(7294),n=a(5005),i=a(2258),l=a(5293),c=a(7462),o=a(3366),m=a(4184),p=a.n(m),d=a(6792),h=a(8358),u=["active","disabled","className","style","activeLabel","children"],g=["children"],E=r.forwardRef((function(e,t){var a=e.active,s=e.disabled,n=e.className,i=e.style,l=e.activeLabel,m=e.children,d=(0,o.Z)(e,u),g=a||s?"span":h.Z;return r.createElement("li",{ref:t,style:i,className:p()(n,"page-item",{active:a,disabled:s})},r.createElement(g,(0,c.Z)({className:"page-link",disabled:s},d),m,a&&l&&r.createElement("span",{className:"sr-only"},l)))}));E.defaultProps={active:!1,disabled:!1,activeLabel:"(current)"},E.displayName="PageItem";var v=E;function f(e,t,a){function s(e){var s=e.children,n=(0,o.Z)(e,g);return r.createElement(E,n,r.createElement("span",{"aria-hidden":"true"},s||t),r.createElement("span",{className:"sr-only"},a))}return void 0===a&&(a=e),s.displayName=e,s}var P=f("First","\xab"),b=f("Prev","\u2039","Previous"),Z=f("Ellipsis","\u2026","More"),y=f("Next","\u203a"),N=f("Last","\xbb"),w=["bsPrefix","className","children","size"],x=r.forwardRef((function(e,t){var a=e.bsPrefix,s=e.className,n=e.children,i=e.size,l=(0,o.Z)(e,w),m=(0,d.vE)(a,"pagination");return r.createElement("ul",(0,c.Z)({ref:t},l,{className:p()(s,m,i&&m+"-"+i)}),n)}));x.First=P,x.Prev=b,x.Ellipsis=Z,x.Item=v,x.Next=y,x.Last=N;var k=x,C=(a(5638),["as","bsPrefix","className","children"]),S=r.forwardRef((function(e,t){var a=e.as,s=void 0===a?"div":a,n=e.bsPrefix,i=e.className,l=e.children,m=(0,o.Z)(e,C);return n=(0,d.vE)(n,"popover-header"),r.createElement(s,(0,c.Z)({ref:t},m,{className:p()(n,i)}),l)})),I=["as","bsPrefix","className","children"],O=r.forwardRef((function(e,t){var a=e.as,s=void 0===a?"div":a,n=e.bsPrefix,i=e.className,l=e.children,m=(0,o.Z)(e,I);return n=(0,d.vE)(n,"popover-body"),r.createElement(s,(0,c.Z)({ref:t},m,{className:p()(i,n)}),l)})),M=["bsPrefix","placement","className","style","children","content","arrowProps","popper","show"],j=r.forwardRef((function(e,t){var a=e.bsPrefix,s=e.placement,n=e.className,i=e.style,l=e.children,m=e.content,h=e.arrowProps,u=(e.popper,e.show,(0,o.Z)(e,M)),g=(0,d.vE)(a,"popover"),E=((null==s?void 0:s.split("-"))||[])[0];return r.createElement("div",(0,c.Z)({ref:t,role:"tooltip",style:i,"x-placement":E,className:p()(n,g,E&&"bs-popover-"+E)},u),r.createElement("div",(0,c.Z)({className:"arrow"},h)),m?r.createElement(O,null,l):l)}));j.defaultProps={placement:"right"},j.Title=S,j.Content=O;var A=j,G=a(4012);function R(){return R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},R.apply(this,arguments)}class _ extends r.PureComponent{constructor(e){super(e),this.state={showGoto:!1,gotoValue:e.currentPage}}render(){const e=[],t=Math.max(this.props.totalPages-this.props.currentPage-1,0),a=Math.max(this.props.currentPage-2,0),c=Math.max(this.props.currentPage-Math.max(5-Number(this.props.currentPage!==this.props.totalPages)-t,2),2),o=Math.min(this.props.currentPage+Math.max(5-Number(1!==this.props.currentPage)-a,2),this.props.totalPages-1);for(let t=c;t<=o;t++)e.push(r.createElement(k.Item,{key:t,active:t===this.props.currentPage,onClick:()=>this.props.selectPage(t)},t));const m=this.props.totalPages>7?r.createElement(k.Ellipsis,{disabled:!0}):null,p=r.createElement(A,{id:"popover-gotopage"},r.createElement(A.Title,null,r.createElement(G.Z,{id:"generic.goto.title"})),r.createElement(A.Content,null,r.createElement("form",{className:"d-flex",onSubmit:e=>{e.preventDefault(),this.props.selectPage(this.state.gotoValue),this.setState({showGoto:!1})}},r.createElement(i.Z.Control,{className:"mr-2",type:"number",min:1,max:this.props.totalPages,value:this.state.gotoValue,onChange:e=>this.setState({gotoValue:parseInt(e.target.value)}),custom:!0}),r.createElement(n.Z,{type:"submit"},r.createElement(G.Z,{id:"generic.goto"}))))),{selectPage:d,totalPages:h,currentPage:u,...g}=this.props;return r.createElement("div",R({className:"text-center",style:{position:"sticky",bottom:"1.5em"}},g),r.createElement(k,{className:"justify-content-center"},r.createElement(k.Prev,{disabled:this.props.currentPage<=1,onClick:()=>this.props.selectPage(Math.max(this.props.currentPage-1,1))}),r.createElement(k.Item,{active:this.props.currentPage<=1,onClick:()=>this.props.selectPage(1)},"1"),m,e,m,this.props.totalPages>=2?r.createElement(k.Item,{active:this.props.currentPage>=this.props.totalPages,onClick:()=>this.props.selectPage(this.props.totalPages)},this.props.totalPages):null,this.props.totalPages>7?r.createElement(l.Z,{show:this.state.showGoto,placement:"top",overlay:p},r.createElement(k.Item,{onClick:()=>this.setState((e=>({showGoto:!e.showGoto})))},r.createElement(s.G,{icon:"search"}))):null,r.createElement(k.Next,{disabled:this.props.currentPage>=this.props.totalPages,onClick:()=>this.props.selectPage(Math.min(this.props.currentPage+1,this.props.totalPages))})))}}},670:function(e,t,a){a.r(t);var s=a(98),r=a(7814),n=a(7294),i=a(7977),l=a(5005),c=a(5293),o=a(5147),m=a(3489),p=a(4012),d=a(5977),h=a(1249),u=a(8509),g=a(6352),E=a(5870),v=a(6846),f=a(3803),P=a(5631),b=a(4615),Z=a(6964),y=a(1320),N=a(3e3),w=a(8425),x=a(5855),k=a(9905);function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},C.apply(this,arguments)}class S extends n.Component{constructor(e){super(e),this.setOnline=this.setOnline.bind(this),this.state={loading:!0,instances:[],errors:[],page:y.Mq.instancelistpage??1}}addError(e){this.setState((t=>{const a=Array.from(t.errors);return a.push(e),{errors:a}}))}async componentDidUpdate(e,t){t.page!==this.state.page&&(y.Mq.instancelistpage=this.state.page,await this.loadInstances())}async loadInstances(){this.setState({loading:!0});const e=await g.Z.listInstances({page:this.state.page}),t=await P.Z.getServerInfo(),a=t.code===f.G.OK&&(0,h.satisfies)(t.payload.apiVersion,"<9.1.0"),s=[];if(e.code==f.G.OK){if(this.state.page>e.payload.totalPages&&0!==e.payload.totalPages)return void this.setState({page:1});const t=[];for(const r of e.payload.content){const e=r;a?r.online?t.push(E.Z.getCurrentInstancePermissionSet(r.id).then((t=>{t.code==f.G.OK?e.canAccess=!0:(e.canAccess=!1,t.error.code!==v.jK.HTTP_ACCESS_DENIED&&this.addError(t.error)),s.push(e)}))):(e.canAccess=!1,s.push(e)):(e.canAccess=e.online&&e.accessible,s.push(e))}await Promise.all(t),this.setState({instances:s.sort(((e,t)=>e.id-t.id)),maxPage:e.payload.totalPages})}else this.addError(e.error);this.setState({loading:!1})}async componentDidMount(){await this.loadInstances()}async setOnline(e){const t=!e.online,a=await g.Z.editInstance({id:e.id,online:t});a.code===f.G.OK?await this.loadInstances():this.addError(a.error)}render(){if(this.state.loading)return n.createElement(x.Z,{text:"loading.instance.list"});const e=!!((0,Z.Zg)(this.context.user).instanceManagerRights&u.c2.SetOnline),t={verticalAlign:"middle"};return n.createElement("div",{className:"text-center"},n.createElement(w.t,{obj:this.state.instances}),this.state.errors.map(((e,t)=>{if(e)return n.createElement(N.ZP,{key:t,error:e,onClose:()=>this.setState((e=>{const a=Array.from(e.errors);return a[t]=void 0,{errors:a}}))})})),n.createElement("h3",null,n.createElement(p.Z,{id:"view.instance.list.title"})),n.createElement(o.Z,{striped:!0,bordered:!0,hover:!0,variant:"dark",responsive:!0,className:"mb-4"},n.createElement("thead",null,n.createElement("tr",null,n.createElement("th",null,"#"),n.createElement("th",null,n.createElement(p.Z,{id:"generic.name"})),n.createElement("th",null,n.createElement(p.Z,{id:"generic.online"})),n.createElement("th",null,n.createElement(p.Z,{id:"generic.path"})),n.createElement("th",null,n.createElement(p.Z,{id:"generic.configmode"})),n.createElement("th",null,n.createElement(p.Z,{id:"generic.action"})))),n.createElement("tbody",null,this.state.instances.map((a=>n.createElement("tr",{key:a.id},n.createElement("td",{style:t},a.id),n.createElement("td",{style:t},a.name),n.createElement("td",{style:t},a.online?n.createElement(i.Z,{variant:"success"},n.createElement(p.Z,{id:"generic.online"})):n.createElement(i.Z,{variant:"danger"},n.createElement(p.Z,{id:"generic.offline"}))),n.createElement("td",{style:t},a.moveJob?n.createElement(p.Z,{id:"view.instance.moving"}):a.path),n.createElement("td",{style:t},n.createElement(p.Z,{id:`view.instance.configmode.${a.configurationType.toString()}`})),n.createElement("td",{className:"align-middle p-1",style:t},n.createElement(l.Z,{className:"mx-1",onClick:()=>{y.Mq.selectedinstanceid=a.id,this.props.history.push(y.$w.instanceedit.link??y.$w.instanceedit.route)},disabled:!a.canAccess},n.createElement(p.Z,{id:"generic.edit"})),n.createElement(l.Z,{className:"mx-1",variant:a.online?"danger":"success",onClick:()=>this.setOnline(a),disabled:!e},n.createElement(p.Z,{id:"view.instance.list.set."+(a.online?"offline":"online")})))))))),n.createElement(k.Z,{selectPage:e=>this.setState({page:e}),totalPages:this.state.maxPage??1,currentPage:this.state.page}),n.createElement("div",{className:"align-middle"},n.createElement("div",{className:"mb-4"},this.renderAddInstance()),n.createElement(l.Z,{className:"mx-1",onClick:()=>{this.props.history.push(y.$w.instancejobs.link??y.$w.instancejobs.route)}},n.createElement(p.Z,{id:"routes.instancejobs"}))))}renderAddInstance(){const e=!!((0,Z.Zg)(this.context.user).instanceManagerRights&u.c2.Create);return n.createElement(c.Z,{overlay:n.createElement(m.Z,{id:"create-instance-tooltip"},n.createElement(p.Z,{id:"perms.instance.create.warning"})),show:!e&&void 0},(({ref:t,...a})=>n.createElement(l.Z,C({ref:t,className:"mx-1",variant:"success",onClick:()=>{this.props.history.push(y.$w.instancecreate.link??y.$w.instancecreate.route)},disabled:!e},a),n.createElement("div",null,n.createElement(r.G,{className:"mr-2",icon:s.r8}),n.createElement(p.Z,{id:"routes.instancecreate"})))))}}S.contextType=b.f,t.default=(0,d.EN)(S)},7977:function(e,t,a){var s=a(7462),r=a(3366),n=a(4184),i=a.n(n),l=a(7294),c=a(6792),o=["bsPrefix","variant","pill","className","as"],m=l.forwardRef((function(e,t){var a=e.bsPrefix,n=e.variant,m=e.pill,p=e.className,d=e.as,h=void 0===d?"span":d,u=(0,r.Z)(e,o),g=(0,c.vE)(a,"badge");return l.createElement(h,(0,s.Z)({ref:t},u,{className:i()(p,g,m&&g+"-pill",n&&g+"-"+n)}))}));m.displayName="Badge",m.defaultProps={pill:!1},t.Z=m},5147:function(e,t,a){var s=a(7462),r=a(3366),n=a(4184),i=a.n(n),l=a(7294),c=a(6792),o=["bsPrefix","className","striped","bordered","borderless","hover","size","variant","responsive"],m=l.forwardRef((function(e,t){var a=e.bsPrefix,n=e.className,m=e.striped,p=e.bordered,d=e.borderless,h=e.hover,u=e.size,g=e.variant,E=e.responsive,v=(0,r.Z)(e,o),f=(0,c.vE)(a,"table"),P=i()(n,f,g&&f+"-"+g,u&&f+"-"+u,m&&f+"-striped",p&&f+"-bordered",d&&f+"-borderless",h&&f+"-hover"),b=l.createElement("table",(0,s.Z)({},v,{className:P,ref:t}));if(E){var Z=f+"-responsive";return"string"==typeof E&&(Z=Z+"-"+E),l.createElement("div",{className:Z},b)}return b}));t.Z=m}}]);
//# sourceMappingURL=670.81a0e41f057fd0f79ce9.bundle.js.map