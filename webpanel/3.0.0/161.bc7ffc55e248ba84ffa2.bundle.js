"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[161],{9905:function(e,t,n){n.d(t,{Z:function(){return D}});var r=n(7462),a=n(3366),s=n(1721),i=n(7814),o=n(7294),c=n(5005),l=n(2258),u=n(5293),m=n(4184),p=n.n(m),d=n(6792),h=n(8358),f=["active","disabled","className","style","activeLabel","children"],v=["children"],g=o.forwardRef((function(e,t){var n=e.active,s=e.disabled,i=e.className,c=e.style,l=e.activeLabel,u=e.children,m=(0,a.Z)(e,f),d=n||s?"span":h.Z;return o.createElement("li",{ref:t,style:c,className:p()(i,"page-item",{active:n,disabled:s})},o.createElement(d,(0,r.Z)({className:"page-link",disabled:s},m),u,n&&l&&o.createElement("span",{className:"sr-only"},l)))}));g.defaultProps={active:!1,disabled:!1,activeLabel:"(current)"},g.displayName="PageItem";var E=g;function P(e,t,n){function r(e){var r=e.children,s=(0,a.Z)(e,v);return o.createElement(g,s,o.createElement("span",{"aria-hidden":"true"},r||t),o.createElement("span",{className:"sr-only"},n))}return void 0===n&&(n=e),r.displayName=e,r}var x=P("First","\xab"),b=P("Prev","\u2039","Previous"),Z=P("Ellipsis","\u2026","More"),y=P("Next","\u203a"),w=P("Last","\xbb"),N=["bsPrefix","className","children","size"],k=o.forwardRef((function(e,t){var n=e.bsPrefix,s=e.className,i=e.children,c=e.size,l=(0,a.Z)(e,N),u=(0,d.vE)(n,"pagination");return o.createElement("ul",(0,r.Z)({ref:t},l,{className:p()(s,u,c&&u+"-"+c)}),i)}));k.First=x,k.Prev=b,k.Ellipsis=Z,k.Item=E,k.Next=y,k.Last=w;var V=k,S=(n(5638),["as","bsPrefix","className","children"]),C=o.forwardRef((function(e,t){var n=e.as,s=void 0===n?"div":n,i=e.bsPrefix,c=e.className,l=e.children,u=(0,a.Z)(e,S);return i=(0,d.vE)(i,"popover-header"),o.createElement(s,(0,r.Z)({ref:t},u,{className:p()(i,c)}),l)})),_=["as","bsPrefix","className","children"],F=o.forwardRef((function(e,t){var n=e.as,s=void 0===n?"div":n,i=e.bsPrefix,c=e.className,l=e.children,u=(0,a.Z)(e,_);return i=(0,d.vE)(i,"popover-body"),o.createElement(s,(0,r.Z)({ref:t},u,{className:p()(c,i)}),l)})),A=["bsPrefix","placement","className","style","children","content","arrowProps","popper","show"],G=o.forwardRef((function(e,t){var n=e.bsPrefix,s=e.placement,i=e.className,c=e.style,l=e.children,u=e.content,m=e.arrowProps,h=(e.popper,e.show,(0,a.Z)(e,A)),f=(0,d.vE)(n,"popover"),v=((null==s?void 0:s.split("-"))||[])[0];return o.createElement("div",(0,r.Z)({ref:t,role:"tooltip",style:c,"x-placement":v,className:p()(i,f,v&&"bs-popover-"+v)},h),o.createElement("div",(0,r.Z)({className:"arrow"},m)),u?o.createElement(F,null,l):l)}));G.defaultProps={placement:"right"},G.Title=C,G.Content=F;var I=G,M=n(4012),R=["selectPage","totalPages","currentPage"],D=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={showGoto:!1,gotoValue:t.currentPage},n}return(0,s.Z)(t,e),t.prototype.render=function(){for(var e=this,t=[],n=Math.max(this.props.totalPages-this.props.currentPage-1,0),s=Math.max(this.props.currentPage-2,0),m=Math.max(this.props.currentPage-Math.max(5-Number(this.props.currentPage!==this.props.totalPages)-n,2),2),p=Math.min(this.props.currentPage+Math.max(5-Number(1!==this.props.currentPage)-s,2),this.props.totalPages-1),d=function(n){t.push(o.createElement(V.Item,{key:n,active:n===e.props.currentPage,onClick:function(){return e.props.selectPage(n)}},n))},h=m;h<=p;h++)d(h);var f=this.props.totalPages>7?o.createElement(V.Ellipsis,{disabled:!0}):null,v=o.createElement(I,{id:"popover-gotopage"},o.createElement(I.Title,null,o.createElement(M.Z,{id:"generic.goto.title"})),o.createElement(I.Content,null,o.createElement("form",{className:"d-flex",onSubmit:function(t){t.preventDefault(),e.props.selectPage(e.state.gotoValue),e.setState({showGoto:!1})}},o.createElement(l.Z.Control,{className:"mr-2",type:"number",min:1,max:this.props.totalPages,value:this.state.gotoValue,onChange:function(t){return e.setState({gotoValue:parseInt(t.target.value)})},custom:!0}),o.createElement(c.Z,{type:"submit"},o.createElement(M.Z,{id:"generic.goto"}))))),g=this.props,E=(g.selectPage,g.totalPages,g.currentPage,(0,a.Z)(g,R));return o.createElement("div",(0,r.Z)({className:"text-center",style:{position:"sticky",bottom:"1.5em"}},E),o.createElement(V,{className:"justify-content-center"},o.createElement(V.Prev,{disabled:this.props.currentPage<=1,onClick:function(){return e.props.selectPage(Math.max(e.props.currentPage-1,1))}}),o.createElement(V.Item,{active:this.props.currentPage<=1,onClick:function(){return e.props.selectPage(1)}},"1"),f,t,f,this.props.totalPages>=2?o.createElement(V.Item,{active:this.props.currentPage>=this.props.totalPages,onClick:function(){return e.props.selectPage(e.props.totalPages)}},this.props.totalPages):null,this.props.totalPages>7?o.createElement(u.Z,{show:this.state.showGoto,placement:"top",overlay:v},o.createElement(V.Item,{onClick:function(){return e.setState((function(e){return{showGoto:!e.showGoto}}))}},o.createElement(i.G,{icon:"search"}))):null,o.createElement(V.Next,{disabled:this.props.currentPage>=this.props.totalPages,onClick:function(){return e.props.selectPage(Math.min(e.props.currentPage+1,e.props.totalPages))}})))},t}(o.PureComponent)},161:function(e,t,n){n.r(t);var r=n(7462),a=n(3366),s=n(5861),i=n(1721),o=n(7757),c=n.n(o),l=n(7814),u=n(7294),m=n(5005),p=n(2258),d=n(4716),h=n(2318),f=n(5293),v=n(3489),g=n(4012),E=n(6222),P=n(8509),x=n(6846),b=n(3803),Z=n(6190),y=n(6964),w=n(1320),N=n(3e3),k=n(9635),V=n(8425),S=n(5855),C=n(9905),_=["ref"],F=function(e){function t(t){var n,r;return(r=e.call(this,t)||this).state={versions:[],errors:[],activeVersion:"",latestVersion:"",selectedVersion:"",loading:!0,page:null!=(n=w.Mq.byondlistpage)?n:1},r}(0,i.Z)(t,e);var n=t.prototype;return n.addError=function(e){this.setState((function(t){var n=Array.from(t.errors);return n.push(e),{errors:n}}))},n.loadVersions=function(){var e=(0,s.Z)(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,y.n5)(this.context.instancePermissionSet,P.D8.ListInstalled)){e.next=12;break}return e.next=3,E.Z.listAllVersions(this.context.instance.id,{page:this.state.page});case 3:if((t=e.sent).code!==b.G.OK){e.next=11;break}if(!(this.state.page>t.payload.totalPages&&0!==t.payload.totalPages)){e.next=8;break}return this.setState({page:1}),e.abrupt("return");case 8:this.setState({versions:t.payload.content,maxPage:t.payload.totalPages}),e.next=12;break;case 11:this.addError(t.error);case 12:if(!(0,y.n5)(this.context.instancePermissionSet,P.D8.ReadActive)){e.next=17;break}return e.next=15,E.Z.getActiveVersion(this.context.instance.id);case 15:(n=e.sent).code===b.G.OK?this.setState({activeVersion:n.payload.version}):this.addError(n.error);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.componentDidUpdate=function(){var e=(0,s.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.page===this.state.page){e.next=4;break}return w.Mq.byondlistpage=this.state.page,e.next=4,this.loadVersions();case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.componentDidMount=function(){var e=(0,s.Z)(c().mark((function e(){var t=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadVersions();case 2:fetch("https://secure.byond.com/download/version.txt").then((function(e){return e.text()})).then((function(e){return e.split("\n")})).then((function(e){return e[0]})).then((function(e){t.setState({latestVersion:e,selectedVersion:e,loading:!1})})).catch((function(e){t.addError(new x.ZP(x.jK.APP_FAIL,{jsError:Error(e)})),t.setState({loading:!1})}));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.render=function(){var e,t=this;if(this.state.loading)return u.createElement(S.Z,{text:"loading.instance"});var n=(0,y.n5)(this.context.instancePermissionSet,P.D8.ListInstalled),i=(0,y.n5)(this.context.instancePermissionSet,P.D8.ReadActive),o=(0,y.n5)(this.context.instancePermissionSet,P.D8.InstallCustomVersion),x=(0,y.n5)(this.context.instancePermissionSet,P.D8.InstallOfficialOrChangeActiveVersion),Z=function(e){return e?u.createElement(v.Z,{id:e},u.createElement(g.Z,{id:e})):u.createElement(u.Fragment,null)};return u.createElement("div",{className:"text-center"},u.createElement(V.t,{obj:this.state.versions}),u.createElement("h1",null,u.createElement(g.Z,{id:"view.instance.byond"})),this.state.errors.map((function(e,n){if(e)return u.createElement(N.ZP,{key:n,error:e,onClose:function(){return t.setState((function(e){var t=Array.from(e.errors);return t[n]=void 0,{errors:t}}))}})})),n?u.createElement(u.Fragment,null,i?null:u.createElement(k.Z,{title:"view.instance.byond.current_denied"}),u.createElement("div",{onChange:function(){var e=(0,s.Z)(c().mark((function e(n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setState({loading:!0}),e.next=3,E.Z.switchActive(t.context.instance.id,n.target.value);case 3:if((r=e.sent).code!==b.G.OK){e.next=9;break}return e.next=7,t.loadVersions();case 7:e.next=10;break;case 9:t.addError(r.error);case 10:t.setState({loading:!1});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},this.state.versions.map((function(e){return u.createElement(h.Z,{className:"w-md-25 mb-1 mx-auto d-flex",key:e.version},x||i?u.createElement(h.Z.Prepend,null,u.createElement(h.Z.Radio,{name:"byond",id:e.version,value:e.version,disabled:!x,defaultChecked:e.version===t.state.activeVersion})):null,u.createElement("label",{className:"flex-grow-1 m-0",htmlFor:e.version},u.createElement(f.Z,{overlay:Z("view.instance.byond.custom"),show:!e.version.endsWith(".0")&&void 0},(function(t){var n=t.ref,s=(0,a.Z)(t,_);return u.createElement(h.Z.Text,(0,r.Z)({className:"w-100"},s),e.version.endsWith(".0")?e.version.substr(0,e.version.length-2):e.version,e.version.endsWith(".0")?null:u.createElement("div",{className:"ml-auto",ref:n},u.createElement(l.G,{fixedWidth:!0,icon:"info"})))}))))}))),u.createElement(C.Z,{className:"mt-4",selectPage:function(e){return t.setState({page:e})},totalPages:null!=(e=this.state.maxPage)?e:1,currentPage:this.state.page})):i?u.createElement(u.Fragment,null,u.createElement(k.Z,{title:"view.instance.byond.list_denied"}),u.createElement(g.Z,{id:"view.instance.byond.current_version",values:{version:this.state.activeVersion}})):u.createElement(k.Z,{title:"view.instance.byond.current_and_list_denied"}),u.createElement("hr",null),u.createElement("h4",null,u.createElement(g.Z,{id:"view.instance.byond.add"})),u.createElement(h.Z,{className:"w-md-50 w-lg-25 mb-3 mx-auto"},u.createElement(d.Z,{type:"number",defaultValue:this.state.latestVersion.split(".")[0],onChange:function(e){t.setState((function(t){var n=t.selectedVersion.split(".");return n[0]=e.target.value,{selectedVersion:n.join(".")}}))}}),u.createElement(h.Z.Text,{className:"rounded-0"},"."),u.createElement(d.Z,{type:"number",defaultValue:this.state.latestVersion.split(".")[1],onChange:function(e){t.setState((function(t){var n=t.selectedVersion.split(".");return n[1]=e.target.value,{selectedVersion:n.join(".")}}))}}),u.createElement(h.Z.Append,null,u.createElement(f.Z,{overlay:Z("generic.no_perm"),show:!x&&void 0},u.createElement(m.Z,{variant:x?"success":"danger",disabled:!x,onClick:(0,s.Z)(c().mark((function e(){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.setState({loading:!0}),e.t0=E.Z,e.t1=t.context.instance.id,e.t2=t.state.selectedVersion,!t.state.customFile){e.next=10;break}return e.next=7,t.state.customFile.arrayBuffer();case 7:e.t3=e.sent,e.next=11;break;case 10:e.t3=void 0;case 11:return e.t4=e.t3,e.next=14,e.t0.switchActive.call(e.t0,e.t1,e.t2,e.t4);case 14:if((n=e.sent).code!==b.G.ERROR){e.next=19;break}t.addError(n.error),e.next=22;break;case 19:return t.setState({customFile:null}),e.next=22,t.loadVersions();case 22:t.setState({loading:!1});case 23:case"end":return e.stop()}}),e)})))},u.createElement(l.G,{icon:"plus"}))))),u.createElement(p.Z,null,u.createElement(f.Z,{overlay:Z("generic.no_perm"),show:!o&&void 0},u.createElement(p.Z.File,{custom:!0,id:"test",disabled:!o,className:"w-md-50 w-lg-25 text-left",label:this.state.customFile?this.state.customFile.name:u.createElement(g.Z,{id:"view.instance.byond.upload"}),accept:".zip",onChange:function(e){t.setState({customFile:e.target.files?e.target.files[0]:null})}}))))},t}(u.Component);F.contextType=Z.g,t.default=F}}]);
//# sourceMappingURL=161.bc7ffc55e248ba84ffa2.bundle.js.map