"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[182],{161:function(e,t,a){a.r(t);var n=a(51436),i=a(67814),s=a(67294),r=a(35005),o=a(32258),l=a(94716),c=a(62318),d=a(15293),m=a(43489),u=a(44012),p=a(76222),h=a(48509),f=a(96846),g=a(53803),S=a(39521),y=a(96190),v=a(16964),E=a(1320),b=a(3e3),w=a(9635),Z=a(8425),x=a(35855),P=a(89929);function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},C.apply(this,arguments)}class R extends s.Component{constructor(e){super(e),this.state={versions:[],errors:[],activeVersion:"",latestVersion:"",selectedVersion:"",loading:!0,page:E.Mq.byondlistpage??1}}addError(e){this.setState((t=>{const a=Array.from(t.errors);return a.push(e),{errors:a}}))}async loadVersions(){if((0,v.n5)(this.context.instancePermissionSet,h.D8.ListInstalled)){const e=await p.Z.listAllVersions(this.context.instance.id,{page:this.state.page});if(e.code===g.G.OK){if(this.state.page>e.payload.totalPages&&0!==e.payload.totalPages)return void this.setState({page:1});this.setState({versions:e.payload.content,maxPage:e.payload.totalPages})}else this.addError(e.error)}if((0,v.n5)(this.context.instancePermissionSet,h.D8.ReadActive)){const e=await p.Z.getActiveVersion(this.context.instance.id);e.code===g.G.OK?this.setState({activeVersion:e.payload.version}):this.addError(e.error)}}async switchVersion(e,t){this.setState({loading:!0});const a=await p.Z.switchActive(this.context.instance.id,e,t&&this.state.customFile?await this.state.customFile.arrayBuffer():void 0);a.code===g.G.ERROR?this.addError(a.error):(t&&this.setState({customFile:null}),a.payload.installJob?(S.Z.registerJob(a.payload.installJob,this.context.instance.id),S.Z.registerCallback(a.payload.installJob.id,(()=>{this.loadVersions()}))):await this.loadVersions()),this.setState({loading:!1})}async componentDidUpdate(e,t){t.page!==this.state.page&&(E.Mq.byondlistpage=this.state.page,await this.loadVersions())}async componentDidMount(){await this.loadVersions(),fetch("https://secure.byond.com/download/version.txt").then((e=>e.text())).then((e=>e.split("\n"))).then((e=>e[0])).then((e=>{this.setState({latestVersion:e,selectedVersion:e,loading:!1})})).catch((e=>{this.addError(new f.ZP(f.jK.APP_FAIL,{jsError:Error(e)})),this.setState({loading:!1})}))}render(){if(this.state.loading)return s.createElement(x.Z,{text:"loading.byond"});const e=(0,v.n5)(this.context.instancePermissionSet,h.D8.ListInstalled),t=(0,v.n5)(this.context.instancePermissionSet,h.D8.ReadActive),a=(0,v.n5)(this.context.instancePermissionSet,h.D8.InstallCustomVersion),f=(0,v.n5)(this.context.instancePermissionSet,h.D8.InstallOfficialOrChangeActiveVersion),y=(0,v.n5)(this.context.instancePermissionSet,h.D8.DeleteInstall),E=e=>e?s.createElement(m.Z,{id:e},s.createElement(u.Z,{id:e})):s.createElement(s.Fragment,null);return s.createElement("div",{className:"text-center"},s.createElement(Z.t,{obj:this.state.versions}),s.createElement("h1",null,s.createElement(u.Z,{id:"view.instance.byond"})),this.state.errors.map(((e,t)=>{if(e)return s.createElement(b.ZP,{key:t,error:e,onClose:()=>this.setState((e=>{const a=Array.from(e.errors);return a[t]=void 0,{errors:a}}))})})),e?s.createElement(s.Fragment,null,t?null:s.createElement(w.Z,{title:"view.instance.byond.current_denied"}),s.createElement("div",null,this.state.versions.map((e=>s.createElement(c.Z,{className:"w-md-25 mb-1 mx-auto d-flex",key:e.version},f||t?s.createElement(c.Z.Prepend,null,s.createElement(c.Z.Radio,{name:"byond",id:e.version,value:e.version,disabled:!f,checked:e.version===this.state.activeVersion,onChange:async()=>{await this.switchVersion(e.version,!1)}})):null,s.createElement("label",{className:"flex-grow-1 m-0",htmlFor:e.version},s.createElement(d.Z,{overlay:E("view.instance.byond.custom"),show:!e.version.endsWith(".0")&&void 0},(({ref:t,...a})=>s.createElement(c.Z.Text,C({className:"w-100"},a),e.version.endsWith(".0")?e.version.substr(0,e.version.length-2):e.version,e.version.endsWith(".0")?null:s.createElement("div",{className:"ml-auto",ref:t},s.createElement(i.G,{fixedWidth:!0,icon:"info"})))))),e.version!==this.state.activeVersion?s.createElement(c.Z.Append,null,s.createElement(d.Z,{overlay:E("generic.no_perm"),show:!y&&void 0},s.createElement(r.Z,{variant:"danger",disabled:!y,onClick:async()=>{this.setState({loading:!0});const t=await p.Z.deleteVersion(this.context.instance.id,e.version);t.code===g.G.ERROR?this.addError(t.error):(S.Z.registerJob(t.payload,this.context.instance.id),S.Z.registerCallback(t.payload.id,(()=>{this.loadVersions()}))),this.setState({loading:!1})}},s.createElement(i.G,{icon:n.$aW})))):null)))),s.createElement(P.Z,{className:"mt-4",selectPage:e=>this.setState({page:e}),totalPages:this.state.maxPage??1,currentPage:this.state.page})):t?s.createElement(s.Fragment,null,s.createElement(w.Z,{title:"view.instance.byond.list_denied"}),s.createElement(u.Z,{id:"view.instance.byond.current_version",values:{version:this.state.activeVersion}})):s.createElement(w.Z,{title:"view.instance.byond.current_and_list_denied"}),s.createElement("hr",null),s.createElement("h4",null,s.createElement(u.Z,{id:"view.instance.byond.add"})),s.createElement(c.Z,{className:"w-md-50 w-lg-25 mb-3 mx-auto"},s.createElement(l.Z,{type:"number",defaultValue:this.state.latestVersion.split(".")[0],onChange:e=>{this.setState((t=>{const a=t.selectedVersion.split(".");return a[0]=e.target.value,{selectedVersion:a.join(".")}}))}}),s.createElement(c.Z.Text,{className:"rounded-0"},"."),s.createElement(l.Z,{type:"number",defaultValue:this.state.latestVersion.split(".")[1],onChange:e=>{this.setState((t=>{const a=t.selectedVersion.split(".");return a[1]=e.target.value,{selectedVersion:a.join(".")}}))}}),s.createElement(c.Z.Append,null,s.createElement(d.Z,{overlay:E("generic.no_perm"),show:!f&&void 0},s.createElement(r.Z,{variant:"success",disabled:!f,onClick:async()=>{await this.switchVersion(this.state.selectedVersion,!0)}},s.createElement(i.G,{icon:n.r8p}))))),s.createElement(o.Z,null,s.createElement(d.Z,{overlay:E("generic.no_perm"),show:!a&&void 0},s.createElement(o.Z.File,{custom:!0,id:"test",disabled:!a,className:"w-md-50 w-lg-25 text-left",label:this.state.customFile?this.state.customFile.name:s.createElement(u.Z,{id:"view.instance.byond.upload"}),accept:".zip",onChange:e=>{this.setState({customFile:e.target.files?e.target.files[0]:null})}}))))}}R.contextType=y.g,t.default=R},62685:function(e,t,a){a.r(t);var n=a(67294),i=a(44012),s=a(5977),r=a(48509),o=a(76352),l=a(53803),c=a(39521),d=a(96190),m=a(16964),u=a(3e3),p=a(79049),h=a(35619),f=a(8425),g=a(35855);class S extends n.Component{constructor(e){super(e),this.editInstance=this.editInstance.bind(this),this.state={errors:[],moving:!1}}addError(e){this.setState((t=>{const a=Array.from(t.errors);return a.push(e),{errors:a}}))}async editInstance(e){const t=this.context.instance.id;let a;e.path&&e.path!=this.context.instance.path&&(a=e.path,e.path=null,e.online=!1,this.setState({moving:!0}));const n=await o.Z.editInstance({...e,id:t});if(n.code!==l.G.OK)return this.addError(n.error),void this.setState({moving:!1});if(a){const e=await o.Z.editInstance({id:this.context.instance.id,path:a});if(e.code!==l.G.OK)return this.addError(e.error),this.setState({moving:!1}),void await this.context.reloadInstance();let n;do{if(await new Promise((e=>setTimeout(e,1e3))),n=await o.Z.getInstance(t),n.code!==l.G.OK)return this.addError(n.error),this.setState({moving:!1}),void await this.context.reloadInstance()}while(n.payload.moveJob);const i=await o.Z.editInstance({online:!0,id:t});i.code!==l.G.OK?(this.addError(i.error),this.setState({moving:!1})):c.Z.registerJob(e.payload.moveJob,t)}await this.context.reloadInstance()}render(){const e=e=>(0,m.D0)((0,m.Zg)(this.context.user),e),t={name:{name:"fields.instance.name",type:p.fS.String,defaultValue:this.context.instance.name,disabled:!e(r.c2.Rename)},path:{name:"fields.instance.path",type:p.fS.String,defaultValue:this.context.instance.path,disabled:!e(r.c2.Relocate)},chatBotLimit:{name:"fields.instance.chatbotlimit",type:p.fS.Number,min:0,defaultValue:this.context.instance.chatBotLimit,disabled:!e(r.c2.SetChatBotLimit)},autoUpdateInterval:{name:"fields.instance.autoupdate",type:p.fS.Number,min:0,defaultValue:this.context.instance.autoUpdateInterval,disabled:!e(r.c2.SetAutoUpdate)},configurationType:{name:"fields.instance.filemode",type:p.fS.Enum,enum:r.c7,defaultValue:this.context.instance.configurationType,disabled:!e(r.c2.SetConfiguration)}};return n.createElement("div",{className:"text-center"},n.createElement("h1",null,n.createElement(i.Z,{id:"view.instance.info"})),n.createElement(f.t,{obj:this.context}),this.state.errors.map(((e,t)=>{if(e)return n.createElement(u.ZP,{key:t,error:e,onClose:()=>this.setState((e=>{const a=Array.from(e.errors);return a[t]=void 0,{errors:a}}))})})),this.state.moving?n.createElement(g.Z,{text:"loading.instance.move"}):n.createElement(h.Z,{fields:t,onSave:this.editInstance}))}}S.contextType=d.g,t.default=(0,s.EN)(S)},44298:function(e,t,a){a.r(t),a.d(t,{Deployment:function(){return E}});var n=a(67294),i=a(35005),s=a(44012),r=a(25856),o=a(48509),l=a(53803),c=a(39521),d=a(96190),m=a(16964),u=a(93918),p=a(3e3),h=a(9635),f=a(79049),g=a(35619),S=a(8425),y=a(35855),v=a(72741);function E(){const e=(0,n.useContext)(d.g),t=(0,n.useState)([]),[a,E]=(0,n.useState)(!0),[b,w]=(0,n.useState)(null),[Z,x]=(0,n.useState)(null),[P,C]=(0,n.useState)(1),[R,V]=(0,n.useState)(0),[N,I]=(0,n.useState)(5),O=(0,m.$A)(e.instancePermissionSet,o.xb.Read),A=(0,m.$A)(e.instancePermissionSet,o.xb.Compile),k=(0,m.$A)(e.instancePermissionSet,o.xb.CompileJobs);async function T(){if(!O)return E(!1);E(!0);const a=await r.Z.getDeployInfo(e.instance.id);E(!1),a.code===l.G.OK?w(a.payload):(0,p.iT)(t,a.error)}async function D(a){if(!k)return;x(null);const n=await r.Z.listCompileJobs(e.instance.id,{page:a,pageSize:N});n.code===l.G.OK?(N||I(n.payload.pageSize),V(n.payload.totalPages),C(a),x(n.payload.content)):(0,p.iT)(t,n.error)}let _;(0,n.useEffect)((()=>{T(),D(1)}),[e.instance.id]);const G=/(?:(?<days>\d+)\.)?(?<hours>\d+):(?<minutes>\d+):(?<seconds>\d+)/.exec(b?.timeout??"");if(G){const e=G.groups;_=60*(24*parseInt(e.days??0)+parseInt(e.hours))+parseInt(e.minutes)+parseInt(e.seconds)/60}const M={projectName:{type:f.fS.String,name:"fields.instance.deploy.projectname",tooltip:"fields.instance.deploy.projectname.desc",defaultValue:b?.projectName,disabled:!(0,m.$A)(e.instancePermissionSet,o.xb.SetDme)},timeout:{type:f.fS.Number,name:"fields.instance.deploy.timeout",tooltip:"fields.instance.deploy.timeout.desc",defaultValue:_,disabled:!(0,m.$A)(e.instancePermissionSet,o.xb.SetTimeout)},apiValidationPort:{type:f.fS.Number,min:0,max:65535,name:"fields.instance.deploy.apiport",tooltip:"fields.instance.deploy.apiport.desc",defaultValue:b?.apiValidationPort,disabled:!(0,m.$A)(e.instancePermissionSet,o.xb.SetApiValidationPort)},apiValidationSecurityLevel:{type:f.fS.Enum,enum:o.ns,name:"fields.instance.deploy.seclevel",tooltip:"fields.instance.deploy.seclevel.desc",defaultValue:b?.apiValidationSecurityLevel,disabled:!(0,m.$A)(e.instancePermissionSet,o.xb.SetSecurityLevel)},requireDMApiValidation:{type:f.fS.Boolean,name:"fields.instance.deploy.validateapi",tooltip:"fields.instance.deploy.validateapi.desc",defaultValue:b?.requireDMApiValidation,disabled:!(0,m.$A)(e.instancePermissionSet,o.xb.SetApiValidationRequirement)}};let j=null;const J={currentPage:P,totalPages:R,loadPage:D,pageSize:N??0};return k?Z&&(j={viewDataType:u.a.CompileJobs,compileJobs:Z,paging:J}):j={viewDataType:u.a.CompileJobs,paging:J},n.createElement("div",{className:"text-center"},n.createElement(S.t,{obj:{deployInfo:b}}),(0,p.hP)(t),k?n.createElement(u.Z,{viewData:j}):n.createElement(h.Z,{title:"view.instance.no_compile_jobs"}),n.createElement("hr",null),n.createElement("h3",null,n.createElement(s.Z,{id:"view.instance.deploy.title"})),O?null:n.createElement(h.Z,{title:"view.instance.no_metadata"}),a?n.createElement(y.Z,{text:"loading.deployments"}):n.createElement(n.Fragment,null,n.createElement(g.Z,{hideDisabled:!O,fields:M,onSave:async a=>{let n;if(a.timeout){const e=Math.floor(a.timeout/1440);a.timeout-=1440*e;const t=Math.floor(a.timeout/60);a.timeout-=60*t;const i=Math.floor(a.timeout);a.timeout-=i;const s=Math.floor(60*a.timeout);n=e?`${e}.${t}:${i}:${s}`:`${t}:${i}:${s}`}const i={...a,timeout:n};E(!0);const s=await r.Z.updateDeployInfo(e.instance.id,i);s.code===l.G.ERROR?(0,p.iT)(t,s.error):await T(),E(!1)}}),n.createElement("hr",null),n.createElement(v.Z,{tooltipid:"generic.no_perm",show:!A&&void 0},n.createElement(i.Z,{disabled:!A,onClick:async()=>{const a=await r.Z.startCompile(e.instance.id);a.code===l.G.ERROR?(0,p.iT)(t,a.error):(c.Z.registerJob(a.payload,e.instance.id),c.Z.fastmode=5)}},n.createElement(s.Z,{id:"view.instance.deploy.deploy"})))))}},25921:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var n=a(67294),i=a(23204),s=a(53803),r=a(39521),o=a(96190),l=a(1320),c=a(3e3),d=a(93128),m=a(8425),u=a(35855),p=a(89929);function h(){const e=n.useContext(o.g),[t,a]=(0,n.useState)([]),[h,f]=(0,n.useState)([]),[g,S]=(0,n.useState)(!0),[y,v]=(0,n.useState)(l.Mq.jobhistorypage.get(e.instance.id)??1),[E,b]=(0,n.useState)(void 0);function w(e){f((t=>{const a=Array.from(t);return a.push(e),a}))}async function Z(e){const t=await i.Z.deleteJob(e.instanceId,e.id);t.code===s.G.OK?r.Z.fastmode=5:w(t.error)}return(0,n.useEffect)((()=>{l.Mq.jobhistorypage.set(e.instance.id,y),S(!0),async function(){const t=await i.Z.listJobs(e.instance.id,{page:y});t.code===s.G.OK?(y>t.payload.totalPages&&0!==t.payload.totalPages&&v(1),a(t.payload.content),b(t.payload.totalPages)):w(t.error),S(!1)}()}),[y,e.instance.id]),(0,n.useEffect)((()=>{}),[h]),g?n.createElement(u.Z,{text:"loading.instance.jobs.list"}):n.createElement("div",null,n.createElement(m.t,{obj:t}),h.map(((e,t)=>{if(e)return n.createElement(c.ZP,{key:t,error:e,onClose:()=>f((e=>{const a=Array.from(e);return a[t]=void 0,a}))})})),t.sort(((e,t)=>t.id-e.id)).filter((e=>!!e.stoppedAt)).map((e=>n.createElement(d.Z,{job:e,key:e.id,onCancel:Z}))),n.createElement(p.Z,{selectPage:e=>v(e),totalPages:E??1,currentPage:y}))}},86046:function(e,t,a){a.r(t);var n,i=a(67294),s=a(27977),r=a(35005),o=a(15293),l=a(43489),c=a(44012),d=a(74806),m=a(81249),u=a(7179),p=a(48509),h=a(53803),f=a(39521),g=a(96190),S=a(16964),y=a(93918),v=a(3e3),E=a(9635),b=a(79049),w=a(35619),Z=a(8425),x=a(35855);!function(e){e[e.None=0]="None",e[e.Stop=1]="Stop",e[e.Restart=2]="Restart"}(n||(n={})),t.default=(0,d.ZP)((function(e){const t=(0,i.useContext)(g.g),[a,d]=(0,i.useState)(),[P,C]=(0,i.useState)(!1),R=(0,i.useState)([]);async function V(){if(!(0,S.mg)(t.instancePermissionSet,p.py.ReadMetadata))return d({});const e=await u.Z.getWatchdogStatus(t.instance.id);e.code===h.G.ERROR?(0,v.iT)(R,e.error):d(e.payload)}async function N(e){C(!0);const a=await u.Z.updateWatchdogStatus(t.instance.id,e);a.code===h.G.ERROR&&(0,v.iT)(R,a.error),await V(),C(!1)}if((0,i.useEffect)((()=>{V()}),[t.instance.id]),!a)return i.createElement(i.Fragment,null,(0,v.hP)(R));if(P)return i.createElement(x.Z,null);const I={autoStart:{type:b.fS.Boolean,name:"fields.instance.watchdog.autostart",defaultValue:a.autoStart,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetAutoStart)},startProfiler:{type:b.fS.Boolean,name:"fields.instance.watchdog.autostartprofiler",defaultValue:a.startProfiler,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetProfiler)},logOutput:{type:b.fS.Boolean,name:"fields.instance.watchdog.logoutput",defaultValue:a.logOutput,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetLogOutput)},port:{type:b.fS.Number,name:"fields.instance.watchdog.port",defaultValue:a.port,min:0,max:65535,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetPort)},visibility:{type:b.fS.Enum,name:"fields.instance.watchdog.visibility",defaultValue:a.visibility,enum:p.Ye,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetVisibility)},securityLevel:{type:b.fS.Enum,name:"fields.instance.watchdog.securitylevel",defaultValue:a.securityLevel,enum:p.ns,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetSecurity)},startupTimeout:{type:b.fS.Number,name:"fields.instance.watchdog.timeout.startup",defaultValue:a.startupTimeout,min:0,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetStartupTimeout)},topicRequestTimeout:{type:b.fS.Number,name:"fields.instance.watchdog.timeout.topic",defaultValue:a.topicRequestTimeout,min:0,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetTopicTimeout)},healthCheckSeconds:{type:b.fS.Number,name:"fields.instance.watchdog.healthcheck",defaultValue:a.healthCheckSeconds,min:0,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetHealthCheckInterval)},dumpOnHealthCheckRestart:{type:b.fS.Boolean,name:"fields.instance.watchdog.dumpOnHealthCheckRestart",defaultValue:a.dumpOnHealthCheckRestart,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.CreateDump)},allowWebClient:{type:b.fS.Boolean,name:"fields.instance.watchdog.allowwebclient",defaultValue:a.allowWebClient,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetWebClient)},additionalParameters:{type:b.fS.String,name:"fields.instance.watchdog.additionalparams",defaultValue:a.additionalParameters,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetAdditionalParameters)},mapThreads:{type:b.fS.Number,name:"fields.instance.watchdog.mapthreads",defaultValue:a.mapThreads,disabled:!(0,S.mg)(t.instancePermissionSet,p.py.SetMapThreads)}},O=Object.values(I).some((e=>!e.disabled)),A=i.createElement(l.Z,{id:"generic.no_perm"},i.createElement(c.Z,{id:"generic.no_perm"})),k=(0,S.mg)(t.instancePermissionSet,p.py.Start),T=(0,S.mg)(t.instancePermissionSet,p.py.Shutdown),D=(0,S.mg)(t.instancePermissionSet,p.py.Restart),_=(0,S.mg)(t.instancePermissionSet,p.py.CreateDump),G=(0,S.mg)(t.instancePermissionSet,p.py.ReadMetadata),M=(0,S.mg)(t.instancePermissionSet,p.py.SoftShutdown)||(0,S.mg)(t.instancePermissionSet,p.py.SoftRestart),j=k||T||D||_,J=!(0,S.mg)(t.instancePermissionSet,p.py.BroadcastMessage)||G&&(a.status!==p.Ni.Online||null!=a.activeCompileJob?.dmApiVersion&&!(0,m.gte)(a.activeCompileJob?.dmApiVersion,"5.7.0")),$={message:{type:b.fS.String,name:"fields.instance.watchdog.broadcast",defaultValue:"",disabled:J,tooltip:"fields.instance.watchdog.broadcast.desc"}},K=(0,S.mg)(t.instancePermissionSet,p.py.ReadRevision);let L=null;return a&&(L={viewDataType:y.a.Watchdog,activeCompileJob:a.activeCompileJob,stagedCompileJob:a.stagedCompileJob}),i.createElement("div",{className:"text-center"},i.createElement(Z.t,{obj:a}),(0,v.hP)(R),i.createElement("h2",{className:"text-center"},i.createElement(c.Z,{id:"view.instance.server.status"}),i.createElement(s.Z,{pill:!0,variant:a.status===p.Ni.Online?"success":a.status===p.Ni.Offline?"danger":"warning"},i.createElement(c.Z,{id:`view.instance.server.status.${p.Ni[a.status]}`}))),i.createElement("hr",null),K?i.createElement(y.Z,{viewData:L}):i.createElement(E.Z,{title:"view.instance.no_compile_jobs"}),i.createElement("hr",null),i.createElement("h3",{className:"text-center"},i.createElement(c.Z,{id:"view.instance.server.settings"})),G?null:O?i.createElement(E.Z,{title:"view.instance.no_metadata"}):i.createElement(E.Z,{title:"view.instance.server.no_metadata_and_no_settings"}),i.createElement(w.Z,{fields:I,onSave:N,hideDisabled:!G}),i.createElement("hr",null),i.createElement("h3",{className:"text-center"},i.createElement(c.Z,{id:"view.instance.server.actions"})),j?i.createElement(i.Fragment,null,G?null:i.createElement(E.Z,{title:"view.instance.server.no_metadata_actions"}),i.createElement("div",{className:"text-center mb-3"},i.createElement(o.Z,{overlay:A,show:!k&&void 0},i.createElement(r.Z,{variant:"success",className:"mx-2",onClick:async function(){C(!0);const e=await u.Z.startWatchdog(t.instance.id);e.code===h.G.ERROR?(0,v.iT)(R,e.error):(f.Z.registerCallback(e.payload.id,(()=>{V()})),f.Z.fastmode=5,await V()),C(!1)},disabled:G&&a.status!=p.Ni.Offline||!k},i.createElement(c.Z,{id:"view.instance.server.start"}))),i.createElement(o.Z,{overlay:A,show:!T&&void 0},i.createElement(r.Z,{variant:"danger",className:"mx-2",onClick:async function(){if(!confirm(e.intl.formatMessage({id:"view.instance.server.prompt.stop"})))return;C(!0);const a=await u.Z.stopWatchdog(t.instance.id);a.code===h.G.ERROR?(0,v.iT)(R,a.error):await V(),C(!1)},disabled:G&&a.status==p.Ni.Offline||!T},i.createElement(c.Z,{id:"view.instance.server.stop"}))),i.createElement(o.Z,{overlay:A,show:!D&&void 0},i.createElement(r.Z,{variant:"warning",className:"mx-2",onClick:async function(){if(!confirm(e.intl.formatMessage({id:"view.instance.server.prompt.restart"})))return;C(!0);const a=await u.Z.restartWatchdog(t.instance.id);a.code===h.G.ERROR?(0,v.iT)(R,a.error):(f.Z.registerCallback(a.payload.id,(()=>{V()})),f.Z.fastmode=5,await V()),C(!1)},disabled:G&&a.status==p.Ni.Offline||!D},i.createElement(c.Z,{id:"view.instance.server.restart"}))),i.createElement(o.Z,{overlay:A,show:!_&&void 0},i.createElement(r.Z,{variant:"info",className:"mx-2",onClick:async function(){C(!0);const e=await u.Z.dumpWatchdog(t.instance.id);e.code===h.G.ERROR?(0,v.iT)(R,e.error):f.Z.fastmode=5,C(!1)},disabled:G&&a.status!=p.Ni.Online||!_},i.createElement(c.Z,{id:"view.instance.server.dump"}))))):i.createElement(E.Z,{title:"view.instance.server.no_actions"}),!G&&M?i.createElement(E.Z,{title:"view.instance.server.no_metadata_graceful"}):null,G||M?i.createElement("div",{className:"w-75 mx-auto"},i.createElement(b.ZP,{name:"view.instance.graceful",type:b.fS.Enum,enum:n,tooltip:"view.instance.graceful.desc",defaultValue:a.softRestart?n.Restart:a.softShutdown?n.Stop:n.None,disabled:!M,onChange:e=>{switch(e){case n.None:if(!a?.softRestart&&!a?.softShutdown)return;N({softShutdown:!a.softShutdown&&void 0,softRestart:!a.softRestart&&void 0});break;case n.Stop:if(a?.softShutdown)return;N({softShutdown:!0});break;case n.Restart:if(a?.softRestart)return;N({softRestart:!0})}}})):j?i.createElement(E.Z,{title:"view.instance.server.no_graceful"}):null,i.createElement("div",{className:"w-75 mx-auto"},i.createElement("br",null),i.createElement(w.Z,{fields:$,onSave:e=>{N({broadcastMessage:e.message})},saveMessageId:"view.instance.server.broadcast"})))}))},9182:function(e,t,a){a.r(t);var n=a(67814),i=a(67294),s=a(15881),r=a(13361),o=a(56841),l=a(44012),c=a(5977),d=a(48509),m=a(76352),u=a(75870),p=a(53803),h=a(27961),f=a(44615),g=a(96190),S=a(1320),y=a(97888),v=a(35855),E=a(66642),b=a(161),w=a(90740),Z=a(62685),x=a(44298),P=a(20926),C=a(87345),R=a(25921),V=a(18264),N=a(86046);const I=d.D8.ReadActive|d.D8.ListInstalled|d.D8.InstallOfficialOrChangeActiveVersion|d.D8.InstallCustomVersion,O=d.py.SetPort|d.py.SetAutoStart|d.py.SetSecurity|d.py.ReadMetadata|d.py.SetWebClient|d.py.SoftRestart|d.py.SoftShutdown|d.py.Restart|d.py.Shutdown|d.py.Start|d.py.SetStartupTimeout|d.py.SetHealthCheckInterval|d.py.CreateDump|d.py.SetTopicTimeout|d.py.SetAdditionalParameters|d.py.SetVisibility,A=d.nX.SetOrigin|d.nX.SetSha|d.nX.MergePullRequest|d.nX.UpdateBranch|d.nX.ChangeCommitter|d.nX.ChangeTestMergeCommits|d.nX.ChangeCredentials|d.nX.SetReference|d.nX.Read|d.nX.ChangeAutoUpdateSettings|d.nX.Delete|d.nX.ChangeSubmoduleUpdate,k=d.xb.Read|d.xb.Compile|d.xb.SetApiValidationPort|d.xb.SetDme|d.xb.SetApiValidationRequirement|d.xb.SetTimeout|d.xb.SetSecurityLevel,T=d.xr.Read|d.xr.Create,D=d.TI.Read|d.TI.List|d.TI.Write;class _ extends i.Component{constructor(e){super(e),this.reloadInstance=this.reloadInstance.bind(this),this.deleteContextError=this.deleteContextError.bind(this),S.Mq.selectedinstanceid=parseInt(this.props.match.params.id),this.state={tab:e.match.params.tab??_.tabs[0][0],errors:new Set,instance:null,instancePermissionSet:null,reloadInstance:this.reloadInstance,deleteError:this.deleteContextError,instanceid:parseInt(this.props.match.params.id)}}deleteContextError(e){this.setState((t=>{const a=new Set(t.errors);return a.delete(e),{errors:a}}))}async componentDidMount(){await this.reloadInstance()}componentDidUpdate(e){this.props.match.params.tab&&e.match.params.tab!=this.props.match.params.tab&&this.setState({tab:this.props.match.params.tab})}async reloadInstance(){this.setState({instance:null,instancePermissionSet:null});const e=await m.Z.getInstance(this.state.instanceid);if(e.code===p.G.OK){this.setState({instance:e.payload});const t=await u.Z.getCurrentInstancePermissionSet(this.state.instanceid,!0);t.code===p.G.OK?this.setState({instancePermissionSet:t.payload}):this.setState((e=>{const a=new Set(e.errors);return a.add(t.error),{instancePermissionSet:null,errors:a}}))}else this.setState((t=>{const a=new Set(t.errors);return a.add(e.error),{instance:null,errors:a}}))}render(){if(!this.state.instance||!this.state.instancePermissionSet)return i.createElement(v.Z,{text:"loading.instance"});return i.createElement(g.g.Provider,{value:Object.assign({user:this.context.user,serverInfo:this.context.serverInfo},this.state)},i.createElement(s.Z,{className:"behind-nav"},i.createElement(s.Z.Header,{className:"text-center mb-2 sticky-top"},i.createElement("h3",null,i.createElement(l.Z,{id:"view.instanceedit.title",values:{instanceid:this.props.match.params.id,instancename:this.state.instance.name}})),i.createElement("h5",{className:"text-white-50"},i.createElement(l.Z,{id:`view.instanceedit.tabs.${this.state.tab}`}))),i.createElement(o.Z.Container,{mountOnEnter:!0,unmountOnExit:!0,id:"instanceedit",activeKey:this.state.tab},i.createElement("div",{className:"d-flex flex-row z-front"},i.createElement(s.Z.Body,{className:"flex-grow-0"},(()=>i.createElement(r.Z,{defaultActiveKey:this.state.tab,onSelect:e=>{e=e??_.tabs[0][0],S.Mq.selectedinstanceedittab=e,this.props.history.push(S.$w.instanceedit.link??S.$w.instanceedit.route),this.setState({tab:e??_.tabs[0][0]})},fill:!0,variant:"pills",activeKey:this.state.tab,className:"flex-nowrap text-nowrap flex-column hover-bar sticky-top "+(h.ZP.instanceeditsidebar.value===h.mf.COLLAPSE?"pin-close":h.ZP.instanceeditsidebar.value===h.mf.EXPAND?"pin-open":""),style:{top:"8em"}},_.tabs.map((([e,t,a,s])=>{if(!this.state.instancePermissionSet)throw Error("this.state.instancePermissionSet is null in instanceedit nav map");const o=!s,c=!a(this.state.instancePermissionSet,this.context);return i.createElement(r.Z.Item,{key:e},i.createElement(r.Z.Link,{eventKey:e,bsPrefix:"nav-link instanceedittab",className:(o?"no-access text-white":"")+(c?"no-access text-white font-italic":"")+" text-left"},i.createElement(i.Fragment,null,i.createElement(n.G,{icon:c?"lock":t,fixedWidth:!0}),i.createElement("div",{className:"tab-text d-inline-block "+(c?"font-weight-lighter":"")},i.createElement("span",{className:"pl-1"},i.createElement(l.Z,{id:`view.instanceedit.tabs.${e}`}))))))}))))()),i.createElement(s.Z.Body,{className:"bg-body"},i.createElement(o.Z.Content,null,_.tabs.map((([e,,t,a])=>{if(!this.state.instancePermissionSet)throw Error("this.state.instancePermissionSet is null in render card map");return i.createElement(o.Z.Pane,{eventKey:e,key:e},a?t(this.state.instancePermissionSet,this.context)?i.createElement(a,null):i.createElement(y.Z,null):i.createElement(E.Z,null))}))))))))}}_.tabs=[["info","info",()=>!0,Z.default],["repository","code-branch",e=>!!(e.repositoryRights&A),V.default],["byond","list-ul",e=>!!(e.byondRights&I),b.default],["deployment","hammer",e=>!!(e.dreamMakerRights&k),x.Deployment],["dreamdaemon","server",e=>!!(e.dreamDaemonRights&O),N.default],["chatbots","comments",e=>!!(e.chatBotRights&T),w.default],["files","folder-open",e=>!!(e.configurationRights&D),P.default],["users","users",()=>!0,C.default],["jobs","stream",()=>!0,R.default]],_.contextType=f.f,t.default=(0,c.EN)(_)}}]);
//# sourceMappingURL=182.5a490f715ceeb44b675f.bundle.js.map