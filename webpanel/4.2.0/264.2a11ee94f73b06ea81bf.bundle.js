"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[264],{2741:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(7294),r=n(5293),i=n(3489),s=n(4012);function o(e){return a.createElement(r.Z,{show:e.show,overlay:a.createElement(i.Z,{id:e.tooltipid},a.createElement(s.Z,{id:e.tooltipid}))},e.children)}},8264:function(e,t,n){n.r(t),n.d(t,{default:function(){return _}});var a,r=n(7294),i=n(7959),s=n(5005),o=n(5881),l=n(5147),c=n(4012),m=n(5856),d=n(8509),u=n(3204),p=n(6846),f=n(3803),g=n(7611),E=n(7961),h=n(9521),b=n(6190),y=n(7428),v=n(6964),Z=n(3e3),w=n(9635),S=n(9049),C=n(5619),P=n(8425),k=n(5855),R=n(2741),T=n(7814),N=n(9966),K=n(7977),x=n(96),G=n(7764);function M(){return M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},M.apply(this,arguments)}function O({pr:e,testmergeinfo:t,repoInfo:n,finalState:a,onRemove:o,onSelectCommit:l,onError:m}){const[u,p]=(0,r.useState)(!1),g=e=>{p((t=>{let n;return n="boolean"==typeof e?e:e(t),n&&I(),n}))},[E,h]=(0,r.useState)(!1),[Z,w]=(0,r.useState)(e.head),[C,P]=(0,r.useState)(a?a[1]:""),[O,_]=(0,r.useState)(null),[U,X]=(0,r.useState)(null),B=(0,r.useContext)(b.g),I=(0,r.useCallback)((async a=>{if(O&&!a)return;const r=await y.Z.getPRCommits({owner:n.remoteRepositoryOwner,repo:n.remoteRepositoryName,pr:e,wantedCommit:t?.targetCommitSha});if(r.code===f.G.ERROR)m(r.error);else{const e=new Map;r.payload[0].forEach((t=>e.set(t.sha,t))),_(e),X(r.payload[1]??null)}}),[n.remoteRepositoryOwner,n.remoteRepositoryName,e.head,t?.targetCommitSha]);(0,r.useEffect)((()=>u?void I():void 0),[u,I]),(0,r.useEffect)((()=>E?void I():void 0),[E,I]),(0,r.useEffect)((()=>g(!1)),[a]),(0,r.useEffect)((()=>P(a?a[1]:"")),[a]);let V;t&&(O?.has(t.targetCommitSha)?V=O?.get(t.targetCommitSha):U?.sha===t.targetCommitSha&&(V=U));const A=[...(O??[]).values()].map((n=>({name:n.name,value:n.sha,current:n.sha===t?.targetCommitSha,latest:n.sha===e.head,disabled:!1})));U&&(A.push({name:"...",value:"",current:!1,latest:!1,disabled:!0}),A.push({name:U.name,value:U.sha,current:U.sha===t?.targetCommitSha,latest:U.sha===e.head,disabled:!1}));const H=(0,v.Kp)(B.instancePermissionSet,d.nX.MergePullRequest),j=(0,v.Kp)(B.instancePermissionSet,d.nX.Read)&&(0,v.Kp)(B.instancePermissionSet,d.nX.UpdateBranch)||!t;return r.createElement(r.Fragment,null,r.createElement("tr",null,r.createElement("td",{className:"text-right"+(a?" font-weight-bold":"")},"#",e.number),r.createElement("td",null,r.createElement(K.Z,{pill:!0,className:"text-white text-capitalize mr-2",style:{backgroundColor:{closed:"#c93c37",merged:"#8256d0",open:"#347d39"}[e.state]}},e.state),e.testmergelabel?r.createElement(K.Z,{pill:!0,className:"text-white text-capitalize mr-2",variant:"primary"},r.createElement(c.Z,{id:"view.instance.repo.testmergelabel"})):null),r.createElement("td",null,r.createElement("a",{href:e.link,target:"_blank",rel:"noreferrer"},e.title)),r.createElement("td",{className:"font-italic"},e.author),r.createElement("td",null,r.createElement("div",{className:"d-flex justify-content-center"},r.createElement("div",{className:"d-inline-block text-nowrap"},a?r.createElement(r.Fragment,null,r.createElement(R.Z,{tooltipid:"generic.no_perm",show:!j&&void 0},r.createElement(s.Z,{variant:"danger",className:"mx-1",onClick:o,disabled:!j},r.createElement(T.G,{icon:"minus",fixedWidth:!0}))),r.createElement(R.Z,{tooltipid:"generic.no_perm",show:(!H||!j)&&void 0},r.createElement(s.Z,{className:"mx-1",onClick:n=>n.shiftKey?l(e.head,t?.comment??null):h(!0),variant:a[0]===e.head?"primary":"info",disabled:!H||!j},r.createElement(T.G,{icon:"sync",fixedWidth:!0}))),t?r.createElement(s.Z,{className:"mx-1",onClick:()=>g((e=>!e)),active:u},r.createElement(T.G,{icon:"info",fixedWidth:!0})):null):r.createElement(R.Z,{tooltipid:"generic.no_perm",show:!H&&void 0},r.createElement(s.Z,{variant:"success",className:"mx-1",disabled:!H,onClick:t=>t.shiftKey?l(e.head,null):h(!0)},r.createElement(T.G,{icon:"plus",fixedWidth:!0}))))))),r.createElement("tr",null,r.createElement("td",{className:"py-0 border-top-0"}),r.createElement("td",{colSpan:4,className:"py-0 border-top-0"},t?r.createElement(N.Z,{in:u},r.createElement("div",null,r.createElement("div",{className:"py-3"},r.createElement("table",{className:"reset-table"},r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",{className:"text-nowrap"},r.createElement("span",{className:"p-2"},r.createElement(c.Z,{id:"view.instance.repo.tm.by"}))),r.createElement("td",null,t.mergedBy.name)),r.createElement("tr",null,r.createElement("td",{className:"text-nowrap"},r.createElement("span",{className:"p-2"},r.createElement(c.Z,{id:"view.instance.repo.tm.comment"}))),r.createElement("td",null,t.comment)),r.createElement("tr",null,r.createElement("td",{className:"text-nowrap"},r.createElement("span",{className:"p-2"},r.createElement(c.Z,{id:"view.instance.repo.tm.commit"}))),r.createElement("td",null,V?r.createElement(r.Fragment,null,V.name,r.createElement("a",{className:"ml-1",href:V.url,target:"_blank",rel:"noreferrer"},"(",t.targetCommitSha.substring(0,7),")")):t.targetCommitSha.substring(0,7)))))))):null)),r.createElement(i.Z,{show:E,onHide:()=>h(!1),centered:!0,size:"lg"},r.createElement(i.Z.Header,{closeButton:!0},r.createElement(i.Z.Title,null,r.createElement(c.Z,{id:"view.instance.repo.tm.modal.title"}))),r.createElement(i.Z.Body,null,r.createElement("h5",null,r.createElement("a",{href:e.link,target:"_blank",rel:"noreferrer",className:"text-decoration-none"},e.title)),r.createElement(c.Z,{id:"view.instance.repo.tm.modal.label"}),O?r.createElement(x.Z,{filterOptions:G.Z,search:!0,options:A,value:Z??V?.sha,autoComplete:"on",renderOption:(e,t,n,a)=>r.createElement("button",M({type:"button",className:a+(t.disabled?" font-weight-bold":"")},e),r.createElement(K.Z,null,t.value.substring(0,7)),t.current?r.createElement(K.Z,{variant:"primary",pill:!0,className:"mr-1"},r.createElement(c.Z,{id:"generic.testmerged"})):null,t.latest?r.createElement(K.Z,{variant:"success",pill:!0,className:"mr-1"},r.createElement(c.Z,{id:"generic.latest"})):null,t.name),onChange:e=>w(e)}):r.createElement(k.Z,{text:"loading.repo.commits",width:5,widthUnit:"rem"}),r.createElement(S.ZP,{name:"view.instance.repo.tm.modal.comment",type:S.fS.String,onChange:e=>P(e),defaultValue:t?.comment??""}),r.createElement("span",{className:"text-muted font-italic mt-4 d-inline-block"},r.createElement(c.Z,{id:"view.instance.repo.tm.modal.tip"}))),r.createElement(i.Z.Footer,null,r.createElement(s.Z,{variant:"danger",onClick:()=>h(!1)},r.createElement(c.Z,{id:"generic.close"})),r.createElement(s.Z,{onClick:()=>{Z&&l(Z,C),h(!1)}},r.createElement(c.Z,{id:"generic.save"})))))}function _(){const e=(0,r.useContext)(b.g),t=(0,r.useState)([]),[n,T]=(0,r.useState)(null),[N,K]=(0,r.useState)(!1),[x,G]=(0,r.useState)(!1),[M,_]=(0,r.useState)(!0),[U,X]=(0,r.useState)(null),[B,I]=(0,r.useState)(new Map),[V,A]=(0,r.useState)(!1),[H,j]=(0,r.useState)(new Set),[F,J]=(0,r.useState)(0),[L,z]=(0,r.useState)(0),[$,q]=(0,r.useState)(!1),[D,Q]=(0,r.useState)((0,v.$A)(e.instancePermissionSet,d.xb.Compile));function W(e,t,n,a){a=a??U,t&&(A(!1),j(new Set)),e&&I((r=>{const i=new Map(t?[]:r);return e.revisionInformation?.activeTestMerges.forEach((e=>{const r=i.get(e.number);if(!t){if(!1===r)return;if(r&&!r[0])return}const s=a?.find((t=>e.number===t.number));!t||n||"merged"!==s?.state?i.set(e.number,[!0,e.targetCommitSha,e.comment??""]):i.set(e.number,!1)})),i}))}async function Y(n,a){if(!(0,v.Kp)(e.instancePermissionSet,d.nX.Read))return _(!1),K(!1),W(!1,a??!1,!1),T(!1);const r=await g.Z.getRepository(e.instance.id);if(K(!1),r.code===f.G.ERROR)if(r.error.code===p.jK.HTTP_DATA_INEGRITY&&r.error.originalErrorMessage?.errorCode===d.jK.RepoCloning)if(G(!1),K(!0),n)h.Z.registerCallback(n.id,Y);else{const t=await u.Z.listActiveJobs(e.instance.id,{page:1,pageSize:100});if(t.code===f.G.OK){const e=t.payload.content.sort(((e,t)=>t.id-e.id)).find((e=>e.description.includes("Clone")&&e.description.includes("repository")));e?h.Z.registerCallback(e.id,Y):G(!0)}else G(!0)}else(0,Z.iT)(t,r.error);else!function(e,n){e.remoteGitProvider===d.Qs.GitHub&&e.remoteRepositoryName&&e.remoteRepositoryOwner&&y.Z.getPRs({repo:e.remoteRepositoryName,owner:e.remoteRepositoryOwner,wantedPRs:e.revisionInformation?.activeTestMerges.map((e=>e.number))}).then((a=>{a.code===f.G.ERROR?(0,Z.iT)(t,a.error):(X(a.payload),n&&W(e,!0,!1,a.payload))})).catch((e=>{(0,Z.iT)(t,new p.ZP(p.jK.APP_FAIL,{jsError:e}))}))}(r.payload,a),T(r.payload);_(!1)}if((0,r.useEffect)((()=>{Y(void 0,!0)}),[e.instance.id]),(0,r.useEffect)((()=>{}),[n]),N)return r.createElement(r.Fragment,null,x?r.createElement(w.Z,{title:"view.instance.repo.canthookclone"}):null,r.createElement(k.Z,{text:"loading.repo.cloning"}));if(M)return r.createElement(k.Z,null);const ee={origin:{type:S.fS.String,name:"fields.instance.repository.url"},reference:{type:S.fS.String,name:"fields.instance.repository.ref",defaultValue:"main"},accessUser:{type:S.fS.String,name:"fields.instance.repository.gituser",defaultValue:""},accessToken:{type:S.fS.String,name:"fields.instance.repository.gitpassword",defaultValue:""},updateSubmodules:{type:S.fS.Boolean,name:"fields.instance.repository.enablesubmodules",defaultValue:!0}},te=(0,v.$A)(e.instancePermissionSet,d.xb.Compile),ne={originCheckoutSha:{type:S.fS.String,name:"fields.instance.repository.origincheckoutsha",disabled:!0,defaultValue:n?n.revisionInformation?.originCommitSha:"",tooltip:"fields.instance.repository.origincheckoutsha.desc"},checkoutSha:{type:S.fS.String,name:"fields.instance.repository.checkoutsha",defaultValue:n?n.revisionInformation?.commitSha:"",tooltip:"fields.instance.repository.checkoutsha.desc",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.SetSha)},reference:{type:S.fS.String,name:"fields.instance.repository.reference",defaultValue:n?n.reference:"",tooltip:"fields.instance.repository.reference.desc",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.SetReference)},committerName:{type:S.fS.String,name:"fields.instance.repository.committerName",defaultValue:n?n.committerName:"",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeCommitter)},committerEmail:{type:S.fS.String,name:"fields.instance.repository.committerEmail",defaultValue:n?n.committerEmail:"",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeCommitter)},accessUser:{type:S.fS.String,name:"fields.instance.repository.accessUser",defaultValue:n?n.accessUser:"",tooltip:"fields.instance.repository.accessUser.desc",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeCredentials)},accessToken:{type:S.fS.Password,name:"fields.instance.repository.accessToken",tooltip:"fields.instance.repository.accessToken.desc",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeCredentials)},clearAccessToken:{type:S.fS.Boolean,name:"fields.instance.repository.clearAccessToken",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeCredentials)},pushTestMergeCommits:{type:S.fS.Boolean,name:"fields.instance.repository.pushTestMergeCommits",defaultValue:!!n&&n.pushTestMergeCommits,tooltip:"fields.instance.repository.pushTestMergeCommits.desc",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeTestMergeCommits)},createGitHubDeployments:{type:S.fS.Boolean,name:"fields.instance.repository.createGitHubDeployments",defaultValue:!!n&&n.createGitHubDeployments,tooltip:"fields.instance.repository.createGitHubDeployments.desc",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeTestMergeCommits)},showTestMergeCommitters:{type:S.fS.Boolean,name:"fields.instance.repository.showTestMergeCommitters",defaultValue:!!n&&n.showTestMergeCommitters,tooltip:"fields.instance.repository.showTestMergeCommitters.desc",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeTestMergeCommits)},autoUpdatesKeepTestMerges:{type:S.fS.Boolean,name:"fields.instance.repository.autoUpdatesKeepTestMerges",defaultValue:!!n&&n.autoUpdatesKeepTestMerges,tooltip:"fields.instance.repository.autoUpdatesKeepTestMerges.desc",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeAutoUpdateSettings)},autoUpdatesSynchronize:{type:S.fS.Boolean,name:"fields.instance.repository.autoUpdatesSynchronize",defaultValue:!!n&&n.autoUpdatesSynchronize,tooltip:"fields.instance.repository.autoUpdatesSynchronize.desc",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeAutoUpdateSettings)},postTestMergeComment:{type:S.fS.Boolean,name:"fields.instance.repository.postTestMergeComment",defaultValue:!!n&&n.postTestMergeComment,tooltip:"fields.instance.repository.postTestMergeComment.desc",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeTestMergeCommits)},updateSubmodules:{type:S.fS.Boolean,name:"fields.instance.repository.updateSubmodules",defaultValue:!!n&&n.updateSubmodules,tooltip:"fields.instance.repository.updateSubmodules.desc",disabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.ChangeSubmoduleUpdate)}},ae=new Map;n&&n.revisionInformation?.activeTestMerges.forEach((e=>ae.set(e.number,e)));const re=U?.sort(((e,t)=>ae.has(e.number)^ae.has(t.number)?ae.has(e.number)?-1:1:e.testmergelabel^t.testmergelabel?e.testmergelabel?-1:1:e.number-t.number))??[],ie=re.map((e=>{const t=B.get(e.number),r=n?n?.revisionInformation?.activeTestMerges.find((t=>t.number===e.number)):void 0;return t?r?r.targetCommitSha!==t[1]?[a.updated,e]:(r.comment??"")!==t[2]?[a.rename,e]:[a.reapply,e]:[a.added,e]:!1===B.get(e.number)&&r?[a.removed,e]:null})).filter((e=>null!==e)),se=ie.sort(((e,t)=>{const n=[a.reapply,a.removed,a.added,a.updated];for(const a of n)if(e[0]===a^t[0]===a)return e[0]===a?-1:1;return 0})),oe=!!n&&"(no branch)"===n.reference,le=ie.some((e=>e[0]!=a.added&&e[0]!=a.reapply)),ce=V||le,me=0===ie.filter((([e])=>e!==a.reapply)).length&&!V&&!H.size;const de=(0,v.Kp)(e.instancePermissionSet,d.nX.MergePullRequest),ue=(0,v.Kp)(e.instancePermissionSet,d.nX.Read)&&(0,v.Kp)(e.instancePermissionSet,d.nX.UpdateBranch);return r.createElement("div",{className:"text-center"},r.createElement(P.t,{obj:{repositoryInfo:n,PRs:U}}),(0,Z.hP)(t),n&&!n.origin?r.createElement(r.Fragment,null,r.createElement("h3",null,r.createElement(c.Z,{id:"view.instance.repo.clone"})),r.createElement(C.Z,{fields:ee,hideDisabled:!(0,v.Kp)(e.instancePermissionSet,d.nX.Read),onSave:async n=>{const a=await g.Z.cloneRepository(e.instance.id,n);a.code===f.G.OK?(await Y(a.payload.activeJob??void 0),h.Z.restartLoop()):(0,Z.iT)(t,a.error)},includeAll:!0})):r.createElement(r.Fragment,null,r.createElement("h3",null,r.createElement(c.Z,{id:"view.instance.repo.repoinfo"})),function(e){return e?r.createElement("table",{className:"mx-auto text-left"},r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",null,r.createElement("span",{className:"mr-3"},r.createElement(c.Z,{id:"view.instance.repo.info.origin"}))),r.createElement("td",null,e.origin)),r.createElement("tr",null,r.createElement("td",null,r.createElement("span",{className:"mr-3"},r.createElement(c.Z,{id:"view.instance.repo.info.owner"}))),r.createElement("td",null,e.remoteRepositoryOwner)),r.createElement("tr",null,r.createElement("td",null,r.createElement("span",{className:"mr-3"},r.createElement(c.Z,{id:"view.instance.repo.info.name"}))),r.createElement("td",null,e.remoteRepositoryName)))):r.createElement(w.Z,{title:"view.instance.repo.norepoinfo"})}(n),r.createElement("hr",null),r.createElement("h3",null,r.createElement(c.Z,{id:"view.instance.repo.reposettings"})),r.createElement(C.Z,{fields:ne,onSave:async n=>{const{clearAccessToken:a,...r}=n;a&&(r.accessUser="",r.accessToken=""),_(!0);const i=await g.Z.editRepository(e.instance.id,r);_(!1),i.code===f.G.OK?i.payload.activeJob?(_(!0),h.Z.fastmode=5,h.Z.registerCallback(i.payload.activeJob.id,Y),h.Z.registerJob(i.payload.activeJob,e.instance.id),h.Z.restartLoop()):await Y():(0,Z.iT)(t,i.error)}}),r.createElement("hr",null),r.createElement("h3",null,r.createElement(c.Z,{id:"view.instance.repo.testmerges"})),n&&n.remoteGitProvider==d.Qs.Unknown?r.createElement(w.Z,{title:"view.instance.repo.testmerges.badprovider"}):n&&n.remoteGitProvider==d.Qs.GitHub&&!U?r.createElement(k.Z,{text:"loading.repo.prs"}):r.createElement("div",{className:"mx-5"},r.createElement(o.Z,{className:"mb-5"},r.createElement(o.Z.Header,null,r.createElement(c.Z,{id:"view.instance.repo.pending.title"})),r.createElement(o.Z.Body,{className:"text-left"},r.createElement("ul",null,me?r.createElement("li",{className:"font-weight-lighter font-italic"},r.createElement(c.Z,{id:"view.instance.repo.pending.none"})):r.createElement(r.Fragment,null,n&&oe?r.createElement("li",null,r.createElement(c.Z,{id:"view.instance.repo.pending.reset.nobranch",values:{commit:n.revisionInformation?.originCommitSha.substring(0,7)}})):ce&&n?r.createElement("li",null,r.createElement(c.Z,{id:"view.instance.repo.pending.reset"})):ce?r.createElement("li",null,r.createElement(c.Z,{id:"view.instance.repo.pending.update"})):null,n&&n.remoteGitProvider===d.Qs.GitHub?se.map((([e,t])=>{const n=B.get(t.number);if(e===a.reapply&&!ce&&!oe)return null;const i=n?n[1]:null;return r.createElement("li",{key:t.number},r.createElement(c.Z,{id:`view.instance.repo.pending.${e}`,values:{number:t.number,commit:i?.substring(0,7),title:t.title}}))})):null,[...H.values()].map((e=>r.createElement("li",{key:e},r.createElement(c.Z,{id:"view.instance.repo.pending.added.manual",values:{number:e}})))))),r.createElement(S.ZP,{name:"view.instance.repo.update",tooltip:"view.instance.repo.update.desc",type:S.fS.Boolean,defaultValue:!oe&&(!!le||V),disabled:le||oe||!ue,onChange:e=>A(e)}),E.ZP.manualpr.value||!n||n.remoteGitProvider===d.Qs.GitLab?r.createElement("div",{className:"d-flex mt-5"},r.createElement(S.ZP,{name:"view.instance.repo.manual",tooltip:"view.instance.repo.manual.desc",type:S.fS.Number,min:0,defaultValue:L,onChange:e=>J(e),disabled:!de}),r.createElement(R.Z,{tooltipid:"generic.no_perm",show:!de&&void 0},r.createElement(s.Z,{className:"nowrap ml-3",disabled:F===L||!de,onClick:()=>{j((e=>new Set([...e.values(),F]))),z(F)}},r.createElement(c.Z,{id:"view.instance.repo.addmanual"})))):null,r.createElement(S.ZP,{name:"view.instance.repo.deployAfter",tooltip:"view.instance.repo.deployAfter.desc",type:S.fS.Boolean,defaultValue:!!te&&D,disabled:!te,onChange:e=>Q(e)})),r.createElement(o.Z.Footer,null,r.createElement(s.Z,{variant:"danger",className:"mx-2",disabled:me,onClick:()=>W(n,!0,!0)},r.createElement(c.Z,{id:"generic.cancel"})),r.createElement(s.Z,{className:"mx-2",disabled:me,onClick:async function(){const a={};if(n&&oe?a.checkoutSha=n.revisionInformation?.originCommitSha:ce&&(a.updateFromOrigin=!0,n&&(a.reference=n?.reference)),n&&n?.remoteGitProvider===d.Qs.GitHub){const e=[];[...B.entries()].forEach((([t,n])=>{if(!n)return;const[a,r,i]=n;(!a||ce||oe)&&e.push({number:t,targetCommitSha:r,comment:i})})),e.length&&(a.newTestMerges=e)}const r=a.newTestMerges??[];H.forEach((e=>r.push({number:e}))),r.length&&(a.newTestMerges=r),_(!0);const i=await g.Z.editRepository(e.instance.id,a);if(_(!1),i.code===f.G.OK)if(i.payload.activeJob){if(_(!0),h.Z.fastmode=5,h.Z.registerCallback(i.payload.activeJob.id,(e=>Y(e,void 0===e.errorCode&&void 0===e.exceptionDetails))),h.Z.registerJob(i.payload.activeJob,e.instance.id),h.Z.restartLoop(),D){const n=i.payload.activeJob.id,a=setInterval((()=>{"number"==typeof h.Z.jobs.get(n)?.progress&&(m.Z.startCompile(e.instance.id).then((e=>{e.code===f.G.ERROR&&(0,Z.iT)(t,e.error)})),clearInterval(a))}),5e3)}}else await Y();else(0,Z.iT)(t,i.error)}},r.createElement(c.Z,{id:"generic.commit"})))),!1===n?r.createElement(w.Z,{title:"view.instance.repo.noautomerge"}):n&&n.remoteGitProvider===d.Qs.GitHub?r.createElement(l.Z,{variant:"dark",striped:!0,hover:!0,className:"text-left"},r.createElement("tbody",null,re.map((e=>r.createElement(O,{key:e.number,testmergeinfo:ae.get(e.number),pr:e,repoInfo:n,finalState:!!B.get(e.number)&&B.get(e.number).slice(1),onRemove:()=>I((t=>new Map(t).set(e.number,!1))),onSelectCommit:(t,n)=>I((a=>new Map(a).set(e.number,[!1,t,n]))),onError:e=>(0,Z.iT)(t,e)}))))):null),r.createElement("hr",null),r.createElement("h4",null,r.createElement(c.Z,{id:"view.instance.repo.delete.title"})),r.createElement("span",null,r.createElement(c.Z,{id:"view.instance.repo.delete.desc"})),r.createElement("br",null),r.createElement(s.Z,{variant:"danger",className:"mt-2",onClick:()=>q(!0)},r.createElement(c.Z,{id:"view.instance.repo.delete"})),r.createElement(i.Z,{show:$,onHide:()=>q(!1),centered:!0},r.createElement(i.Z.Header,{closeButton:!0},r.createElement(i.Z.Title,null,r.createElement(c.Z,{id:"view.instance.repo.delete.title"}))),r.createElement(i.Z.Body,null,r.createElement("span",null,r.createElement(c.Z,{id:"generic.areyousure"}))),r.createElement(i.Z.Footer,null,r.createElement(s.Z,{onClick:()=>q(!1)},r.createElement(c.Z,{id:"generic.cancel"})),r.createElement(s.Z,{variant:"danger",onClick:async()=>{q(!1),_(!0);const n=await g.Z.deleteRepository(e.instance.id);_(!1),n.code===f.G.OK?n.payload.activeJob?(_(!0),h.Z.fastmode=5,h.Z.registerCallback(n.payload.activeJob.id,(e=>Y(e,void 0===e.errorCode&&void 0===e.exceptionDetails))),h.Z.registerJob(n.payload.activeJob,e.instance.id),h.Z.restartLoop()):await Y():(0,Z.iT)(t,n.error)}},r.createElement(c.Z,{id:"view.instance.repo.delete"}))))))}!function(e){e.reapply="reapply",e.added="added",e.removed="removed",e.updated="updated",e.rename="renamed"}(a||(a={}))},7428:function(e,t,n){var a=n(7162),r=n(7347),i=n(2638),s=n(2527),o=n(6846),l=n(3803),c=n(7961),m=n(6755);async function d(e,t,n){const a=e.endpoint.merge(t,n);return c.ZP.githubtoken.value&&(a.headers.authorization=`token ${c.ZP.githubtoken.value}`),e(a)}async function u(){return c.ZP.githubtoken.value?{type:"token",tokenType:"pat",token:c.ZP.githubtoken.value}:{type:"unauthenticated"}}const p=()=>Object.assign(u.bind(null),{hook:d.bind(null)}),f=new class extends s.TypedEmitter{constructor(){super(),this.apiClient=void 0;const e=i.v.plugin(a.X,r.O);this.apiClient=new e({authStrategy:p,userAgent:"tgstation-server-control-panel/"+m.q4,baseUrl:"https://api.github.com",throttle:{onRateLimit:(e,t)=>(console.warn(`Request quota exhausted for request ${t.method} ${t.url}`),0===t.request.retryCount&&(console.log(`Retrying after ${e} seconds!`),!0)),onAbuseLimit:(e,t)=>{console.warn(`Abuse detected for request ${t.method} ${t.url}`)}}})}async getVersions({owner:e,repo:t,current:n,all:a}){let r,i=0;try{r=await this.apiClient.paginate(this.apiClient.repos.listReleases,{owner:e,repo:t},((e,t)=>e.data.reduce(((e,r)=>{const s=/tgstation-server-v([\d.]+)/.exec(r.name??"");if(!s)return e;if("4"!==s[1][0]&&"5"!==s[1][0])return e;const o=s[1];let l=!1;if(o<=n){if(i>=3&&!a)return t(),e;i++,l=!0}return e.push({version:o,body:r.body??"",current:o===n,old:l}),e}),[])))}catch(e){return new l.Z({code:l.G.ERROR,error:new o.ZP(o.jK.GITHUB_FAIL,{jsError:e})})}return new l.Z({code:l.G.OK,payload:r})}transformPR(e){return{number:e.number,title:e.title,author:e.user?.login??"ghost",state:e.merged_at?"merged":e.state,link:e.html_url,head:e.head.sha,tail:e.base.sha,testmergelabel:e.labels.some((e=>e.name?.toLowerCase().includes("testmerge")||e.name?.toLowerCase().includes("test merge")))}}async getPRs({owner:e,repo:t,wantedPRs:n}){let a=[];try{a=(await this.apiClient.paginate(this.apiClient.pulls.list,{owner:e,repo:t,state:"open"})).map(this.transformPR);for(const r of n??[])if(!a.find((e=>e.number==r))){const n=(await this.apiClient.pulls.get({owner:e,repo:t,pull_number:r})).data;a.push(this.transformPR(n))}}catch(e){return console.error(e),new l.Z({code:l.G.ERROR,error:new o.ZP(o.jK.GITHUB_FAIL,{jsError:e})})}return new l.Z({code:l.G.OK,payload:a})}async getPRCommits({owner:e,repo:t,pr:n,wantedCommit:a}){let r,i=[];try{if(i=await this.apiClient.paginate(this.apiClient.pulls.listCommits,{owner:e,repo:t,pull_number:n.number,per_page:100},(({data:e})=>e.map((e=>({name:e.commit.message.split("\n")[0],sha:e.sha,url:e.html_url}))))),i.reverse(),a&&!i.find((e=>e.sha===a))){const n=(await this.apiClient.repos.getCommit({owner:e,repo:t,ref:a})).data;r={name:n.commit.message.split("\n")[0],sha:n.sha,url:n.html_url}}}catch(e){return console.error(e),new l.Z({code:l.G.ERROR,error:new o.ZP(o.jK.GITHUB_FAIL,{jsError:e})})}return new l.Z({code:l.G.OK,payload:[i,r]})}};t.Z=f}}]);
//# sourceMappingURL=264.2a11ee94f73b06ea81bf.bundle.js.map