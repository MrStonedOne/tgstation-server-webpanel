"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[408],{8425:function(e,t,a){a.d(t,{t:function(){return i}});var r=a(7294),s=a(5171),n=a.n(s),l=a(7961);function o(e){return r.createElement(n(),{src:e.obj,name:"JSON",theme:"tube",iconStyle:"triangle",collapsed:!0,displayDataTypes:!1})}function i(e){return l.ZP.showjson.value?r.createElement("div",{className:"text-left"},r.createElement(o,{obj:e.obj})):r.createElement(r.Fragment,null)}},9929:function(e,t,a){a.d(t,{Z:function(){return d}});var r=a(7814),s=a(7294),n=a(5005),l=a(2258),o=a(5293),i=a(8966),c=a(9611),m=a(4012);function p(){return p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},p.apply(this,arguments)}class d extends s.PureComponent{constructor(e){super(e),this.state={showGoto:!1,gotoValue:e.currentPage}}render(){const e=[],t=Math.max(this.props.totalPages-this.props.currentPage-1,0),a=Math.max(this.props.currentPage-2,0),d=Math.max(this.props.currentPage-Math.max(5-Number(this.props.currentPage!==this.props.totalPages)-t,2),2),h=Math.min(this.props.currentPage+Math.max(5-Number(1!==this.props.currentPage)-a,2),this.props.totalPages-1);for(let t=d;t<=h;t++)e.push(s.createElement(i.Z.Item,{key:t,active:t===this.props.currentPage,onClick:()=>this.props.selectPage(t)},t));const g=this.props.totalPages>7?s.createElement(i.Z.Ellipsis,{disabled:!0}):null,u=s.createElement(c.Z,{id:"popover-gotopage"},s.createElement(c.Z.Title,null,s.createElement(m.Z,{id:"generic.goto.title"})),s.createElement(c.Z.Content,null,s.createElement("form",{className:"d-flex",onSubmit:e=>{e.preventDefault(),this.props.selectPage(this.state.gotoValue),this.setState({showGoto:!1})}},s.createElement(l.Z.Control,{className:"mr-2",type:"number",min:1,max:this.props.totalPages,value:this.state.gotoValue,onChange:e=>this.setState({gotoValue:parseInt(e.target.value)}),custom:!0}),s.createElement(n.Z,{type:"submit"},s.createElement(m.Z,{id:"generic.goto"}))))),{selectPage:E,totalPages:v,currentPage:f,...P}=this.props;return s.createElement("div",p({className:"text-center",style:{position:"sticky",bottom:"1.5em"}},P),s.createElement(i.Z,{className:"justify-content-center"},s.createElement(i.Z.Prev,{disabled:this.props.currentPage<=1,onClick:()=>this.props.selectPage(Math.max(this.props.currentPage-1,1))}),s.createElement(i.Z.Item,{active:this.props.currentPage<=1,onClick:()=>this.props.selectPage(1)},"1"),g,e,g,this.props.totalPages>=2?s.createElement(i.Z.Item,{active:this.props.currentPage>=this.props.totalPages,onClick:()=>this.props.selectPage(this.props.totalPages)},this.props.totalPages):null,this.props.totalPages>7?s.createElement(o.Z,{show:this.state.showGoto,placement:"top",overlay:u},s.createElement(i.Z.Item,{onClick:()=>this.setState((e=>({showGoto:!e.showGoto})))},s.createElement(r.G,{icon:"search"}))):null,s.createElement(i.Z.Next,{disabled:this.props.currentPage>=this.props.totalPages,onClick:()=>this.props.selectPage(Math.min(this.props.currentPage+1,this.props.totalPages))})))}}},3408:function(e,t,a){a.r(t);var r=a(7294),s=a(5005),n=a(682),l=a(5293),o=a(5147),i=a(3489),c=a(4012),m=a(8272),p=a(5977),d=a(3727),h=a(2480),g=a(6846),u=a(3803),E=a(6964),v=a(1320),f=a(3e3),P=a(8425),Z=a(5855),b=a(9929);t.default=(0,p.EN)(class extends r.Component{constructor(e){super(e),this.state={errors:[],loading:!0,logs:[],page:v.Mq.loglistpage??1}}async componentDidUpdate(e,t){t.page!==this.state.page&&(v.Mq.loglistpage=this.state.page,await this.loadLogs())}async componentDidMount(){const e=this.props.match.params.name;if(e){const t=await h.Z.getLog(e);switch(t.code){case u.G.OK:{const e=RegExp(/(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{7}[-+]\d{2}:\d{2})\s+(.*?)(?=(?:\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{7}[-+]\d{2}:\d{2}|$))/,"gs");let a;const r=[];for(;null!==(a=e.exec(t.payload.content));)r.push({time:a[1],content:a[2]});this.setState({viewedLog:{logFile:t.payload,entries:r}});break}case u.G.ERROR:this.addError(t.error)}}await this.loadLogs()}async loadLogs(){this.setState({loading:!0});const e=await h.Z.getLogs({page:this.state.page});switch(e.code){case u.G.OK:if(this.state.page>e.payload.totalPages&&0!==e.payload.totalPages)return void this.setState({page:1});this.setState({logs:e.payload.content,maxPage:e.payload.totalPages});break;case u.G.ERROR:this.addError(e.error)}this.setState({loading:!1})}addError(e){this.setState((t=>{const a=Array.from(t.errors);return a.push(e),{errors:a}}))}async downloadLog(e){const t=await h.Z.getLog(e);switch(t.code){case u.G.OK:(0,E.LR)(e,t.payload.content);break;case u.G.ERROR:this.addError(t.error)}}render(){return r.createElement("div",{className:"text-center"},this.state.errors.map(((e,t)=>{if(e)return r.createElement(f.ZP,{key:t,error:e,onClose:()=>this.setState((e=>{const a=Array.from(e.errors);return a[t]=void 0,{errors:a}}))})})),this.state.loading?r.createElement(Z.Z,{text:"loading.logs"}):this.props.match.params.name&&this.state.viewedLog?r.createElement("div",{className:"mx-5 mt-5"},r.createElement(P.t,{obj:this.state.viewedLog}),r.createElement("h3",null,this.props.match.params.name),r.createElement(s.Z,{className:"mr-1",as:d.rU,to:v.$w.admin_logs.link??v.$w.admin_logs.route},r.createElement(c.Z,{id:"generic.goback"})),r.createElement(s.Z,{onClick:()=>{(0,E.LR)(this.props.match.params.name,this.state.viewedLog.logFile.content)}},r.createElement(c.Z,{id:"generic.download"})),r.createElement("hr",null),r.createElement("div",{style:{height:"60vh",display:"block"},className:"table-responsive"},r.createElement(o.Z,{striped:!0,hover:!0,variant:"dark",className:"text-left"},r.createElement("thead",{className:"bg-dark",style:{position:"sticky",top:0}},r.createElement("th",null,r.createElement(c.Z,{id:"generic.datetime"})),r.createElement("th",null,r.createElement(c.Z,{id:"generic.entry"}))),r.createElement("tbody",null,this.state.viewedLog.entries.map((e=>r.createElement("tr",{key:e.time},r.createElement("td",{className:"py-1"},e.time),r.createElement("td",{className:"py-1"},r.createElement("pre",{className:"mb-0"},e.content))))))))):r.createElement(n.Z,{className:"mt-5 mb-5"},r.createElement(P.t,{obj:this.state.logs}),r.createElement(o.Z,{striped:!0,bordered:!0,hover:!0,variant:"dark",responsive:!0},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"#"),r.createElement("th",null,r.createElement(c.Z,{id:"generic.name"})),r.createElement("th",null,r.createElement(c.Z,{id:"generic.datetime"})),r.createElement("th",null,r.createElement(c.Z,{id:"generic.action"})))),r.createElement("tbody",null,this.state.logs.map(((e,t)=>{const a=new Date(e.lastModified),n=(a.getTime()-Date.now())/1e3;return r.createElement("tr",{key:e.name},r.createElement("td",null,t),r.createElement("td",null,e.name),r.createElement(l.Z,{overlay:r.createElement(i.Z,{id:`${e.name}-tooltip`},a.toLocaleString())},(({ref:e,...t})=>r.createElement("td",t,r.createElement("span",{ref:e},r.createElement(m.Z,{value:n,numeric:"auto",updateIntervalInSeconds:1}))))),r.createElement("td",{className:"align-middle p-0"},r.createElement(s.Z,{className:"mr-1",onClick:()=>{this.props.history.push((v.$w.admin_logs.link??v.$w.admin_logs.route)+e.name+"/",{reload:!0})}},r.createElement(c.Z,{id:"generic.view"})),r.createElement(s.Z,{onClick:()=>{this.downloadLog(e.name).catch((e=>{this.addError(new g.ZP(g.jK.APP_FAIL,{jsError:e}))}))}},r.createElement(c.Z,{id:"generic.download"}))))})))),r.createElement(b.Z,{selectPage:e=>this.setState({page:e}),totalPages:this.state.maxPage??1,currentPage:this.state.page})))}})},8966:function(e,t,a){a.d(t,{Z:function(){return y}});var r=a(7462),s=a(3366),n=a(4184),l=a.n(n),o=a(7294),i=a(6792),c=a(8358),m=["active","disabled","className","style","activeLabel","children"],p=["children"],d=o.forwardRef((function(e,t){var a=e.active,n=e.disabled,i=e.className,p=e.style,d=e.activeLabel,h=e.children,g=(0,s.Z)(e,m),u=a||n?"span":c.Z;return o.createElement("li",{ref:t,style:p,className:l()(i,"page-item",{active:a,disabled:n})},o.createElement(u,(0,r.Z)({className:"page-link",disabled:n},g),h,a&&d&&o.createElement("span",{className:"sr-only"},d)))}));d.defaultProps={active:!1,disabled:!1,activeLabel:"(current)"},d.displayName="PageItem";var h=d;function g(e,t,a){function r(e){var r=e.children,n=(0,s.Z)(e,p);return o.createElement(d,n,o.createElement("span",{"aria-hidden":"true"},r||t),o.createElement("span",{className:"sr-only"},a))}return void 0===a&&(a=e),r.displayName=e,r}var u=g("First","\xab"),E=g("Prev","\u2039","Previous"),v=g("Ellipsis","\u2026","More"),f=g("Next","\u203a"),P=g("Last","\xbb"),Z=["bsPrefix","className","children","size"],b=o.forwardRef((function(e,t){var a=e.bsPrefix,n=e.className,c=e.children,m=e.size,p=(0,s.Z)(e,Z),d=(0,i.vE)(a,"pagination");return o.createElement("ul",(0,r.Z)({ref:t},p,{className:l()(n,d,m&&d+"-"+m)}),c)}));b.First=u,b.Prev=E,b.Ellipsis=v,b.Item=h,b.Next=f,b.Last=P;var y=b},9611:function(e,t,a){a.d(t,{Z:function(){return u}});var r=a(7462),s=a(3366),n=a(4184),l=a.n(n),o=a(7294),i=(a(5638),a(6792)),c=["as","bsPrefix","className","children"],m=o.forwardRef((function(e,t){var a=e.as,n=void 0===a?"div":a,m=e.bsPrefix,p=e.className,d=e.children,h=(0,s.Z)(e,c);return m=(0,i.vE)(m,"popover-header"),o.createElement(n,(0,r.Z)({ref:t},h,{className:l()(m,p)}),d)})),p=["as","bsPrefix","className","children"],d=o.forwardRef((function(e,t){var a=e.as,n=void 0===a?"div":a,c=e.bsPrefix,m=e.className,d=e.children,h=(0,s.Z)(e,p);return c=(0,i.vE)(c,"popover-body"),o.createElement(n,(0,r.Z)({ref:t},h,{className:l()(m,c)}),d)})),h=["bsPrefix","placement","className","style","children","content","arrowProps","popper","show"],g=o.forwardRef((function(e,t){var a=e.bsPrefix,n=e.placement,c=e.className,m=e.style,p=e.children,g=e.content,u=e.arrowProps,E=(e.popper,e.show,(0,s.Z)(e,h)),v=(0,i.vE)(a,"popover"),f=((null==n?void 0:n.split("-"))||[])[0];return o.createElement("div",(0,r.Z)({ref:t,role:"tooltip",style:m,"x-placement":f,className:l()(c,v,f&&"bs-popover-"+f)},E),o.createElement("div",(0,r.Z)({className:"arrow"},u)),g?o.createElement(d,null,p):p)}));g.defaultProps={placement:"right"},g.Title=m,g.Content=d;var u=g},5147:function(e,t,a){var r=a(7462),s=a(3366),n=a(4184),l=a.n(n),o=a(7294),i=a(6792),c=["bsPrefix","className","striped","bordered","borderless","hover","size","variant","responsive"],m=o.forwardRef((function(e,t){var a=e.bsPrefix,n=e.className,m=e.striped,p=e.bordered,d=e.borderless,h=e.hover,g=e.size,u=e.variant,E=e.responsive,v=(0,s.Z)(e,c),f=(0,i.vE)(a,"table"),P=l()(n,f,u&&f+"-"+u,g&&f+"-"+g,m&&f+"-striped",p&&f+"-bordered",d&&f+"-borderless",h&&f+"-hover"),Z=o.createElement("table",(0,r.Z)({},v,{className:P,ref:t}));if(E){var b=f+"-responsive";return"string"==typeof E&&(b=b+"-"+E),o.createElement("div",{className:b},Z)}return Z}));t.Z=m}}]);
//# sourceMappingURL=408.21f9a4b226a52466a18b.bundle.js.map