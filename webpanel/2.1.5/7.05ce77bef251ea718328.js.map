{"version":3,"sources":["webpack:///./src/components/views/Instance/Edit/Byond.tsx","webpack:///./src/contexts/InstanceEditContext.ts"],"names":["Byond","props","state","versions","errors","activeVersion","latestVersion","selectedVersion","loading","error","this","setState","prevState","Array","from","push","response","ByondClient","listAllVersions","context","instance","id","code","StatusCode","OK","payload","content","response2","getActiveVersion","version","addError","loadVersions","fetch","then","res","text","data","split","catch","e","InternalError","ErrorCode","APP_FAIL","jsError","Error","instancePermissionSet","byondRights","ByondRights","ListInstalled","ReadActive","className","map","err","index","key","onClose","prev","newarr","undefined","onChange","switchActive","target","value","Prepend","Radio","disabled","InstallOfficialOrChangeActiveVersion","name","defaultChecked","Append","as","htmlFor","overlay","innerid","Fragment","show","endsWith","ref","triggerHandler","Text","substr","length","fixedWidth","icon","type","defaultValue","arr","join","variant","onClick","customFile","arrayBuffer","ERROR","File","custom","label","accept","files","React","Component","contextType","InstanceEditContext","createContext"],"mappings":"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","file":"7.05ce77bef251ea718328.js","sourcesContent":["import { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React, { ChangeEvent } from \"react\";\nimport Button from \"react-bootstrap/Button\";\nimport Form from \"react-bootstrap/Form\";\nimport FormControl from \"react-bootstrap/FormControl\";\nimport InputGroup from \"react-bootstrap/InputGroup\";\nimport OverlayTrigger from \"react-bootstrap/OverlayTrigger\";\nimport Tooltip from \"react-bootstrap/Tooltip\";\nimport { FormattedMessage } from \"react-intl\";\n\nimport ByondClient from \"../../../../ApiClient/ByondClient\";\nimport { ByondRights } from \"../../../../ApiClient/generatedcode/_enums\";\nimport { Components } from \"../../../../ApiClient/generatedcode/_generated\";\nimport InternalError, { ErrorCode } from \"../../../../ApiClient/models/InternalComms/InternalError\";\nimport { StatusCode } from \"../../../../ApiClient/models/InternalComms/InternalStatus\";\nimport { InstanceEditContext } from \"../../../../contexts/InstanceEditContext\";\nimport AccessDenied from \"../../../utils/AccessDenied\";\nimport ErrorAlert from \"../../../utils/ErrorAlert\";\nimport Loading from \"../../../utils/Loading\";\n\ninterface IProps {}\n\ninterface IState {\n    errors: Array<InternalError<ErrorCode> | undefined>;\n    versions: Components.Schemas.ByondResponse[];\n    activeVersion?: string | null;\n    latestVersion: string;\n    selectedVersion: string;\n    loading: boolean;\n    customFile?: File | null;\n}\n\nclass Byond extends React.Component<IProps, IState> {\n    public declare context: InstanceEditContext;\n    public constructor(props: IProps) {\n        super(props);\n\n        this.state = {\n            versions: [],\n            errors: [],\n            activeVersion: \"\",\n            latestVersion: \"\",\n            selectedVersion: \"\",\n            loading: true\n        };\n    }\n\n    private addError(error: InternalError<ErrorCode>): void {\n        this.setState(prevState => {\n            const errors = Array.from(prevState.errors);\n            errors.push(error);\n            return {\n                errors\n            };\n        });\n    }\n\n    private async loadVersions() {\n        const response = await ByondClient.listAllVersions(this.context.instance.id);\n        if (response.code === StatusCode.OK) {\n            this.setState({\n                versions: response.payload.content\n            });\n\n            const response2 = await ByondClient.getActiveVersion(this.context.instance.id);\n            if (response2.code === StatusCode.OK) {\n                this.setState({\n                    activeVersion: response2.payload.version\n                });\n            } else {\n                this.addError(response2.error);\n            }\n        } else {\n            this.addError(response.error);\n        }\n    }\n\n    public async componentDidMount(): Promise<void> {\n        await this.loadVersions();\n\n        fetch(\"https://secure.byond.com/download/version.txt\")\n            .then(res => res.text())\n            .then(data => data.split(\"\\n\"))\n            .then(versions => versions[0])\n            .then(version => {\n                this.setState({\n                    latestVersion: version,\n                    selectedVersion: version,\n                    loading: false\n                });\n            })\n            .catch(e => {\n                this.addError(new InternalError(ErrorCode.APP_FAIL, { jsError: Error(e) }));\n                this.setState({\n                    loading: false\n                });\n            });\n    }\n\n    public render(): React.ReactNode {\n        if (this.state.loading) {\n            return <Loading text=\"loading.instance\" />;\n        }\n\n        // noinspection JSBitwiseOperatorUsage\n        if (\n            !(\n                this.context.instancePermissionSet.byondRights & ByondRights.ListInstalled &&\n                this.context.instancePermissionSet.byondRights & ByondRights.ReadActive\n            )\n        ) {\n            return <AccessDenied />;\n        }\n\n        const tooltip = (innerid?: string) => {\n            if (!innerid) return <React.Fragment />;\n\n            return (\n                <Tooltip id={innerid}>\n                    <FormattedMessage id={innerid} />\n                </Tooltip>\n            );\n        };\n\n        return (\n            <div className=\"text-center\">\n                <h1>\n                    <FormattedMessage id=\"view.instance.hosting.byond\" />\n                </h1>\n                {this.state.errors.map((err, index) => {\n                    if (!err) return;\n                    return (\n                        <ErrorAlert\n                            key={index}\n                            error={err}\n                            onClose={() =>\n                                this.setState(prev => {\n                                    const newarr = Array.from(prev.errors);\n                                    newarr[index] = undefined;\n                                    return {\n                                        errors: newarr\n                                    };\n                                })\n                            }\n                        />\n                    );\n                })}\n                <div\n                    onChange={async (e: ChangeEvent<HTMLInputElement>) => {\n                        this.setState({\n                            loading: true\n                        });\n                        const response = await ByondClient.switchActive(\n                            this.context.instance.id,\n                            e.target.value\n                        );\n                        if (response.code === StatusCode.OK) {\n                            await this.loadVersions();\n                        } else {\n                            this.addError(response.error);\n                        }\n                        this.setState({\n                            loading: false\n                        });\n                    }}>\n                    {this.state.versions.map(version => {\n                        // noinspection JSBitwiseOperatorUsage\n                        return (\n                            <InputGroup className=\"w-25 mb-1 mx-auto d-flex\" key={version.version}>\n                                <InputGroup.Prepend>\n                                    <InputGroup.Radio\n                                        disabled={\n                                            !(\n                                                this.context.instancePermissionSet.byondRights &\n                                                ByondRights.InstallOfficialOrChangeActiveVersion\n                                            )\n                                        }\n                                        name=\"byond\"\n                                        id={version.version!}\n                                        value={version.version!}\n                                        defaultChecked={\n                                            version.version! === this.state.activeVersion\n                                        }\n                                    />\n                                </InputGroup.Prepend>\n                                <InputGroup.Append\n                                    className=\"flex-grow-1 m-0\"\n                                    as=\"label\"\n                                    htmlFor={version.version!}>\n                                    <OverlayTrigger\n                                        overlay={tooltip(\"view.instance.hosting.byond.custom\")}\n                                        show={!version.version!.endsWith(\".0\") ? undefined : false}>\n                                        {({ ref, ...triggerHandler }) => (\n                                            <InputGroup.Text className=\"w-100\" {...triggerHandler}>\n                                                {version.version!.endsWith(\".0\")\n                                                    ? version.version!.substr(\n                                                          0,\n                                                          version.version!.length - 2\n                                                      )\n                                                    : version.version}\n                                                {!version.version!.endsWith(\".0\") ? (\n                                                    <div\n                                                        className={\"ml-auto\"}\n                                                        ref={ref as React.Ref<HTMLDivElement>}>\n                                                        <FontAwesomeIcon fixedWidth icon=\"info\" />\n                                                    </div>\n                                                ) : null}\n                                            </InputGroup.Text>\n                                        )}\n                                    </OverlayTrigger>\n                                </InputGroup.Append>\n                            </InputGroup>\n                        );\n                    })}\n                </div>\n                <hr />\n                <h4>\n                    <FormattedMessage id=\"view.instance.hosting.byond.add\" />\n                </h4>\n                <InputGroup className=\"w-25 mb-3 mx-auto\">\n                    <FormControl\n                        type=\"number\"\n                        defaultValue={this.state.latestVersion.split(\".\")[0]}\n                        onChange={e => {\n                            this.setState(prev => {\n                                const arr = prev.selectedVersion.split(\".\");\n                                arr[0] = e.target.value;\n                                return {\n                                    selectedVersion: arr.join(\".\")\n                                };\n                            });\n                        }}\n                    />\n                    <InputGroup.Text className=\"rounded-0\">.</InputGroup.Text>\n                    <FormControl\n                        type=\"number\"\n                        defaultValue={this.state.latestVersion.split(\".\")[1]}\n                        onChange={e => {\n                            this.setState(prev => {\n                                const arr = prev.selectedVersion.split(\".\");\n                                arr[1] = e.target.value;\n                                return {\n                                    selectedVersion: arr.join(\".\")\n                                };\n                            });\n                        }}\n                    />\n                    <InputGroup.Append>\n                        <Button\n                            variant=\"success\"\n                            onClick={async () => {\n                                this.setState({\n                                    loading: true\n                                });\n                                const response = await ByondClient.switchActive(\n                                    this.context.instance.id,\n                                    this.state.selectedVersion,\n                                    this.state.customFile\n                                        ? await this.state.customFile.arrayBuffer()\n                                        : undefined\n                                );\n                                if (response.code === StatusCode.ERROR) {\n                                    this.addError(response.error);\n                                } else {\n                                    this.setState({\n                                        customFile: null\n                                    });\n                                    await this.loadVersions();\n                                }\n                                this.setState({\n                                    loading: false\n                                });\n                            }}>\n                            <FontAwesomeIcon icon=\"plus\" />\n                        </Button>\n                    </InputGroup.Append>\n                </InputGroup>\n                <Form>\n                    <Form.File\n                        custom\n                        id=\"test\"\n                        className=\"w-25 text-left\"\n                        label={\n                            this.state.customFile ? (\n                                this.state.customFile.name\n                            ) : (\n                                <FormattedMessage id=\"view.instance.hosting.byond.upload\" />\n                            )\n                        }\n                        accept=\".zip\"\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\n                            this.setState({\n                                customFile: e.target.files ? e.target.files[0] : null\n                            });\n                        }}\n                    />\n                </Form>\n            </div>\n        );\n    }\n}\nByond.contextType = InstanceEditContext;\nexport default Byond;\n","import React from \"react\";\n\nimport { Components } from \"../ApiClient/generatedcode/_generated\";\nimport InternalError from \"../ApiClient/models/InternalComms/InternalError\";\n\nexport type InstanceEditContext = {\n    deleteError: (error: InternalError) => void;\n    errors: Set<InternalError>;\n    reloadInstance: () => void;\n    instance: Components.Schemas.InstanceResponse;\n    user: Components.Schemas.UserResponse;\n    serverInfo: Components.Schemas.ServerInformationResponse;\n    instancePermissionSet: Components.Schemas.InstancePermissionSetResponse;\n};\n\n//same as InstanceEditContext except used for components which arent loading under instanceedit so we cant guarentee that instance wont be null\nexport type UnsafeInstanceEditContext = {\n    deleteError: (error: InternalError) => void;\n    errors: Set<InternalError>;\n    reloadInstance: () => void;\n    instance: Components.Schemas.InstanceResponse | null;\n    user: Components.Schemas.UserResponse;\n    serverInfo: Components.Schemas.ServerInformationResponse;\n    instancePermissionSet: Components.Schemas.InstancePermissionSetResponse | null;\n};\n\nexport const InstanceEditContext = React.createContext<InstanceEditContext>(\n    (undefined as unknown) as InstanceEditContext\n);\n"],"sourceRoot":""}