{"version":3,"sources":["webpack:///./src/components/views/Instance/Create.tsx"],"names":["InstanceCreate","props","context","state","loading","errors","prefix","serverInfo","validInstancePaths","length","undefined","submit","bind","error","this","setState","prevState","Array","from","push","text","className","map","err","index","key","onClose","prev","newarr","id","onSubmit","lg","md","Group","controlId","Label","Control","type","onChange","event","instanceName","target","value","required","Prepend","Text","as","custom","validPath","selected","instancePath","variant","result","InstanceClient","createInstance","name","path","code","StatusCode","ERROR","addError","RouteData","selectedinstanceid","payload","history","AppRoutes","instancelist","link","route","React","Component","contextType","GeneralContext","withRouter"],"mappings":"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","file":"16.6b3be2f97b7258b0a931.js","sourcesContent":["import React from \"react\";\nimport Button from \"react-bootstrap/Button\";\nimport Col from \"react-bootstrap/Col\";\nimport Form from \"react-bootstrap/Form\";\nimport InputGroup from \"react-bootstrap/InputGroup\";\nimport { FormattedMessage } from \"react-intl\";\nimport { RouteComponentProps, withRouter } from \"react-router-dom\";\n\nimport InstanceClient from \"../../../ApiClient/InstanceClient\";\nimport InternalError, { ErrorCode } from \"../../../ApiClient/models/InternalComms/InternalError\";\nimport { StatusCode } from \"../../../ApiClient/models/InternalComms/InternalStatus\";\nimport { GeneralContext } from \"../../../contexts/GeneralContext\";\nimport { AppRoutes, RouteData } from \"../../../utils/routes\";\nimport ErrorAlert from \"../../utils/ErrorAlert\";\nimport Loading from \"../../utils/Loading\";\n\ninterface IState {\n    loading: boolean;\n    errors: Array<InternalError<ErrorCode> | undefined>;\n    instanceName?: string;\n    instancePath?: string;\n    prefix?: string;\n}\n\ninterface IProps extends RouteComponentProps {}\n\nclass InstanceCreate extends React.Component<IProps, IState> {\n    public declare context: GeneralContext;\n    public constructor(props: IProps, context: GeneralContext) {\n        super(props);\n        this.state = {\n            loading: false,\n            errors: [],\n            prefix: context.serverInfo.validInstancePaths?.length\n                ? context.serverInfo.validInstancePaths[0]\n                : undefined\n        };\n\n        this.submit = this.submit.bind(this);\n    }\n\n    private addError(error: InternalError<ErrorCode>): void {\n        this.setState(prevState => {\n            const errors = Array.from(prevState.errors);\n            errors.push(error);\n            return {\n                errors\n            };\n        });\n    }\n\n    public render(): React.ReactNode {\n        if (this.state.loading) {\n            return <Loading text=\"view.instance.create.loading\" />;\n        }\n\n        const validInstancePaths = this.context.serverInfo.validInstancePaths;\n        return (\n            <div className=\"text-center\">\n                {this.state.errors.map((err, index) => {\n                    if (!err) return;\n                    return (\n                        <ErrorAlert\n                            key={index}\n                            error={err}\n                            onClose={() =>\n                                this.setState(prev => {\n                                    const newarr = Array.from(prev.errors);\n                                    newarr[index] = undefined;\n                                    return {\n                                        errors: newarr\n                                    };\n                                })\n                            }\n                        />\n                    );\n                })}\n                <h3>\n                    <FormattedMessage id=\"view.instance.create.title\" />\n                </h3>\n                <Form onSubmit={this.submit}>\n                    <Col className=\"mx-auto\" lg={5} md={8}>\n                        <Form.Group controlId=\"name\">\n                            <Form.Label>\n                                <h5>\n                                    <FormattedMessage id=\"view.instance.create.name\" />\n                                </h5>\n                            </Form.Label>\n                            <Form.Control\n                                type=\"text\"\n                                onChange={event => {\n                                    const instanceName = event.target.value;\n                                    this.setState({\n                                        instanceName\n                                    });\n                                }}\n                                value={this.state.instanceName}\n                                required\n                            />\n                        </Form.Group>\n                        <Form.Group controlId=\"path\">\n                            <Form.Label>\n                                <h5>\n                                    <FormattedMessage id=\"view.instance.create.path\" />\n                                </h5>\n                            </Form.Label>\n                            <InputGroup className=\"mb-1\">\n                                {validInstancePaths != null ? (\n                                    <InputGroup.Prepend className=\"flex-grow-1 flex-grow-md-0\">\n                                        <InputGroup.Text>\n                                            <span>\n                                                <FormattedMessage id=\"view.instance.create.path.prefix\" />\n                                            </span>\n                                        </InputGroup.Text>\n                                        <Form.Control\n                                            className=\"rounded-0 flex-grow-1 flex-grow-md-0 flex-shrink-0 flex-shrink-md-1 w-auto\"\n                                            as=\"select\"\n                                            custom\n                                            required\n                                            onChange={event => {\n                                                this.setState({\n                                                    prefix: event.target.value\n                                                });\n                                            }}>\n                                            {validInstancePaths.map(validPath => {\n                                                return (\n                                                    <option\n                                                        key={validPath}\n                                                        value={validPath}\n                                                        selected={this.state.prefix == validPath}>\n                                                        {validPath}/\n                                                    </option>\n                                                );\n                                            })}\n                                        </Form.Control>\n                                    </InputGroup.Prepend>\n                                ) : null}\n                                <Form.Control\n                                    type=\"text\"\n                                    className=\"flex-grow-1 w-100 w-md-auto\"\n                                    required\n                                    onChange={event => {\n                                        const instancePath = event.target.value;\n                                        this.setState({\n                                            instancePath\n                                        });\n                                    }}\n                                    value={this.state.instancePath}\n                                />\n                            </InputGroup>\n                        </Form.Group>\n                        <Button type=\"submit\" variant=\"success\">\n                            <FormattedMessage id=\"view.instance.create.submit\" />\n                        </Button>\n                    </Col>\n                </Form>\n            </div>\n        );\n    }\n\n    private async submit() {\n        //The required attribute should prevent this from ever happening but id rather not fuck over someone\n        if (!this.state.instancePath) {\n            return;\n        }\n\n        const instancePath =\n            (this.state.prefix ? this.state.prefix + \"/\" : \"\") + this.state.instancePath;\n\n        this.setState({\n            loading: true\n        });\n\n        const result = await InstanceClient.createInstance({\n            name: this.state.instanceName!,\n            path: instancePath\n        });\n\n        if (result.code === StatusCode.ERROR) {\n            this.setState({\n                loading: false\n            });\n            this.addError(result.error);\n\n            return;\n        }\n\n        RouteData.selectedinstanceid = result.payload.id;\n        this.props.history.push(AppRoutes.instancelist.link || AppRoutes.instancelist.route);\n    }\n}\nInstanceCreate.contextType = GeneralContext;\nexport default withRouter(InstanceCreate);\n"],"sourceRoot":""}