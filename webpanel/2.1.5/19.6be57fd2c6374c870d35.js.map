{"version":3,"sources":["webpack:///./src/components/views/User/Create.tsx"],"names":["UserCreate","props","state","errors","password1","password2","username","sysuser","submitTGS","bind","submitSYS","err","this","length","context","serverInfo","minimumPasswordLength","setState","lengthError","matchError","event","preventDefault","validate","creating","user","UserClient","createUser","name","password","code","StatusCode","OK","postCreateAction","payload","history","addError","error","systemIdentifier","prevState","Array","from","push","text","className","map","index","key","onClose","prev","newarr","undefined","id","lg","md","onSubmit","Group","controlId","Label","Control","required","onChange","target","value","type","isInvalid","Feedback","Fragment","React","Component","defaultProps","RouteData","selecteduserid","AppRoutes","useredit","link","route","contextType","GeneralContext","withRouter"],"mappings":"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","file":"19.6be57fd2c6374c870d35.js","sourcesContent":["import { History as LibHistory } from \"history\";\nimport React, { ChangeEvent, FormEvent, ReactNode } from \"react\";\nimport Button from \"react-bootstrap/Button\";\nimport Col from \"react-bootstrap/Col\";\nimport Form from \"react-bootstrap/Form\";\nimport { FormattedMessage } from \"react-intl\";\nimport { RouteComponentProps, withRouter } from \"react-router-dom\";\n\nimport { UserResponse } from \"../../../ApiClient/generatedcode/schemas\";\nimport InternalError, { ErrorCode } from \"../../../ApiClient/models/InternalComms/InternalError\";\nimport { StatusCode } from \"../../../ApiClient/models/InternalComms/InternalStatus\";\nimport UserClient from \"../../../ApiClient/UserClient\";\nimport { GeneralContext } from \"../../../contexts/GeneralContext\";\nimport { AppRoutes, RouteData } from \"../../../utils/routes\";\nimport ErrorAlert from \"../../utils/ErrorAlert\";\nimport Loading from \"../../utils/Loading\";\n\ninterface IState {\n    errors: Array<InternalError<ErrorCode> | undefined>;\n    password1: string;\n    password2: string;\n    username: string;\n    sysuser: string;\n    matchError?: boolean;\n    lengthError?: boolean;\n    creating?: boolean;\n    redirect?: boolean;\n}\ninterface IProps extends RouteComponentProps {\n    postCreateAction?: (user: UserResponse, history: LibHistory) => void;\n}\n\nclass UserCreate extends React.Component<IProps, IState> {\n    public declare context: GeneralContext;\n\n    public static defaultProps = {\n        postCreateAction: (user: UserResponse, history: LibHistory) => {\n            RouteData.selecteduserid = user.id;\n            history.push(AppRoutes.useredit.link || AppRoutes.useredit.route);\n        }\n    };\n\n    public constructor(props: IProps) {\n        super(props);\n\n        this.state = {\n            errors: [],\n            password1: \"\",\n            password2: \"\",\n            username: \"\",\n            sysuser: \"\"\n        };\n\n        this.submitTGS = this.submitTGS.bind(this);\n        this.submitSYS = this.submitSYS.bind(this);\n    }\n\n    // noinspection DuplicatedCode\n    private validate(): boolean {\n        let err = false;\n        if (this.state.password1.length < this.context.serverInfo.minimumPasswordLength) {\n            err = true;\n            this.setState({\n                lengthError: true\n            });\n        } else {\n            this.setState({\n                lengthError: false\n            });\n        }\n        if (this.state.password2 !== this.state.password1) {\n            err = true;\n            this.setState({\n                matchError: true\n            });\n        } else {\n            this.setState({\n                matchError: false\n            });\n        }\n        return err;\n    }\n\n    private async submitTGS(event: FormEvent<HTMLFormElement>) {\n        event.preventDefault();\n\n        //validation\n        if (this.validate()) return;\n        if (!this.state.username) return;\n\n        this.setState({\n            creating: true\n        });\n\n        const user = await UserClient.createUser({\n            name: this.state.username,\n            password: this.state.password1\n        });\n        // noinspection DuplicatedCode\n        if (user.code == StatusCode.OK) {\n            this.props.postCreateAction!(user.payload, this.props.history);\n        } else {\n            this.addError(user.error);\n            this.setState({\n                creating: false\n            });\n        }\n    }\n\n    private async submitSYS(event: FormEvent<HTMLFormElement>) {\n        event.preventDefault();\n\n        //validation\n        if (!this.state.sysuser) return;\n\n        this.setState({\n            creating: true\n        });\n\n        const user = await UserClient.createUser({\n            systemIdentifier: this.state.sysuser\n        });\n        // noinspection DuplicatedCode\n        if (user.code == StatusCode.OK) {\n            this.props.postCreateAction!(user.payload, this.props.history);\n        } else {\n            this.addError(user.error);\n            this.setState({\n                creating: false\n            });\n        }\n    }\n\n    private addError(error: InternalError<ErrorCode>): void {\n        this.setState(prevState => {\n            const errors = Array.from(prevState.errors);\n            errors.push(error);\n            return {\n                errors\n            };\n        });\n    }\n\n    public render(): ReactNode {\n        if (this.state.creating) {\n            return <Loading text=\"loading.user.create\" />;\n        }\n\n        const handleUsernameInput = (event: ChangeEvent<HTMLInputElement>) =>\n            this.setState({ username: event.target.value });\n        const handleSysuserInput = (event: ChangeEvent<HTMLInputElement>) =>\n            this.setState({ sysuser: event.target.value });\n        const handlePwd1Input = (event: ChangeEvent<HTMLInputElement>) =>\n            this.setState({ password1: event.target.value });\n        const handlePwd2Input = (event: ChangeEvent<HTMLInputElement>) =>\n            this.setState({ password2: event.target.value });\n\n        return (\n            <div className=\"text-center\">\n                {this.state.errors.map((err, index) => {\n                    if (!err) return;\n                    return (\n                        <ErrorAlert\n                            key={index}\n                            error={err}\n                            onClose={() =>\n                                this.setState(prev => {\n                                    const newarr = Array.from(prev.errors);\n                                    newarr[index] = undefined;\n                                    return {\n                                        errors: newarr\n                                    };\n                                })\n                            }\n                        />\n                    );\n                })}\n                <h3>\n                    <FormattedMessage id=\"routes.usercreate\" />\n                </h3>\n                <Col className=\"mx-auto\" lg={5} md={8}>\n                    <Form onSubmit={this.submitTGS}>\n                        <Form.Group controlId=\"username\">\n                            <Form.Label>\n                                <FormattedMessage id=\"login.username\" />\n                            </Form.Label>\n                            <Form.Control\n                                required\n                                onChange={handleUsernameInput}\n                                value={this.state.username}\n                            />\n                        </Form.Group>\n                        <Form.Group controlId=\"password1\">\n                            <Form.Label>\n                                <FormattedMessage id=\"login.password\" />\n                            </Form.Label>\n                            <Form.Control\n                                type=\"password\"\n                                onChange={handlePwd1Input}\n                                value={this.state.password1}\n                                isInvalid={this.state.matchError || this.state.lengthError}\n                            />\n                            <Form.Control.Feedback type=\"invalid\">\n                                {this.state.lengthError ? (\n                                    <React.Fragment>\n                                        <FormattedMessage id=\"login.password.repeat.short\" />\n                                        {this.context.serverInfo.minimumPasswordLength}\n                                    </React.Fragment>\n                                ) : (\n                                    \"\"\n                                )}\n                            </Form.Control.Feedback>\n                        </Form.Group>\n                        <Form.Group controlId=\"password2\">\n                            <Form.Label>\n                                <FormattedMessage id=\"login.password.repeat\" />\n                            </Form.Label>\n                            <Form.Control\n                                type=\"password\"\n                                onChange={handlePwd2Input}\n                                value={this.state.password2}\n                                isInvalid={this.state.matchError || this.state.lengthError}\n                            />\n                            <Form.Control.Feedback type=\"invalid\">\n                                {this.state.matchError ? (\n                                    <FormattedMessage id=\"login.password.repeat.match\" />\n                                ) : (\n                                    \"\"\n                                )}\n                            </Form.Control.Feedback>\n                        </Form.Group>\n                        <Button type=\"submit\">\n                            <FormattedMessage id=\"view.user.create.tgs\" />\n                        </Button>\n                    </Form>\n                    <hr />\n                    <Form onSubmit={this.submitSYS}>\n                        <Form.Group controlId=\"sysuser\">\n                            <Form.Label>\n                                <FormattedMessage id=\"generic.systemidentifier\" />\n                            </Form.Label>\n                            <Form.Control\n                                required\n                                onChange={handleSysuserInput}\n                                value={this.state.sysuser}\n                            />\n                        </Form.Group>\n                        <Button type=\"submit\">\n                            <FormattedMessage id=\"view.user.create.sys\" />\n                        </Button>\n                    </Form>\n                </Col>\n            </div>\n        );\n    }\n}\nUserCreate.contextType = GeneralContext;\nexport default withRouter(UserCreate);\n"],"sourceRoot":""}