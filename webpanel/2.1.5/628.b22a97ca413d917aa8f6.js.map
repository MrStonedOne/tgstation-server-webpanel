{"version":3,"sources":["webpack://tgstation-server-control-panel/./src/utils/GithubClient.ts","webpack://tgstation-server-control-panel/./src/components/views/Admin/Update.tsx"],"names":["hook","request","route","parameters","endpoint","merge","configOptions","headers","authorization","auth","type","tokenType","token","authStrategy","Object","assign","bind","apiClient","octo","Octokit","retry","throttling","userAgent","VERSION","baseUrl","throttle","onRateLimit","retryAfter","options","console","warn","method","url","retryCount","log","onAbuseLimit","payload","owner","repo","current","all","oldversions","this","paginate","repos","listReleases","response","done","data","reduce","result","release","match","exec","name","version","old","push","body","e","InternalStatus","code","StatusCode","error","InternalError","ErrorCode","jsError","TypedEmitter","Update","props","loadNotes","updateServer","state","versions","errors","loading","tasks","loadVersions","Promise","setState","timer","window","clearInterval","prevState","Array","from","adminInfo","AdminClient","addError","trackedRepositoryUrl","results","Error","versionInfo","GithubClient","getVersions","context","serverInfo","params","selectedOption","setInterval","undefined","secondsLeft","selectedVersion","ServerClient","UserClient","location","reload","updating","Loading","text","handleChange","changeEvent","target","value","timing","className","map","err","index","ErrorAlert","key","onClose","prev","newarr","Button","onClick","id","OverlayTrigger","overlay","Tooltip","show","disabled","source","Col","xs","md","InputGroup","checked","onChange","FormControl","as","htmlFor","variant","history","AppRoutes","React","contextType","GeneralContext","withRouter"],"mappings":"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","file":"628.b22a97ca413d917aa8f6.js","sourcesContent":["import { retry } from \"@octokit/plugin-retry\";\nimport { throttling } from \"@octokit/plugin-throttling\";\nimport { RequestError } from \"@octokit/request-error\";\nimport { Octokit } from \"@octokit/rest\";\nimport { TypedEmitter } from \"tiny-typed-emitter/lib\";\n\nimport InternalError, { ErrorCode } from \"../ApiClient/models/InternalComms/InternalError\";\nimport InternalStatus, { StatusCode } from \"../ApiClient/models/InternalComms/InternalStatus\";\nimport configOptions from \"../ApiClient/util/config\";\nimport { VERSION } from \"../definitions/constants\";\n\nexport interface TGSVersion {\n    version: string;\n    body: string;\n    current: boolean;\n    old: boolean;\n}\n\ninterface IEvents {}\n\n/* eslint-disable */\n\nasync function hook(request: any, route: any, parameters?: any): Promise<any> {\n    const endpoint = request.endpoint.merge(route as string, parameters);\n\n    if (configOptions.githubtoken.value) {\n        endpoint.headers.authorization = `token ${configOptions.githubtoken.value}`;\n    }\n\n    return request(endpoint);\n}\n\nasync function auth(): Promise<any> {\n    if (configOptions.githubtoken.value) {\n        return {\n            type: \"token\",\n            tokenType: \"pat\",\n            token: configOptions.githubtoken.value\n        };\n    } else {\n        return {\n            type: \"unauthenticated\"\n        };\n    }\n}\n\nconst authStrategy = () => {\n    return Object.assign(auth.bind(null), {\n        hook: hook.bind(null)\n    });\n};\n\n/* eslint-enable */\n\nconst e = new (class GithubClient extends TypedEmitter<IEvents> {\n    private readonly apiClient: Octokit;\n\n    public constructor() {\n        super();\n\n        const octo = Octokit.plugin(retry, throttling);\n\n        this.apiClient = new octo({\n            authStrategy,\n            userAgent: \"tgstation-server-control-panel/\" + VERSION,\n            baseUrl: \"https://api.github.com\",\n            throttle: {\n                onRateLimit: (\n                    retryAfter: number,\n                    options: { method: string; url: string; request: { retryCount: number } }\n                ) => {\n                    console.warn(\n                        `Request quota exhausted for request ${options.method} ${options.url}`\n                    );\n\n                    if (options.request.retryCount === 0) {\n                        // only retries once\n                        console.log(`Retrying after ${retryAfter} seconds!`);\n                        return true;\n                    }\n                    return false;\n                },\n                onAbuseLimit: (retryAfter: number, options: { method: string; url: string }) => {\n                    // does not retry, only logs a warning\n                    console.warn(`Abuse detected for request ${options.method} ${options.url}`);\n                }\n            }\n        });\n    }\n\n    public async getVersions({\n        owner,\n        repo,\n        current,\n        all\n    }: {\n        owner: string;\n        repo: string;\n        current: string;\n        all?: boolean;\n    }): Promise<InternalStatus<TGSVersion[], ErrorCode.GITHUB_FAIL>> {\n        let payload: TGSVersion[];\n        let oldversions = 0;\n        try {\n            payload = await this.apiClient.paginate(\n                this.apiClient.repos.listReleases,\n                { owner, repo },\n                (response, done) => {\n                    return response.data.reduce((result, release) => {\n                        const match = /tgstation-server-v([\\d.]+)/.exec(release.name || \"\");\n                        if (!match) return result;\n                        if (match[1][0] !== \"4\") return result;\n\n                        const version = match[1];\n                        let old = false;\n\n                        //show 3 outdated versions(2 if you count the current one)\n                        if (version <= current) {\n                            if (oldversions >= 3 && !all) {\n                                (done as () => void)();\n                                return result;\n                            }\n                            oldversions++;\n                            old = true;\n                        }\n\n                        result.push({\n                            version,\n                            body: release.body || \"\",\n                            current: version === current,\n                            old\n                        });\n                        return result;\n                    }, [] as TGSVersion[]);\n                }\n            );\n        } catch (e) {\n            return new InternalStatus<TGSVersion[], ErrorCode.GITHUB_FAIL>({\n                code: StatusCode.ERROR,\n                error: new InternalError(ErrorCode.GITHUB_FAIL, {\n                    jsError: e as RequestError\n                })\n            });\n        }\n        return new InternalStatus({\n            code: StatusCode.OK,\n            payload\n        });\n    }\n})();\nexport default e;\n","import React, { ChangeEvent, ReactNode } from \"react\";\nimport Button from \"react-bootstrap/Button\";\nimport Col from \"react-bootstrap/Col\";\nimport FormControl from \"react-bootstrap/FormControl\";\nimport InputGroup from \"react-bootstrap/InputGroup\";\nimport OverlayTrigger from \"react-bootstrap/OverlayTrigger\";\nimport Tooltip from \"react-bootstrap/Tooltip\";\nimport { FormattedMessage } from \"react-intl\";\nimport ReactMarkdown from \"react-markdown\";\nimport { RouteComponentProps, withRouter } from \"react-router-dom\";\n\nimport AdminClient from \"../../../ApiClient/AdminClient\";\nimport InternalError, { ErrorCode } from \"../../../ApiClient/models/InternalComms/InternalError\";\nimport { StatusCode } from \"../../../ApiClient/models/InternalComms/InternalStatus\";\nimport ServerClient from \"../../../ApiClient/ServerClient\";\nimport UserClient from \"../../../ApiClient/UserClient\";\nimport { GeneralContext } from \"../../../contexts/GeneralContext\";\nimport GithubClient, { TGSVersion } from \"../../../utils/GithubClient\";\nimport { AppRoutes } from \"../../../utils/routes\";\nimport ErrorAlert from \"../../utils/ErrorAlert\";\nimport Loading from \"../../utils/Loading\";\n\ninterface IProps\n    extends RouteComponentProps<{\n        all: string;\n    }> {}\ninterface IState {\n    versions: TGSVersion[];\n    errors: Array<InternalError<ErrorCode> | undefined>;\n    loading: boolean;\n    //option is the numerical representation of the version\n    selectedOption?: string;\n    //this is the actual version\n    selectedVersion?: TGSVersion;\n    //timer used to delay the user on the release notes page\n    timer?: number | null;\n    //seconds left for the release notes page\n    secondsLeft?: number | null;\n    //redirect to home page\n    updating?: boolean;\n    //manual entry\n}\n\nclass Update extends React.Component<IProps, IState> {\n    public declare context: GeneralContext;\n\n    public constructor(props: IProps) {\n        super(props);\n\n        this.loadNotes = this.loadNotes.bind(this);\n        this.updateServer = this.updateServer.bind(this);\n\n        this.state = {\n            versions: [],\n            errors: [],\n            loading: true\n        };\n    }\n\n    public async componentDidMount(): Promise<void> {\n        const tasks = [];\n        tasks.push(this.loadVersions());\n\n        await Promise.all(tasks);\n        this.setState({\n            loading: false\n        });\n    }\n\n    public componentWillUnmount(): void {\n        if (this.state.timer) {\n            window.clearInterval(this.state.timer);\n        }\n    }\n\n    private addError(error: InternalError<ErrorCode>): void {\n        this.setState(prevState => {\n            const errors = Array.from(prevState.errors);\n            errors.push(error);\n            return {\n                errors\n            };\n        });\n    }\n\n    private async loadVersions(): Promise<void> {\n        const adminInfo = await AdminClient.getAdminInfo();\n\n        switch (adminInfo.code) {\n            case StatusCode.ERROR: {\n                return this.addError(adminInfo.error);\n            }\n            case StatusCode.OK: {\n                const url = adminInfo.payload.trackedRepositoryUrl;\n                const matcher = /https?:\\/\\/(github\\.com)\\/(.*?)\\/(.*)/;\n                const results = matcher.exec(url);\n\n                if (!results) {\n                    return this.addError(\n                        new InternalError(ErrorCode.APP_FAIL, {\n                            jsError: Error(`Unknown repository url format: ${url}`)\n                        })\n                    );\n                }\n\n                if (results[1] !== \"github.com\") {\n                    this.setState({\n                        versions: [\n                            {\n                                body: \"Updates unavailable to non github repos\",\n                                version: \"Updates unavailable to non github repos\",\n                                current: true,\n                                old: true\n                            }\n                        ]\n                    });\n                    return;\n                }\n\n                const versionInfo = await GithubClient.getVersions({\n                    owner: results[2],\n                    repo: results[3],\n                    current: this.context.serverInfo.version,\n                    all: !!this.props.match.params.all\n                });\n                console.log(\"Version info: \", versionInfo);\n                switch (versionInfo.code) {\n                    case StatusCode.ERROR: {\n                        return this.addError(versionInfo.error);\n                    }\n                    case StatusCode.OK: {\n                        this.setState({\n                            versions: versionInfo.payload\n                        });\n                    }\n                }\n            }\n        }\n    }\n\n    private loadNotes(): void {\n        for (const version of this.state.versions) {\n            if (version.version !== this.state.selectedOption) continue;\n\n            const timer = window.setInterval(() => {\n                this.setState(prevState => {\n                    if (prevState.secondsLeft === undefined || prevState.secondsLeft === null)\n                        return prevState;\n                    //clear the timer if we are ticking the last tick\n                    if (prevState.secondsLeft === 1) {\n                        window.clearInterval(prevState.timer!);\n                        return {\n                            timer: null,\n                            secondsLeft: null\n                        } as IState;\n                    }\n\n                    return {\n                        secondsLeft: prevState.secondsLeft - 1\n                    } as IState;\n                });\n            }, 1000);\n\n            this.setState({\n                selectedVersion: version,\n                timer: timer,\n                secondsLeft: 10\n            });\n            return;\n        }\n    }\n\n    private async updateServer(): Promise<void> {\n        if (!this.state.selectedOption) {\n            console.error(\"Attempted to update server to a no version\");\n            this.setState({\n                selectedVersion: undefined\n            });\n            return;\n        }\n        const response = await AdminClient.updateServer(this.state.selectedOption);\n\n        switch (response.code) {\n            case StatusCode.ERROR: {\n                this.addError(response.error);\n                break;\n            }\n            case StatusCode.OK: {\n                ServerClient.autoLogin = false;\n                // i need that timer to be async\n                // eslint-disable-next-line @typescript-eslint/no-misused-promises\n                window.setInterval(async () => {\n                    const response = await UserClient.getCurrentUser(true);\n                    switch (response.code) {\n                        //we wait until we get an error which means either it rebooted and our creds are bullshit, or we rebooted and the api is different\n                        //in both cases, we should reboot\n                        case StatusCode.ERROR: {\n                            window.location.reload();\n                        }\n                    }\n                }, 2000);\n                this.setState({\n                    updating: true\n                });\n            }\n        }\n    }\n\n    public render(): ReactNode {\n        if (this.state.updating) {\n            return <Loading text=\"loading.updating\" />;\n        }\n        if (this.state.loading) {\n            return <Loading text=\"loading.version\" />;\n        }\n        const handleChange = (changeEvent: ChangeEvent<HTMLInputElement>) => {\n            this.setState({\n                selectedOption: changeEvent.target.value\n            });\n        };\n\n        const timing = typeof this.state.secondsLeft === \"number\";\n        return (\n            <React.Fragment>\n                <div className=\"text-center\">\n                    {this.state.errors.map((err, index) => {\n                        if (!err) return;\n                        return (\n                            <ErrorAlert\n                                key={index}\n                                error={err}\n                                onClose={() =>\n                                    this.setState(prev => {\n                                        const newarr = Array.from(prev.errors);\n                                        newarr[index] = undefined;\n                                        return {\n                                            errors: newarr\n                                        };\n                                    })\n                                }\n                            />\n                        );\n                    })}\n                </div>\n                {this.state.selectedVersion ? (\n                    <React.Fragment>\n                        <div className=\"text-center\">\n                            <Button\n                                className=\"mr-3\"\n                                onClick={() => this.setState({ selectedVersion: undefined })}>\n                                <FormattedMessage id=\"generic.goback\" />\n                            </Button>\n                            <OverlayTrigger\n                                overlay={\n                                    <Tooltip id=\"timing-tooltip\">\n                                        <FormattedMessage id=\"view.admin.update.wait\" />\n                                    </Tooltip>\n                                }\n                                show={timing}>\n                                <Button onClick={this.updateServer} disabled={timing}>\n                                    <FormattedMessage id=\"generic.continue\" />\n                                    {timing ? ` [${this.state.secondsLeft as number}]` : \"\"}\n                                </Button>\n                            </OverlayTrigger>\n                            <h3>\n                                <FormattedMessage id=\"view.admin.update.releasenotes\" />\n                            </h3>\n                            <hr />\n                        </div>\n                        <ReactMarkdown source={this.state.selectedVersion.body} />\n                    </React.Fragment>\n                ) : (\n                    <div className=\"text-center\">\n                        <h3 className=\"mb-4\">\n                            <FormattedMessage id=\"view.admin.update.selectversion\" />\n                        </h3>\n                        <Col xs={8} md={6} className=\"mx-auto\">\n                            {this.state.versions.map((version, index) => {\n                                return (\n                                    <InputGroup className=\"mb-3\" key={version.version}>\n                                        <InputGroup.Prepend>\n                                            <InputGroup.Radio\n                                                id={version.version}\n                                                name=\"version\"\n                                                disabled={version.current}\n                                                value={version.version}\n                                                checked={\n                                                    this.state.selectedOption === version.version\n                                                }\n                                                onChange={handleChange}\n                                            />\n                                        </InputGroup.Prepend>\n                                        <FormControl\n                                            as={\"label\"}\n                                            htmlFor={version.version}\n                                            disabled>\n                                            {version.version}\n                                            {version.current ? (\n                                                <FormattedMessage id=\"view.admin.update.current\" />\n                                            ) : (\n                                                \"\"\n                                            )}\n                                            {index == 0 ? (\n                                                <FormattedMessage id=\"view.admin.update.latest\" />\n                                            ) : (\n                                                \"\"\n                                            )}\n                                        </FormControl>\n                                    </InputGroup>\n                                );\n                            })}\n                            <Button\n                                variant=\"link\"\n                                onClick={() => {\n                                    this.props.history.push(\n                                        (AppRoutes.admin_update.link ||\n                                            AppRoutes.admin_update.route) + \"all/\",\n                                        {\n                                            reload: true\n                                        }\n                                    );\n                                }}\n                                disabled={!!this.props.match.params.all}>\n                                <FormattedMessage id=\"view.admin.update.showall\" />\n                            </Button>\n                            <br />\n                            <Button onClick={this.loadNotes} disabled={!this.state.selectedOption}>\n                                <FormattedMessage id=\"generic.continue\" />\n                            </Button>\n                        </Col>\n                    </div>\n                )}\n            </React.Fragment>\n        );\n    }\n}\nUpdate.contextType = GeneralContext;\nexport default withRouter(Update);\n"],"sourceRoot":""}