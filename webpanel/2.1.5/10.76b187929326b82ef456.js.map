{"version":3,"sources":["webpack:///./src/utils/GithubClient.ts","webpack:///./src/components/views/Admin/Update.tsx"],"names":["hook","request","route","parameters","endpoint","merge","configOptions","githubtoken","value","headers","authorization","auth","type","tokenType","token","authStrategy","Object","assign","bind","e","apiClient","octo","Octokit","plugin","retry","throttling","userAgent","VERSION","baseUrl","throttle","onRateLimit","retryAfter","options","console","warn","method","url","retryCount","log","onAbuseLimit","payload","owner","repo","current","all","oldversions","this","paginate","repos","listReleases","response","done","data","reduce","result","release","match","exec","name","version","old","push","body","InternalStatus","code","StatusCode","ERROR","error","InternalError","ErrorCode","GITHUB_FAIL","jsError","OK","TypedEmitter","Update","props","loadNotes","updateServer","state","versions","errors","loading","tasks","loadVersions","Promise","setState","timer","window","clearInterval","prevState","Array","from","adminInfo","AdminClient","getAdminInfo","addError","trackedRepositoryUrl","results","APP_FAIL","Error","versionInfo","GithubClient","getVersions","context","serverInfo","params","selectedOption","setInterval","undefined","secondsLeft","selectedVersion","ServerClient","autoLogin","UserClient","getCurrentUser","location","reload","updating","Loading","text","handleChange","changeEvent","target","timing","Fragment","className","map","err","index","ErrorAlert","key","onClose","prev","newarr","Button","onClick","id","OverlayTrigger","overlay","Tooltip","show","disabled","source","Col","xs","md","InputGroup","Prepend","Radio","checked","onChange","FormControl","as","htmlFor","variant","history","AppRoutes","admin_update","link","React","Component","contextType","GeneralContext","withRouter"],"mappings":"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","file":"10.76b187929326b82ef456.js","sourcesContent":["import { retry } from \"@octokit/plugin-retry\";\nimport { throttling } from \"@octokit/plugin-throttling\";\nimport { RequestError } from \"@octokit/request-error\";\nimport { Octokit } from \"@octokit/rest\";\nimport { TypedEmitter } from \"tiny-typed-emitter/lib\";\n\nimport InternalError, { ErrorCode } from \"../ApiClient/models/InternalComms/InternalError\";\nimport InternalStatus, { StatusCode } from \"../ApiClient/models/InternalComms/InternalStatus\";\nimport configOptions from \"../ApiClient/util/config\";\nimport { VERSION } from \"../definitions/constants\";\n\nexport interface TGSVersion {\n    version: string;\n    body: string;\n    current: boolean;\n    old: boolean;\n}\n\ninterface IEvents {}\n\n/* eslint-disable */\n\nasync function hook(request: any, route: any, parameters?: any): Promise<any> {\n    const endpoint = request.endpoint.merge(route as string, parameters);\n\n    if (configOptions.githubtoken.value) {\n        endpoint.headers.authorization = `token ${configOptions.githubtoken.value}`;\n    }\n\n    return request(endpoint);\n}\n\nasync function auth(): Promise<any> {\n    if (configOptions.githubtoken.value) {\n        return {\n            type: \"token\",\n            tokenType: \"pat\",\n            token: configOptions.githubtoken.value\n        };\n    } else {\n        return {\n            type: \"unauthenticated\"\n        };\n    }\n}\n\nconst authStrategy = () => {\n    return Object.assign(auth.bind(null), {\n        hook: hook.bind(null)\n    });\n};\n\n/* eslint-enable */\n\nconst e = new (class GithubClient extends TypedEmitter<IEvents> {\n    private readonly apiClient: Octokit;\n\n    public constructor() {\n        super();\n\n        const octo = Octokit.plugin(retry, throttling);\n\n        this.apiClient = new octo({\n            authStrategy,\n            userAgent: \"tgstation-server-control-panel/\" + VERSION,\n            baseUrl: \"https://api.github.com\",\n            throttle: {\n                onRateLimit: (\n                    retryAfter: number,\n                    options: { method: string; url: string; request: { retryCount: number } }\n                ) => {\n                    console.warn(\n                        `Request quota exhausted for request ${options.method} ${options.url}`\n                    );\n\n                    if (options.request.retryCount === 0) {\n                        // only retries once\n                        console.log(`Retrying after ${retryAfter} seconds!`);\n                        return true;\n                    }\n                    return false;\n                },\n                onAbuseLimit: (retryAfter: number, options: { method: string; url: string }) => {\n                    // does not retry, only logs a warning\n                    console.warn(`Abuse detected for request ${options.method} ${options.url}`);\n                }\n            }\n        });\n    }\n\n    public async getVersions({\n        owner,\n        repo,\n        current,\n        all\n    }: {\n        owner: string;\n        repo: string;\n        current: string;\n        all?: boolean;\n    }): Promise<InternalStatus<TGSVersion[], ErrorCode.GITHUB_FAIL>> {\n        let payload: TGSVersion[];\n        let oldversions = 0;\n        try {\n            payload = await this.apiClient.paginate(\n                this.apiClient.repos.listReleases,\n                { owner, repo },\n                (response, done) => {\n                    return response.data.reduce((result, release) => {\n                        const match = /tgstation-server-v([\\d.]+)/.exec(release.name || \"\");\n                        if (!match) return result;\n                        if (match[1][0] !== \"4\") return result;\n\n                        const version = match[1];\n                        let old = false;\n\n                        //show 3 outdated versions(2 if you count the current one)\n                        if (version <= current) {\n                            if (oldversions >= 3 && !all) {\n                                (done as () => void)();\n                                return result;\n                            }\n                            oldversions++;\n                            old = true;\n                        }\n\n                        result.push({\n                            version,\n                            body: release.body || \"\",\n                            current: version === current,\n                            old\n                        });\n                        return result;\n                    }, [] as TGSVersion[]);\n                }\n            );\n        } catch (e) {\n            return new InternalStatus<TGSVersion[], ErrorCode.GITHUB_FAIL>({\n                code: StatusCode.ERROR,\n                error: new InternalError(ErrorCode.GITHUB_FAIL, {\n                    jsError: e as RequestError\n                })\n            });\n        }\n        return new InternalStatus({\n            code: StatusCode.OK,\n            payload\n        });\n    }\n})();\nexport default e;\n","import React, { ChangeEvent, ReactNode } from \"react\";\nimport Button from \"react-bootstrap/Button\";\nimport Col from \"react-bootstrap/Col\";\nimport FormControl from \"react-bootstrap/FormControl\";\nimport InputGroup from \"react-bootstrap/InputGroup\";\nimport OverlayTrigger from \"react-bootstrap/OverlayTrigger\";\nimport Tooltip from \"react-bootstrap/Tooltip\";\nimport { FormattedMessage } from \"react-intl\";\nimport ReactMarkdown from \"react-markdown\";\nimport { RouteComponentProps, withRouter } from \"react-router-dom\";\n\nimport AdminClient from \"../../../ApiClient/AdminClient\";\nimport InternalError, { ErrorCode } from \"../../../ApiClient/models/InternalComms/InternalError\";\nimport { StatusCode } from \"../../../ApiClient/models/InternalComms/InternalStatus\";\nimport ServerClient from \"../../../ApiClient/ServerClient\";\nimport UserClient from \"../../../ApiClient/UserClient\";\nimport { GeneralContext } from \"../../../contexts/GeneralContext\";\nimport GithubClient, { TGSVersion } from \"../../../utils/GithubClient\";\nimport { AppRoutes } from \"../../../utils/routes\";\nimport ErrorAlert from \"../../utils/ErrorAlert\";\nimport Loading from \"../../utils/Loading\";\n\ninterface IProps\n    extends RouteComponentProps<{\n        all: string;\n    }> {}\ninterface IState {\n    versions: TGSVersion[];\n    errors: Array<InternalError<ErrorCode> | undefined>;\n    loading: boolean;\n    //option is the numerical representation of the version\n    selectedOption?: string;\n    //this is the actual version\n    selectedVersion?: TGSVersion;\n    //timer used to delay the user on the release notes page\n    timer?: number | null;\n    //seconds left for the release notes page\n    secondsLeft?: number | null;\n    //redirect to home page\n    updating?: boolean;\n    //manual entry\n}\n\nclass Update extends React.Component<IProps, IState> {\n    public declare context: GeneralContext;\n\n    public constructor(props: IProps) {\n        super(props);\n\n        this.loadNotes = this.loadNotes.bind(this);\n        this.updateServer = this.updateServer.bind(this);\n\n        this.state = {\n            versions: [],\n            errors: [],\n            loading: true\n        };\n    }\n\n    public async componentDidMount(): Promise<void> {\n        const tasks = [];\n        tasks.push(this.loadVersions());\n\n        await Promise.all(tasks);\n        this.setState({\n            loading: false\n        });\n    }\n\n    public componentWillUnmount(): void {\n        if (this.state.timer) {\n            window.clearInterval(this.state.timer);\n        }\n    }\n\n    private addError(error: InternalError<ErrorCode>): void {\n        this.setState(prevState => {\n            const errors = Array.from(prevState.errors);\n            errors.push(error);\n            return {\n                errors\n            };\n        });\n    }\n\n    private async loadVersions(): Promise<void> {\n        const adminInfo = await AdminClient.getAdminInfo();\n\n        switch (adminInfo.code) {\n            case StatusCode.ERROR: {\n                return this.addError(adminInfo.error);\n            }\n            case StatusCode.OK: {\n                const url = adminInfo.payload.trackedRepositoryUrl;\n                const matcher = /https?:\\/\\/(github\\.com)\\/(.*?)\\/(.*)/;\n                const results = matcher.exec(url);\n\n                if (!results) {\n                    return this.addError(\n                        new InternalError(ErrorCode.APP_FAIL, {\n                            jsError: Error(`Unknown repository url format: ${url}`)\n                        })\n                    );\n                }\n\n                if (results[1] !== \"github.com\") {\n                    this.setState({\n                        versions: [\n                            {\n                                body: \"Updates unavailable to non github repos\",\n                                version: \"Updates unavailable to non github repos\",\n                                current: true,\n                                old: true\n                            }\n                        ]\n                    });\n                    return;\n                }\n\n                const versionInfo = await GithubClient.getVersions({\n                    owner: results[2],\n                    repo: results[3],\n                    current: this.context.serverInfo.version,\n                    all: !!this.props.match.params.all\n                });\n                console.log(\"Version info: \", versionInfo);\n                switch (versionInfo.code) {\n                    case StatusCode.ERROR: {\n                        return this.addError(versionInfo.error);\n                    }\n                    case StatusCode.OK: {\n                        this.setState({\n                            versions: versionInfo.payload\n                        });\n                    }\n                }\n            }\n        }\n    }\n\n    private loadNotes(): void {\n        for (const version of this.state.versions) {\n            if (version.version !== this.state.selectedOption) continue;\n\n            const timer = window.setInterval(() => {\n                this.setState(prevState => {\n                    if (prevState.secondsLeft === undefined || prevState.secondsLeft === null)\n                        return prevState;\n                    //clear the timer if we are ticking the last tick\n                    if (prevState.secondsLeft === 1) {\n                        window.clearInterval(prevState.timer!);\n                        return {\n                            timer: null,\n                            secondsLeft: null\n                        } as IState;\n                    }\n\n                    return {\n                        secondsLeft: prevState.secondsLeft - 1\n                    } as IState;\n                });\n            }, 1000);\n\n            this.setState({\n                selectedVersion: version,\n                timer: timer,\n                secondsLeft: 10\n            });\n            return;\n        }\n    }\n\n    private async updateServer(): Promise<void> {\n        if (!this.state.selectedOption) {\n            console.error(\"Attempted to update server to a no version\");\n            this.setState({\n                selectedVersion: undefined\n            });\n            return;\n        }\n        const response = await AdminClient.updateServer(this.state.selectedOption);\n\n        switch (response.code) {\n            case StatusCode.ERROR: {\n                this.addError(response.error);\n                break;\n            }\n            case StatusCode.OK: {\n                ServerClient.autoLogin = false;\n                // i need that timer to be async\n                // eslint-disable-next-line @typescript-eslint/no-misused-promises\n                window.setInterval(async () => {\n                    const response = await UserClient.getCurrentUser(true);\n                    switch (response.code) {\n                        //we wait until we get an error which means either it rebooted and our creds are bullshit, or we rebooted and the api is different\n                        //in both cases, we should reboot\n                        case StatusCode.ERROR: {\n                            window.location.reload();\n                        }\n                    }\n                }, 2000);\n                this.setState({\n                    updating: true\n                });\n            }\n        }\n    }\n\n    public render(): ReactNode {\n        if (this.state.updating) {\n            return <Loading text=\"loading.updating\" />;\n        }\n        if (this.state.loading) {\n            return <Loading text=\"loading.version\" />;\n        }\n        const handleChange = (changeEvent: ChangeEvent<HTMLInputElement>) => {\n            this.setState({\n                selectedOption: changeEvent.target.value\n            });\n        };\n\n        const timing = typeof this.state.secondsLeft === \"number\";\n        return (\n            <React.Fragment>\n                <div className=\"text-center\">\n                    {this.state.errors.map((err, index) => {\n                        if (!err) return;\n                        return (\n                            <ErrorAlert\n                                key={index}\n                                error={err}\n                                onClose={() =>\n                                    this.setState(prev => {\n                                        const newarr = Array.from(prev.errors);\n                                        newarr[index] = undefined;\n                                        return {\n                                            errors: newarr\n                                        };\n                                    })\n                                }\n                            />\n                        );\n                    })}\n                </div>\n                {this.state.selectedVersion ? (\n                    <React.Fragment>\n                        <div className=\"text-center\">\n                            <Button\n                                className=\"mr-3\"\n                                onClick={() => this.setState({ selectedVersion: undefined })}>\n                                <FormattedMessage id=\"generic.goback\" />\n                            </Button>\n                            <OverlayTrigger\n                                overlay={\n                                    <Tooltip id=\"timing-tooltip\">\n                                        <FormattedMessage id=\"view.admin.update.wait\" />\n                                    </Tooltip>\n                                }\n                                show={timing}>\n                                <Button onClick={this.updateServer} disabled={timing}>\n                                    <FormattedMessage id=\"generic.continue\" />\n                                    {timing ? ` [${this.state.secondsLeft as number}]` : \"\"}\n                                </Button>\n                            </OverlayTrigger>\n                            <h3>\n                                <FormattedMessage id=\"view.admin.update.releasenotes\" />\n                            </h3>\n                            <hr />\n                        </div>\n                        <ReactMarkdown source={this.state.selectedVersion.body} />\n                    </React.Fragment>\n                ) : (\n                    <div className=\"text-center\">\n                        <h3 className=\"mb-4\">\n                            <FormattedMessage id=\"view.admin.update.selectversion\" />\n                        </h3>\n                        <Col xs={8} md={6} className=\"mx-auto\">\n                            {this.state.versions.map((version, index) => {\n                                return (\n                                    <InputGroup className=\"mb-3\" key={version.version}>\n                                        <InputGroup.Prepend>\n                                            <InputGroup.Radio\n                                                id={version.version}\n                                                name=\"version\"\n                                                disabled={version.current}\n                                                value={version.version}\n                                                checked={\n                                                    this.state.selectedOption === version.version\n                                                }\n                                                onChange={handleChange}\n                                            />\n                                        </InputGroup.Prepend>\n                                        <FormControl\n                                            as={\"label\"}\n                                            htmlFor={version.version}\n                                            disabled>\n                                            {version.version}\n                                            {version.current ? (\n                                                <FormattedMessage id=\"view.admin.update.current\" />\n                                            ) : (\n                                                \"\"\n                                            )}\n                                            {index == 0 ? (\n                                                <FormattedMessage id=\"view.admin.update.latest\" />\n                                            ) : (\n                                                \"\"\n                                            )}\n                                        </FormControl>\n                                    </InputGroup>\n                                );\n                            })}\n                            <Button\n                                variant=\"link\"\n                                onClick={() => {\n                                    this.props.history.push(\n                                        (AppRoutes.admin_update.link ||\n                                            AppRoutes.admin_update.route) + \"all/\",\n                                        {\n                                            reload: true\n                                        }\n                                    );\n                                }}\n                                disabled={!!this.props.match.params.all}>\n                                <FormattedMessage id=\"view.admin.update.showall\" />\n                            </Button>\n                            <br />\n                            <Button onClick={this.loadNotes} disabled={!this.state.selectedOption}>\n                                <FormattedMessage id=\"generic.continue\" />\n                            </Button>\n                        </Col>\n                    </div>\n                )}\n            </React.Fragment>\n        );\n    }\n}\nUpdate.contextType = GeneralContext;\nexport default withRouter(Update);\n"],"sourceRoot":""}