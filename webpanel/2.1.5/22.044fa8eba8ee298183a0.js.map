{"version":3,"sources":["webpack:///./src/components/views/Instance/List.tsx"],"names":["InstanceList","props","setOnline","bind","actualid","undefined","RouteData","instanceid","parseInt","state","loading","instances","errors","error","this","setState","prevState","Array","from","push","instancelist","InstanceClient","listInstances","modifiedlist","code","StatusCode","OK","work","payload","instance","modifiedinstance","online","InstancePermissionSetClient","getCurrentInstancePermissionSet","id","then","permissionset","canAccess","ErrorCode","HTTP_ACCESS_DENIED","addError","Promise","all","sort","a","b","loadInstances","desiredState","instanceedit","editInstance","text","context","user","Error","canOnline","resolvePermissionSet","instanceManagerRights","InstanceManagerRights","SetOnline","tablecellstyling","verticalAlign","className","map","err","index","key","onClose","prev","newarr","striped","bordered","hover","variant","responsive","value","toString","style","name","moveJob","path","configurationType","onClick","disabled","renderAddInstance","history","AppRoutes","instancecode","link","route","instancehosting","instanceconfig","instancejobs","canCreate","Create","overlay","show","ref","triggerHandler","instancecreate","icon","faPlus","React","Component","contextType","UserContext","withRouter"],"mappings":"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","file":"22.044fa8eba8ee298183a0.js","sourcesContent":["import { faPlus } from \"@fortawesome/free-solid-svg-icons/faPlus\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React, { CSSProperties, ReactNode } from \"react\";\nimport Badge from \"react-bootstrap/Badge\";\nimport Button from \"react-bootstrap/Button\";\nimport OverlayTrigger from \"react-bootstrap/OverlayTrigger\";\nimport Table from \"react-bootstrap/Table\";\nimport Tooltip from \"react-bootstrap/Tooltip\";\nimport { FormattedMessage } from \"react-intl\";\nimport { RouteComponentProps, withRouter } from \"react-router-dom\";\n\nimport { InstanceManagerRights } from \"../../../ApiClient/generatedcode/_enums\";\nimport { Components } from \"../../../ApiClient/generatedcode/_generated\";\nimport InstanceClient from \"../../../ApiClient/InstanceClient\";\nimport InstancePermissionSetClient from \"../../../ApiClient/InstancePermissionSetClient\";\nimport InternalError, { ErrorCode } from \"../../../ApiClient/models/InternalComms/InternalError\";\nimport { StatusCode } from \"../../../ApiClient/models/InternalComms/InternalStatus\";\nimport { UserContext } from \"../../../contexts/UserContext\";\nimport { resolvePermissionSet } from \"../../../utils/misc\";\nimport { AppRoutes, RouteData } from \"../../../utils/routes\";\nimport ErrorAlert from \"../../utils/ErrorAlert\";\nimport Loading from \"../../utils/Loading\";\n\ntype Instance = Components.Schemas.InstanceResponse & {\n    canAccess: boolean;\n};\n\ninterface IState {\n    instances: Instance[];\n    loading?: boolean;\n    errors: Array<InternalError<ErrorCode> | undefined>;\n    //isnt directly used but is used to make react rerender when the selected insance is changed\n    instanceid?: number;\n}\ninterface IProps extends RouteComponentProps {}\n\nclass InstanceList extends React.Component<IProps, IState> {\n    public declare context: UserContext;\n\n    public constructor(props: IProps) {\n        super(props);\n\n        this.setOnline = this.setOnline.bind(this);\n\n        const actualid =\n            RouteData.instanceid !== undefined ? parseInt(RouteData.instanceid) : undefined;\n\n        this.state = {\n            loading: true,\n            instances: [],\n            errors: [],\n            instanceid: actualid\n        };\n    }\n\n    private addError(error: InternalError<ErrorCode>): void {\n        this.setState(prevState => {\n            const errors = Array.from(prevState.errors);\n            errors.push(error);\n            return {\n                errors\n            };\n        });\n    }\n\n    private async loadInstances(): Promise<void> {\n        const instancelist = await InstanceClient.listInstances();\n        const modifiedlist: Array<Instance> = [];\n\n        if (instancelist.code == StatusCode.OK) {\n            const work: Array<Promise<void>> = [];\n            for (const instance of instancelist.payload) {\n                const modifiedinstance = instance as Instance;\n                if (instance.online) {\n                    work.push(\n                        InstancePermissionSetClient.getCurrentInstancePermissionSet(\n                            instance.id\n                        ).then(permissionset => {\n                            if (permissionset.code == StatusCode.OK) {\n                                modifiedinstance.canAccess = true;\n                            } else {\n                                modifiedinstance.canAccess = false;\n                                if (permissionset.error.code !== ErrorCode.HTTP_ACCESS_DENIED) {\n                                    this.addError(permissionset.error);\n                                }\n                            }\n                            modifiedlist.push(modifiedinstance);\n                        })\n                    );\n                } else {\n                    modifiedinstance.canAccess = false;\n                    modifiedlist.push(modifiedinstance);\n                }\n            }\n\n            await Promise.all(work);\n\n            this.setState({\n                instances: modifiedlist.sort((a, b) => a.id - b.id)\n            });\n        } else {\n            this.addError(instancelist.error);\n        }\n    }\n\n    public async componentDidMount(): Promise<void> {\n        await this.loadInstances();\n\n        this.setState({\n            loading: false\n        });\n    }\n\n    private async setOnline(instance: Instance) {\n        //Yes this is desynchronized and will use the last known state of the instance\n        // to determine what state we should put it in, thats intentional, if the user clicks Set Online, it needs\n        // to be online, no matter what it previously was\n        const desiredState = !instance.online;\n        const instanceedit = await InstanceClient.editInstance(({\n            id: instance.id,\n            online: desiredState\n        } as unknown) as Components.Schemas.InstanceResponse);\n        if (instanceedit.code === StatusCode.OK) {\n            await this.loadInstances();\n        } else {\n            this.addError(instanceedit.error);\n        }\n    }\n\n    public render(): ReactNode {\n        if (this.state.loading) {\n            return <Loading text=\"loading.instance.list\" />;\n        }\n\n        if (!this.context.user) {\n            throw Error(\"InstanceList: this.context.user is null!\");\n        }\n\n        const canOnline = !!(\n            resolvePermissionSet(this.context.user).instanceManagerRights &\n            InstanceManagerRights.SetOnline\n        );\n\n        const tablecellstyling: CSSProperties = {\n            verticalAlign: \"middle\"\n        };\n\n        return (\n            <div className=\"text-center\">\n                {this.state.errors.map((err, index) => {\n                    if (!err) return;\n                    return (\n                        <ErrorAlert\n                            key={index}\n                            error={err}\n                            onClose={() =>\n                                this.setState(prev => {\n                                    const newarr = Array.from(prev.errors);\n                                    newarr[index] = undefined;\n                                    return {\n                                        errors: newarr\n                                    };\n                                })\n                            }\n                        />\n                    );\n                })}\n                <h3>\n                    <FormattedMessage id=\"view.instance.list.title\" />\n                </h3>\n                <Table striped bordered hover variant=\"dark\" responsive className=\"mb-4\">\n                    <thead>\n                        <tr>\n                            <th>#</th>\n                            <th>\n                                <FormattedMessage id=\"generic.name\" />\n                            </th>\n                            <th>\n                                <FormattedMessage id=\"generic.online\" />\n                            </th>\n                            <th>\n                                <FormattedMessage id=\"generic.path\" />\n                            </th>\n                            <th>\n                                <FormattedMessage id=\"generic.configmode\" />\n                            </th>\n                            <th>\n                                <FormattedMessage id=\"generic.action\" />\n                            </th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {this.state.instances.map(value => {\n                            return (\n                                <tr\n                                    key={value.id}\n                                    className={\n                                        value.id.toString() === RouteData.instanceid\n                                            ? \"font-weight-bold\"\n                                            : \"\"\n                                    }>\n                                    <td style={tablecellstyling}>{value.id}</td>\n                                    <td style={tablecellstyling}>{value.name}</td>\n                                    <td style={tablecellstyling}>\n                                        {value.online ? (\n                                            <Badge variant=\"success\">\n                                                <FormattedMessage id=\"generic.online\" />\n                                            </Badge>\n                                        ) : (\n                                            <Badge variant=\"danger\">\n                                                <FormattedMessage id=\"generic.offline\" />\n                                            </Badge>\n                                        )}\n                                    </td>\n                                    <td style={tablecellstyling}>\n                                        {value.moveJob ? (\n                                            <FormattedMessage id=\"view.instance.moving\" />\n                                        ) : (\n                                            value.path\n                                        )}\n                                    </td>\n                                    <td style={tablecellstyling}>\n                                        <FormattedMessage\n                                            id={`view.instance.configmode.${value.configurationType.toString()}`}\n                                        />\n                                    </td>\n                                    <td className=\"align-middle p-1\" style={tablecellstyling}>\n                                        <Button\n                                            className=\"mx-1\"\n                                            variant={\n                                                value.id.toString() === RouteData.instanceid\n                                                    ? \"success\"\n                                                    : \"primary\"\n                                            }\n                                            onClick={() => {\n                                                RouteData.instanceid = value.id.toString();\n                                                this.setState({\n                                                    instanceid: value.id\n                                                });\n                                            }}\n                                            disabled={\n                                                !value.canAccess ||\n                                                value.id.toString() === RouteData.instanceid\n                                            }>\n                                            <FormattedMessage id=\"generic.select\" />\n                                        </Button>\n                                        <Button\n                                            className=\"mx-1\"\n                                            variant={value.online ? \"danger\" : \"success\"}\n                                            onClick={() => this.setOnline(value)}\n                                            disabled={!canOnline}>\n                                            <FormattedMessage\n                                                id={`view.instance.list.set.${\n                                                    value.online ? \"offline\" : \"online\"\n                                                }`}\n                                            />\n                                        </Button>\n                                    </td>\n                                </tr>\n                            );\n                        })}\n                    </tbody>\n                </Table>\n                <div className=\"align-middle\">\n                    <div className=\"mb-4\">{this.renderAddInstance()}</div>\n                    <Button\n                        className=\"mx-1\"\n                        onClick={() => {\n                            this.props.history.push(\n                                AppRoutes.instancecode.link || AppRoutes.instancecode.route\n                            );\n                        }}\n                        disabled={this.state.instanceid === undefined}>\n                        <FormattedMessage id=\"routes.instancecode\" />\n                    </Button>\n                    <Button\n                        className=\"mx-1\"\n                        onClick={() => {\n                            this.props.history.push(\n                                AppRoutes.instancehosting.link || AppRoutes.instancehosting.route\n                            );\n                        }}\n                        disabled={this.state.instanceid === undefined}>\n                        <FormattedMessage id=\"routes.instancehosting\" />\n                    </Button>\n                    <Button\n                        className=\"mx-1\"\n                        onClick={() => {\n                            this.props.history.push(\n                                AppRoutes.instanceconfig.link || AppRoutes.instanceconfig.route\n                            );\n                        }}\n                        disabled={this.state.instanceid === undefined}>\n                        <FormattedMessage id=\"routes.instanceconfig\" />\n                    </Button>\n                    <Button\n                        className=\"mx-1\"\n                        onClick={() => {\n                            this.props.history.push(\n                                AppRoutes.instancejobs.link || AppRoutes.instancejobs.route\n                            );\n                        }}\n                        disabled={this.state.instanceid === undefined}>\n                        <FormattedMessage id=\"routes.instancejobs\" />\n                    </Button>\n                </div>\n            </div>\n        );\n    }\n\n    private renderAddInstance(): React.ReactNode {\n        if (!this.context.user) {\n            throw Error(\"InstanceList2: this.context.user is null!\");\n        }\n\n        const canCreate = !!(\n            resolvePermissionSet(this.context.user).instanceManagerRights &\n            InstanceManagerRights.Create\n        );\n\n        return (\n            <OverlayTrigger\n                overlay={\n                    <Tooltip id=\"create-instance-tooltip\">\n                        <FormattedMessage id=\"perms.instance.create.warning\" />\n                    </Tooltip>\n                }\n                show={canCreate ? false : undefined}>\n                {({ ref, ...triggerHandler }) => (\n                    <Button\n                        ref={ref}\n                        className=\"mx-1\"\n                        variant=\"success\"\n                        onClick={() => {\n                            this.props.history.push(\n                                AppRoutes.instancecreate.link || AppRoutes.instancecreate.route\n                            );\n                        }}\n                        disabled={!canCreate}\n                        {...triggerHandler}>\n                        <div>\n                            <FontAwesomeIcon className=\"mr-2\" icon={faPlus} />\n                            <FormattedMessage id=\"routes.instancecreate\" />\n                        </div>\n                    </Button>\n                )}\n            </OverlayTrigger>\n        );\n    }\n}\nInstanceList.contextType = UserContext;\nexport default withRouter(InstanceList);\n"],"sourceRoot":""}