{"version":3,"sources":["webpack:///./src/components/views/Instance/Config.tsx","webpack:///./src/components/utils/WIPNotice.tsx","webpack:///./src/utils/globalObjects.ts"],"names":["InstanceConfig","props","loadInstance","bind","RouteData","instanceid","match","params","id","selectedinstanceconfigtab","tab","state","errors","loading","prevProps","this","setState","error","prevState","Array","from","push","response","InstanceClient","getInstance","parseInt","code","StatusCode","OK","instance","payload","addError","text","LoadSpin","InstanceSettings","loadable","fallback","className","map","err","index","key","onClose","prev","newarr","undefined","name","as","Link","to","AppRoutes","instancelist","link","route","activeKey","onSelect","newkey","GlobalObjects","setupMode","window","history","pushState","document","title","instanceconfig","eventKey","selfPermissionSet","resolvePermissionSet","context","user","React","Component","contextType","GeneralContext","withRouter","WIPNotice","border","Header","Body","Title","href","Text","VERSION","MODE","location","toString"],"mappings":"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","file":"6.18e886497089c9379a1e.js","sourcesContent":["import loadable from \"@loadable/component\";\nimport React from \"react\";\nimport Button from \"react-bootstrap/Button\";\nimport Tab from \"react-bootstrap/Tab\";\nimport Tabs from \"react-bootstrap/Tabs\";\nimport { FormattedMessage } from \"react-intl\";\nimport { RouteComponentProps } from \"react-router\";\nimport { Link, withRouter } from \"react-router-dom\";\n\nimport { Components } from \"../../../ApiClient/generatedcode/_generated\";\nimport InstanceClient from \"../../../ApiClient/InstanceClient\";\nimport InternalError, { ErrorCode } from \"../../../ApiClient/models/InternalComms/InternalError\";\nimport { StatusCode } from \"../../../ApiClient/models/InternalComms/InternalStatus\";\nimport { GeneralContext } from \"../../../contexts/GeneralContext\";\nimport { GlobalObjects } from \"../../../utils/globalObjects\";\nimport { resolvePermissionSet } from \"../../../utils/misc\";\nimport { AppRoutes, RouteData } from \"../../../utils/routes\";\nimport ErrorAlert from \"../../utils/ErrorAlert\";\nimport Loading from \"../../utils/Loading\";\nimport WIPNotice from \"../../utils/WIPNotice\";\n\ninterface IProps extends RouteComponentProps<{ id: string; tab?: string }> {}\n\ninterface IState {\n    instance?: Components.Schemas.InstanceResponse;\n    loading: boolean;\n    errors: Array<InternalError<ErrorCode> | undefined>;\n    tab: string;\n}\n\nclass InstanceConfig extends React.Component<IProps, IState> {\n    public declare context: GeneralContext;\n\n    public constructor(props: IProps) {\n        super(props);\n\n        this.loadInstance = this.loadInstance.bind(this);\n\n        RouteData.instanceid = props.match.params.id;\n        RouteData.selectedinstanceconfigtab = props.match.params.tab;\n\n        this.state = {\n            tab: props.match.params.tab || \"settings\",\n            errors: [],\n            loading: true\n        };\n    }\n\n    public componentDidUpdate(prevProps: Readonly<IProps>) {\n        if (prevProps.match.params.tab !== this.props.match.params.tab) {\n            this.setState({\n                tab: this.props.match.params.tab || \"settings\"\n            });\n        }\n    }\n\n    public async componentDidMount() {\n        this.setState({\n            loading: true\n        });\n\n        await this.loadInstance();\n    }\n\n    private addError(error: InternalError<ErrorCode>): void {\n        this.setState(prevState => {\n            const errors = Array.from(prevState.errors);\n            errors.push(error);\n            return {\n                errors\n            };\n        });\n    }\n\n    public async loadInstance() {\n        this.setState({\n            loading: true\n        });\n        const response = await InstanceClient.getInstance(parseInt(this.props.match.params.id));\n        if (response.code === StatusCode.OK) {\n            this.setState({\n                instance: response.payload\n            });\n        } else {\n            this.addError(response.error);\n        }\n        this.setState({\n            loading: false\n        });\n    }\n\n    public render(): React.ReactNode {\n        if (this.state.loading) {\n            return <Loading text=\"loading.instance\" />;\n        }\n\n        // noinspection DuplicatedCode\n        const changetabs = (newkey: string | null) => {\n            if (!newkey) return;\n\n            RouteData.instanceid = this.props.match.params.id;\n            RouteData.selectedinstanceconfigtab = newkey;\n            if (!GlobalObjects.setupMode) {\n                window.history.pushState(\n                    null,\n                    window.document.title,\n                    AppRoutes.instanceconfig.link || AppRoutes.instanceconfig.route\n                );\n            }\n            this.setState({\n                tab: newkey\n            });\n        };\n        const LoadSpin = <Loading text={\"loading.page\"} />;\n\n        //should always be a react component\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        const InstanceSettings = loadable(() => import(`./Config/InstanceSettings`), {\n            fallback: LoadSpin\n        });\n\n        return (\n            <div className=\"text-center\">\n                {this.state.errors.map((err, index) => {\n                    if (!err) return;\n                    return (\n                        <ErrorAlert\n                            key={index}\n                            error={err}\n                            onClose={() =>\n                                this.setState(prev => {\n                                    const newarr = Array.from(prev.errors);\n                                    newarr[index] = undefined;\n                                    return {\n                                        errors: newarr\n                                    };\n                                })\n                            }\n                        />\n                    );\n                })}\n                {this.state.instance ? (\n                    <h3>{`${this.state.instance.name} (${this.state.instance.id})`}</h3>\n                ) : (\n                    <h3>\n                        <FormattedMessage id=\"generic.assert.noinstance\" />\n                    </h3>\n                )}\n                <Button as={Link} to={AppRoutes.instancelist.link || AppRoutes.instancelist.route}>\n                    <FormattedMessage id=\"generic.goback\" />\n                </Button>\n                <Tabs\n                    className=\"justify-content-center mb-3 mt-4 flex-column flex-md-row\"\n                    activeKey={this.state.tab}\n                    onSelect={changetabs}>\n                    <Tab\n                        eventKey=\"settings\"\n                        title={<FormattedMessage id=\"view.instance.config.instancesettings\" />}>\n                        {this.state.instance ? (\n                            <InstanceSettings\n                                instance={this.state.instance}\n                                loadInstance={this.loadInstance}\n                                selfPermissionSet={resolvePermissionSet(this.context.user)}\n                            />\n                        ) : (\n                            <FormattedMessage id=\"generic.assert.noinstance\" />\n                        )}\n                    </Tab>\n                    <Tab\n                        eventKey=\"users\"\n                        title={<FormattedMessage id=\"view.instance.config.instanceusers\" />}>\n                        <WIPNotice />\n                    </Tab>\n                    <Tab\n                        eventKey=\"chatbots\"\n                        title={<FormattedMessage id=\"view.instance.config.chatbots\" />}>\n                        <WIPNotice />\n                    </Tab>\n                </Tabs>\n            </div>\n        );\n    }\n}\nInstanceConfig.contextType = GeneralContext;\nexport default withRouter(InstanceConfig);\n","import React, { ReactNode } from \"react\";\nimport Card from \"react-bootstrap/Card\";\nimport { FormattedMessage } from \"react-intl\";\n\nimport { MODE, VERSION } from \"../../definitions/constants\";\n\nexport default class WIPNotice extends React.Component {\n    public render(): ReactNode {\n        return (\n            <Card className=\"bg-transparent\" border=\"info\">\n                <Card.Header className=\"bg-info text-dark font-weight-bold\">\n                    <FormattedMessage id=\"generic.wip\" />\n                </Card.Header>\n                <Card.Body>\n                    <Card.Title>\n                        <FormattedMessage id=\"generic.wip.desc\" />\n                        <a href=\"https://github.com/tgstation/Tgstation.Server.ControlPanel/releases/latest\">\n                            https://github.com/tgstation/Tgstation.Server.ControlPanel/releases/latest\n                        </a>\n                    </Card.Title>\n                    <Card.Text as={\"pre\"} className=\"bg-transparent text-info\">\n                        <code>\n                            {`Version: ${VERSION}\\nWebpanel Mode: ${MODE}\\nCurrent route: ${window.location.toString()}`}\n                        </code>\n                    </Card.Text>\n                </Card.Body>\n            </Card>\n        );\n    }\n}\n","//this should be a proper data store thing eventually but it will do 4 now\nimport Translation from \"../translations/Translation\";\n\nexport interface GlobalObjects {\n    translation?: Translation;\n    setupMode?: boolean;\n}\n\nexport const GlobalObjects: GlobalObjects = {};\n"],"sourceRoot":""}