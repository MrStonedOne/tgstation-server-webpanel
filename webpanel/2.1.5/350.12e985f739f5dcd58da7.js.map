{"version":3,"sources":["webpack://tgstation-server-control-panel/./src/components/views/Instance/Create.tsx","webpack://tgstation-server-control-panel/./node_modules/react-bootstrap/esm/InputGroup.js"],"names":["InstanceCreate","props","context","state","loading","errors","prefix","serverInfo","validInstancePaths","length","undefined","submit","bind","error","this","setState","prevState","Array","from","push","text","className","map","err","index","key","onClose","prev","newarr","id","onSubmit","lg","md","controlId","type","onChange","event","instanceName","target","value","required","as","custom","validPath","selected","instancePath","variant","result","InstanceClient","name","path","code","StatusCode","addError","RouteData","payload","history","AppRoutes","React","contextType","GeneralContext","withRouter","InputGroupAppend","InputGroupPrepend","InputGroupText","Component","InputGroup","_ref","ref","bsPrefix","size","_ref$as","displayName","InputGroupWithExtras","Text","Radio","Checkbox","Append","Prepend"],"mappings":"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","file":"350.12e985f739f5dcd58da7.js","sourcesContent":["import React from \"react\";\nimport Button from \"react-bootstrap/Button\";\nimport Col from \"react-bootstrap/Col\";\nimport Form from \"react-bootstrap/Form\";\nimport InputGroup from \"react-bootstrap/InputGroup\";\nimport { FormattedMessage } from \"react-intl\";\nimport { RouteComponentProps, withRouter } from \"react-router-dom\";\n\nimport InstanceClient from \"../../../ApiClient/InstanceClient\";\nimport InternalError, { ErrorCode } from \"../../../ApiClient/models/InternalComms/InternalError\";\nimport { StatusCode } from \"../../../ApiClient/models/InternalComms/InternalStatus\";\nimport { GeneralContext } from \"../../../contexts/GeneralContext\";\nimport { AppRoutes, RouteData } from \"../../../utils/routes\";\nimport ErrorAlert from \"../../utils/ErrorAlert\";\nimport Loading from \"../../utils/Loading\";\n\ninterface IState {\n    loading: boolean;\n    errors: Array<InternalError<ErrorCode> | undefined>;\n    instanceName?: string;\n    instancePath?: string;\n    prefix?: string;\n}\n\ninterface IProps extends RouteComponentProps {}\n\nclass InstanceCreate extends React.Component<IProps, IState> {\n    public declare context: GeneralContext;\n    public constructor(props: IProps, context: GeneralContext) {\n        super(props);\n        this.state = {\n            loading: false,\n            errors: [],\n            prefix: context.serverInfo.validInstancePaths?.length\n                ? context.serverInfo.validInstancePaths[0]\n                : undefined\n        };\n\n        this.submit = this.submit.bind(this);\n    }\n\n    private addError(error: InternalError<ErrorCode>): void {\n        this.setState(prevState => {\n            const errors = Array.from(prevState.errors);\n            errors.push(error);\n            return {\n                errors\n            };\n        });\n    }\n\n    public render(): React.ReactNode {\n        if (this.state.loading) {\n            return <Loading text=\"view.instance.create.loading\" />;\n        }\n\n        const validInstancePaths = this.context.serverInfo.validInstancePaths;\n        return (\n            <div className=\"text-center\">\n                {this.state.errors.map((err, index) => {\n                    if (!err) return;\n                    return (\n                        <ErrorAlert\n                            key={index}\n                            error={err}\n                            onClose={() =>\n                                this.setState(prev => {\n                                    const newarr = Array.from(prev.errors);\n                                    newarr[index] = undefined;\n                                    return {\n                                        errors: newarr\n                                    };\n                                })\n                            }\n                        />\n                    );\n                })}\n                <h3>\n                    <FormattedMessage id=\"view.instance.create.title\" />\n                </h3>\n                <Form onSubmit={this.submit}>\n                    <Col className=\"mx-auto\" lg={5} md={8}>\n                        <Form.Group controlId=\"name\">\n                            <Form.Label>\n                                <h5>\n                                    <FormattedMessage id=\"view.instance.create.name\" />\n                                </h5>\n                            </Form.Label>\n                            <Form.Control\n                                type=\"text\"\n                                onChange={event => {\n                                    const instanceName = event.target.value;\n                                    this.setState({\n                                        instanceName\n                                    });\n                                }}\n                                value={this.state.instanceName}\n                                required\n                            />\n                        </Form.Group>\n                        <Form.Group controlId=\"path\">\n                            <Form.Label>\n                                <h5>\n                                    <FormattedMessage id=\"view.instance.create.path\" />\n                                </h5>\n                            </Form.Label>\n                            <InputGroup className=\"mb-1\">\n                                {validInstancePaths != null ? (\n                                    <InputGroup.Prepend className=\"flex-grow-1 flex-grow-md-0\">\n                                        <InputGroup.Text>\n                                            <span>\n                                                <FormattedMessage id=\"view.instance.create.path.prefix\" />\n                                            </span>\n                                        </InputGroup.Text>\n                                        <Form.Control\n                                            className=\"rounded-0 flex-grow-1 flex-grow-md-0 flex-shrink-0 flex-shrink-md-1 w-auto\"\n                                            as=\"select\"\n                                            custom\n                                            required\n                                            onChange={event => {\n                                                this.setState({\n                                                    prefix: event.target.value\n                                                });\n                                            }}>\n                                            {validInstancePaths.map(validPath => {\n                                                return (\n                                                    <option\n                                                        key={validPath}\n                                                        value={validPath}\n                                                        selected={this.state.prefix == validPath}>\n                                                        {validPath}/\n                                                    </option>\n                                                );\n                                            })}\n                                        </Form.Control>\n                                    </InputGroup.Prepend>\n                                ) : null}\n                                <Form.Control\n                                    type=\"text\"\n                                    className=\"flex-grow-1 w-100 w-md-auto\"\n                                    required\n                                    onChange={event => {\n                                        const instancePath = event.target.value;\n                                        this.setState({\n                                            instancePath\n                                        });\n                                    }}\n                                    value={this.state.instancePath}\n                                />\n                            </InputGroup>\n                        </Form.Group>\n                        <Button type=\"submit\" variant=\"success\">\n                            <FormattedMessage id=\"view.instance.create.submit\" />\n                        </Button>\n                    </Col>\n                </Form>\n            </div>\n        );\n    }\n\n    private async submit() {\n        //The required attribute should prevent this from ever happening but id rather not fuck over someone\n        if (!this.state.instancePath) {\n            return;\n        }\n\n        const instancePath =\n            (this.state.prefix ? this.state.prefix + \"/\" : \"\") + this.state.instancePath;\n\n        this.setState({\n            loading: true\n        });\n\n        const result = await InstanceClient.createInstance({\n            name: this.state.instanceName!,\n            path: instancePath\n        });\n\n        if (result.code === StatusCode.ERROR) {\n            this.setState({\n                loading: false\n            });\n            this.addError(result.error);\n\n            return;\n        }\n\n        RouteData.selectedinstanceid = result.payload.id;\n        this.props.history.push(AppRoutes.instancelist.link || AppRoutes.instancelist.route);\n    }\n}\nInstanceCreate.contextType = GeneralContext;\nexport default withRouter(InstanceCreate);\n","import _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport classNames from 'classnames';\nimport React from 'react';\nimport createWithBsPrefix from './createWithBsPrefix';\nimport { useBootstrapPrefix } from './ThemeProvider';\nvar InputGroupAppend = createWithBsPrefix('input-group-append');\nvar InputGroupPrepend = createWithBsPrefix('input-group-prepend');\nvar InputGroupText = createWithBsPrefix('input-group-text', {\n  Component: 'span'\n});\n\nvar InputGroupCheckbox = function InputGroupCheckbox(props) {\n  return /*#__PURE__*/React.createElement(InputGroupText, null, /*#__PURE__*/React.createElement(\"input\", _extends({\n    type: \"checkbox\"\n  }, props)));\n};\n\nvar InputGroupRadio = function InputGroupRadio(props) {\n  return /*#__PURE__*/React.createElement(InputGroupText, null, /*#__PURE__*/React.createElement(\"input\", _extends({\n    type: \"radio\"\n  }, props)));\n};\n\n/**\n *\n * @property {InputGroupAppend} Append\n * @property {InputGroupPrepend} Prepend\n * @property {InputGroupText} Text\n * @property {InputGroupRadio} Radio\n * @property {InputGroupCheckbox} Checkbox\n */\nvar InputGroup = /*#__PURE__*/React.forwardRef(function (_ref, ref) {\n  var bsPrefix = _ref.bsPrefix,\n      size = _ref.size,\n      className = _ref.className,\n      _ref$as = _ref.as,\n      Component = _ref$as === void 0 ? 'div' : _ref$as,\n      props = _objectWithoutPropertiesLoose(_ref, [\"bsPrefix\", \"size\", \"className\", \"as\"]);\n\n  bsPrefix = useBootstrapPrefix(bsPrefix, 'input-group');\n  return /*#__PURE__*/React.createElement(Component, _extends({\n    ref: ref\n  }, props, {\n    className: classNames(className, bsPrefix, size && bsPrefix + \"-\" + size)\n  }));\n});\nInputGroup.displayName = 'InputGroup';\n\nvar InputGroupWithExtras = _extends({}, InputGroup, {\n  Text: InputGroupText,\n  Radio: InputGroupRadio,\n  Checkbox: InputGroupCheckbox,\n  Append: InputGroupAppend,\n  Prepend: InputGroupPrepend\n});\n\nexport default InputGroupWithExtras;"],"sourceRoot":""}