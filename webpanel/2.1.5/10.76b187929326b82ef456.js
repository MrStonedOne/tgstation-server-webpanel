(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{365:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(37),i=n(139),c=n(226),u=n(697),s=n(121),l=n(120),f=n(75),d=n(705),p=n.n(d),v=n(13),y=n(719),h=n(5),m=n(2),b=n(9),w=n(68),g=n(65),E=n(706),O=n(707),S=n(710),k=n(82),R=n(20),j=n(21);function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=L(e);if(t){var o=L(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return C(this,n)}}function C(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function N(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){I(a,r,o,i,c,"next",e)}function c(e){I(a,r,o,i,c,"throw",e)}i(void 0)}))}}function V(e,t,n){return T.apply(this,arguments)}function T(){return(T=N((function*(e,t,n){var r=e.endpoint.merge(t,n);return R.a.githubtoken.value&&(r.headers.authorization="token ".concat(R.a.githubtoken.value)),e(r)}))).apply(this,arguments)}function U(){return q.apply(this,arguments)}function q(){return(q=N((function*(){return R.a.githubtoken.value?{type:"token",tokenType:"pat",token:R.a.githubtoken.value}:{type:"unauthenticated"}}))).apply(this,arguments)}var B=function(){return Object.assign(U.bind(null),{hook:V.bind(null)})},F=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(i,e);var t,n,r,o,a=A(i);function i(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=a.call(this)).apiClient=void 0;var t=S.a.plugin(E.a,O.a);return e.apiClient=new t({authStrategy:B,userAgent:"tgstation-server-control-panel/"+j.e,baseUrl:"https://api.github.com",throttle:{onRateLimit:function(e,t){return console.warn("Request quota exhausted for request ".concat(t.method," ").concat(t.url)),0===t.request.retryCount&&(console.log("Retrying after ".concat(e," seconds!")),!0)},onAbuseLimit:function(e,t){console.warn("Abuse detected for request ".concat(t.method," ").concat(t.url))}}}),e}return t=i,(n=[{key:"getVersions",value:(o=N((function*(e){var t,n=e.owner,r=e.repo,o=e.current,a=e.all,i=0;try{t=yield this.apiClient.paginate(this.apiClient.repos.listReleases,{owner:n,repo:r},(function(e,t){return e.data.reduce((function(e,n){var r=/tgstation-server-v([\d.]+)/.exec(n.name||"");if(!r)return e;if("4"!==r[1][0])return e;var c=r[1],u=!1;if(c<=o){if(i>=3&&!a)return t(),e;i++,u=!0}return e.push({version:c,body:n.body||"",current:c===o,old:u}),e}),[])}))}catch(e){return new m.b({code:m.a.ERROR,error:new h.c(h.b.GITHUB_FAIL,{jsError:e})})}return new m.b({code:m.a.OK,payload:t})})),function(e){return o.apply(this,arguments)})}])&&_(t.prototype,n),r&&_(t,r),i}(k.TypedEmitter)),K=n(19),J=n(54),M=n(48);function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return G(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function H(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function W(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){H(a,r,o,i,c,"next",e)}function c(e){H(a,r,o,i,c,"throw",e)}i(void 0)}))}}function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ee(e);if(t){var o=ee(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Y(this,n)}}function Y(e,t){return!t||"object"!==z(t)&&"function"!=typeof t?Z(e):t}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(O,e);var t,n,r,d,v,g,E=X(O);function O(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,O),(t=E.call(this,e)).loadNotes=t.loadNotes.bind(Z(t)),t.updateServer=t.updateServer.bind(Z(t)),t.state={versions:[],errors:[],loading:!0},t}return t=O,(n=[{key:"componentDidMount",value:(g=W((function*(){var e=[];e.push(this.loadVersions()),yield Promise.all(e),this.setState({loading:!1})})),function(){return g.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this.state.timer&&window.clearInterval(this.state.timer)}},{key:"addError",value:function(e){this.setState((function(t){var n=Array.from(t.errors);return n.push(e),{errors:n}}))}},{key:"loadVersions",value:(v=W((function*(){var e=yield y.a.getAdminInfo();switch(e.code){case m.a.ERROR:return this.addError(e.error);case m.a.OK:var t=e.payload.trackedRepositoryUrl,n=/https?:\/\/(github\.com)\/(.*?)\/(.*)/.exec(t);if(!n)return this.addError(new h.c(h.b.APP_FAIL,{jsError:Error("Unknown repository url format: ".concat(t))}));if("github.com"!==n[1])return void this.setState({versions:[{body:"Updates unavailable to non github repos",version:"Updates unavailable to non github repos",current:!0,old:!0}]});var r=yield F.getVersions({owner:n[2],repo:n[3],current:this.context.serverInfo.version,all:!!this.props.match.params.all});switch(console.log("Version info: ",r),r.code){case m.a.ERROR:return this.addError(r.error);case m.a.OK:this.setState({versions:r.payload})}}})),function(){return v.apply(this,arguments)})},{key:"loadNotes",value:function(){var e,t=this,n=D(this.state.versions);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.version===this.state.selectedOption){var o=window.setInterval((function(){t.setState((function(e){return void 0===e.secondsLeft||null===e.secondsLeft?e:1===e.secondsLeft?(window.clearInterval(e.timer),{timer:null,secondsLeft:null}):{secondsLeft:e.secondsLeft-1}}))}),1e3);return void this.setState({selectedVersion:r,timer:o,secondsLeft:10})}}}catch(e){n.e(e)}finally{n.f()}}},{key:"updateServer",value:(d=W((function*(){if(!this.state.selectedOption)return console.error("Attempted to update server to a no version"),void this.setState({selectedVersion:void 0});var e=yield y.a.updateServer(this.state.selectedOption);switch(e.code){case m.a.ERROR:this.addError(e.error);break;case m.a.OK:b.a.autoLogin=!1,window.setInterval(W((function*(){switch((yield w.a.getCurrentUser(!0)).code){case m.a.ERROR:window.location.reload()}})),2e3),this.setState({updating:!0})}})),function(){return d.apply(this,arguments)})},{key:"render",value:function(){var e=this;if(this.state.updating)return o.a.createElement(M.a,{text:"loading.updating"});if(this.state.loading)return o.a.createElement(M.a,{text:"loading.version"});var t=function(t){e.setState({selectedOption:t.target.value})},n="number"==typeof this.state.secondsLeft;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"text-center"},this.state.errors.map((function(t,n){if(t)return o.a.createElement(J.a,{key:n,error:t,onClose:function(){return e.setState((function(e){var t=Array.from(e.errors);return t[n]=void 0,{errors:t}}))}})}))),this.state.selectedVersion?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"text-center"},o.a.createElement(a.a,{className:"mr-3",onClick:function(){return e.setState({selectedVersion:void 0})}},o.a.createElement(f.a,{id:"generic.goback"})),o.a.createElement(s.a,{overlay:o.a.createElement(l.a,{id:"timing-tooltip"},o.a.createElement(f.a,{id:"view.admin.update.wait"})),show:n},o.a.createElement(a.a,{onClick:this.updateServer,disabled:n},o.a.createElement(f.a,{id:"generic.continue"}),n?" [".concat(this.state.secondsLeft,"]"):"")),o.a.createElement("h3",null,o.a.createElement(f.a,{id:"view.admin.update.releasenotes"})),o.a.createElement("hr",null)),o.a.createElement(p.a,{source:this.state.selectedVersion.body})):o.a.createElement("div",{className:"text-center"},o.a.createElement("h3",{className:"mb-4"},o.a.createElement(f.a,{id:"view.admin.update.selectversion"})),o.a.createElement(i.a,{xs:8,md:6,className:"mx-auto"},this.state.versions.map((function(n,r){return o.a.createElement(u.a,{className:"mb-3",key:n.version},o.a.createElement(u.a.Prepend,null,o.a.createElement(u.a.Radio,{id:n.version,name:"version",disabled:n.current,value:n.version,checked:e.state.selectedOption===n.version,onChange:t})),o.a.createElement(c.a,{as:"label",htmlFor:n.version,disabled:!0},n.version,n.current?o.a.createElement(f.a,{id:"view.admin.update.current"}):"",0==r?o.a.createElement(f.a,{id:"view.admin.update.latest"}):""))})),o.a.createElement(a.a,{variant:"link",onClick:function(){e.props.history.push((K.b.admin_update.link||K.b.admin_update.route)+"all/",{reload:!0})},disabled:!!this.props.match.params.all},o.a.createElement(f.a,{id:"view.admin.update.showall"})),o.a.createElement("br",null),o.a.createElement(a.a,{onClick:this.loadNotes,disabled:!this.state.selectedOption},o.a.createElement(f.a,{id:"generic.continue"})))))}}])&&$(t.prototype,n),r&&$(t,r),O}(o.a.Component);te.contextType=g.a;t.default=Object(v.f)(te)}}]);
//# sourceMappingURL=10.76b187929326b82ef456.js.map