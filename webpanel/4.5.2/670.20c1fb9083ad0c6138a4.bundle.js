"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[670],{8425:function(e,t,a){a.d(t,{t:function(){return c}});var s=a(7294),r=a(5171),n=a.n(r),i=a(7961);function l(e){return s.createElement(n(),{src:e.obj,name:"JSON",theme:"tube",iconStyle:"triangle",collapsed:!0,displayDataTypes:!1})}function c(e){return i.ZP.showjson.value?s.createElement("div",{className:"text-left"},s.createElement(l,{obj:e.obj})):s.createElement(s.Fragment,null)}},9905:function(e,t,a){a.d(t,{Z:function(){return $}});var s=a(7814),r=a(7294),n=a(5005),i=a(2258),l=a(5293),c=a(7462),o=a(3366),m=a(4184),d=a.n(m),p=a(6792),h=a(8358),u=["active","disabled","className","style","activeLabel","children"],g=["children"],E=r.forwardRef((function(e,t){var a=e.active,s=e.disabled,n=e.className,i=e.style,l=e.activeLabel,m=e.children,p=(0,o.Z)(e,u),g=a||s?"span":h.Z;return r.createElement("li",{ref:t,style:i,className:d()(n,"page-item",{active:a,disabled:s})},r.createElement(g,(0,c.Z)({className:"page-link",disabled:s},p),m,a&&l&&r.createElement("span",{className:"sr-only"},l)))}));E.defaultProps={active:!1,disabled:!1,activeLabel:"(current)"},E.displayName="PageItem";var v=E;function f(e,t,a){function s(e){var s=e.children,n=(0,o.Z)(e,g);return r.createElement(E,n,r.createElement("span",{"aria-hidden":"true"},s||t),r.createElement("span",{className:"sr-only"},a))}return void 0===a&&(a=e),s.displayName=e,s}var P=f("First","\xab"),b=f("Prev","\u2039","Previous"),Z=f("Ellipsis","\u2026","More"),y=f("Next","\u203a"),N=f("Last","\xbb"),w=["bsPrefix","className","children","size"],x=r.forwardRef((function(e,t){var a=e.bsPrefix,s=e.className,n=e.children,i=e.size,l=(0,o.Z)(e,w),m=(0,p.vE)(a,"pagination");return r.createElement("ul",(0,c.Z)({ref:t},l,{className:d()(s,m,i&&m+"-"+i)}),n)}));x.First=P,x.Prev=b,x.Ellipsis=Z,x.Item=v,x.Next=y,x.Last=N;var k=x,C=(a(5638),["as","bsPrefix","className","children"]),I=r.forwardRef((function(e,t){var a=e.as,s=void 0===a?"div":a,n=e.bsPrefix,i=e.className,l=e.children,m=(0,o.Z)(e,C);return n=(0,p.vE)(n,"popover-header"),r.createElement(s,(0,c.Z)({ref:t},m,{className:d()(n,i)}),l)})),S=["as","bsPrefix","className","children"],O=r.forwardRef((function(e,t){var a=e.as,s=void 0===a?"div":a,n=e.bsPrefix,i=e.className,l=e.children,m=(0,o.Z)(e,S);return n=(0,p.vE)(n,"popover-body"),r.createElement(s,(0,c.Z)({ref:t},m,{className:d()(i,n)}),l)})),M=["bsPrefix","placement","className","style","children","content","arrowProps","popper","show"],j=r.forwardRef((function(e,t){var a=e.bsPrefix,s=e.placement,n=e.className,i=e.style,l=e.children,m=e.content,h=e.arrowProps,u=(e.popper,e.show,(0,o.Z)(e,M)),g=(0,p.vE)(a,"popover"),E=((null==s?void 0:s.split("-"))||[])[0];return r.createElement("div",(0,c.Z)({ref:t,role:"tooltip",style:i,"x-placement":E,className:d()(n,g,E&&"bs-popover-"+E)},u),r.createElement("div",(0,c.Z)({className:"arrow"},h)),m?r.createElement(O,null,l):l)}));j.defaultProps={placement:"right"},j.Title=I,j.Content=O;var A=j,G=a(4012);function R(){return R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},R.apply(this,arguments)}class $ extends r.PureComponent{constructor(e){super(e),this.state={showGoto:!1,gotoValue:e.currentPage}}render(){const e=[],t=Math.max(this.props.totalPages-this.props.currentPage-1,0),a=Math.max(this.props.currentPage-2,0),c=Math.max(this.props.currentPage-Math.max(5-Number(this.props.currentPage!==this.props.totalPages)-t,2),2),o=Math.min(this.props.currentPage+Math.max(5-Number(1!==this.props.currentPage)-a,2),this.props.totalPages-1);for(let t=c;t<=o;t++)e.push(r.createElement(k.Item,{key:t,active:t===this.props.currentPage,onClick:()=>this.props.selectPage(t)},t));const m=this.props.totalPages>7?r.createElement(k.Ellipsis,{disabled:!0}):null,d=r.createElement(A,{id:"popover-gotopage"},r.createElement(A.Title,null,r.createElement(G.Z,{id:"generic.goto.title"})),r.createElement(A.Content,null,r.createElement("form",{className:"d-flex",onSubmit:e=>{e.preventDefault(),this.props.selectPage(this.state.gotoValue),this.setState({showGoto:!1})}},r.createElement(i.Z.Control,{className:"mr-2",type:"number",min:1,max:this.props.totalPages,value:this.state.gotoValue,onChange:e=>this.setState({gotoValue:parseInt(e.target.value)}),custom:!0}),r.createElement(n.Z,{type:"submit"},r.createElement(G.Z,{id:"generic.goto"}))))),{selectPage:p,totalPages:h,currentPage:u,...g}=this.props;return r.createElement("div",R({className:"text-center",style:{position:"sticky",bottom:"1.5em"}},g),r.createElement(k,{className:"justify-content-center"},r.createElement(k.Prev,{disabled:this.props.currentPage<=1,onClick:()=>this.props.selectPage(Math.max(this.props.currentPage-1,1))}),r.createElement(k.Item,{active:this.props.currentPage<=1,onClick:()=>this.props.selectPage(1)},"1"),m,e,m,this.props.totalPages>=2?r.createElement(k.Item,{active:this.props.currentPage>=this.props.totalPages,onClick:()=>this.props.selectPage(this.props.totalPages)},this.props.totalPages):null,this.props.totalPages>7?r.createElement(l.Z,{show:this.state.showGoto,placement:"top",overlay:d},r.createElement(k.Item,{onClick:()=>this.setState((e=>({showGoto:!e.showGoto})))},r.createElement(s.G,{icon:"search"}))):null,r.createElement(k.Next,{disabled:this.props.currentPage>=this.props.totalPages,onClick:()=>this.props.selectPage(Math.min(this.props.currentPage+1,this.props.totalPages))})))}}},670:function(e,t,a){a.r(t);var s=a(1436),r=a(98),n=a(7814),i=a(7294),l=a(7977),c=a(5005),o=a(5293),m=a(5147),d=a(3489),p=a(4012),h=a(5977),u=a(1249),g=a(8509),E=a(6352),v=a(5870),f=a(6846),P=a(3803),b=a(5631),Z=a(4615),y=a(6964),N=a(1320),w=a(3e3),x=a(8425),k=a(5855),C=a(9905);function I(){return I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},I.apply(this,arguments)}class S extends i.Component{constructor(e){super(e),this.setOnline=this.setOnline.bind(this),this.grantPermissions=this.grantPermissions.bind(this),this.state={loading:!0,instances:[],errors:[],page:N.Mq.instancelistpage??1}}addError(e){this.setState((t=>{const a=Array.from(t.errors);return a.push(e),{errors:a}}))}async componentDidUpdate(e,t){t.page!==this.state.page&&(N.Mq.instancelistpage=this.state.page,await this.loadInstances())}async loadInstances(){this.setState({loading:!0});const e=await E.Z.listInstances({page:this.state.page}),t=await b.Z.getServerInfo(),a=t.code===P.G.OK&&(0,u.satisfies)(t.payload.apiVersion,"<9.1.0"),s=[];if(e.code==P.G.OK){if(this.state.page>e.payload.totalPages&&0!==e.payload.totalPages)return void this.setState({page:1});const t=[];for(const r of e.payload.content){const e=r;a?r.online?t.push(v.Z.getCurrentInstancePermissionSet(r.id).then((t=>{t.code==P.G.OK?e.canAccess=!0:(e.canAccess=!1,t.error.code!==f.jK.HTTP_ACCESS_DENIED&&this.addError(t.error)),s.push(e)}))):(e.canAccess=!1,s.push(e)):(e.canAccess=e.online&&e.accessible,s.push(e))}await Promise.all(t),this.setState({instances:s.sort(((e,t)=>e.id-t.id)),maxPage:e.payload.totalPages})}else this.addError(e.error);this.setState({loading:!1})}async componentDidMount(){await this.loadInstances()}async grantPermissions(e){const t=await E.Z.grantPermissions({id:e.id});t.code===P.G.OK?await this.loadInstances():this.addError(t.error)}async setOnline(e){const t=!e.online;if(!t&&!confirm(`Are you sure you want to take the instance "${e.name}" offline?`))return;const a=await E.Z.editInstance({id:e.id,online:t});a.code===P.G.OK?await this.loadInstances():this.addError(a.error)}render(){if(this.state.loading)return i.createElement(k.Z,{text:"loading.instance.list"});const e=!!((0,y.Zg)(this.context.user).instanceManagerRights&g.c2.SetOnline),t=(0,y.D0)((0,y.Zg)(this.context.user),g.c2.GrantPermissions),a={verticalAlign:"middle"};return i.createElement("div",{className:"text-center"},i.createElement(x.t,{obj:this.state.instances}),this.state.errors.map(((e,t)=>{if(e)return i.createElement(w.ZP,{key:t,error:e,onClose:()=>this.setState((e=>{const a=Array.from(e.errors);return a[t]=void 0,{errors:a}}))})})),i.createElement("h3",null,i.createElement(p.Z,{id:"view.instance.list.title"})),i.createElement(m.Z,{striped:!0,bordered:!0,hover:!0,variant:"dark",responsive:!0,className:"mb-4"},i.createElement("thead",null,i.createElement("tr",null,i.createElement("th",null,"#"),i.createElement("th",null,i.createElement(p.Z,{id:"generic.name"})),i.createElement("th",null,i.createElement(p.Z,{id:"generic.online"})),i.createElement("th",null,i.createElement(p.Z,{id:"generic.path"})),i.createElement("th",null,i.createElement(p.Z,{id:"generic.configmode"})),i.createElement("th",null,i.createElement(p.Z,{id:"generic.action"})))),i.createElement("tbody",null,this.state.instances.map((r=>i.createElement("tr",{key:r.id},i.createElement("td",{style:a},r.id),i.createElement("td",{style:a},r.name),i.createElement("td",{style:a},r.online?i.createElement(l.Z,{variant:"success"},i.createElement(p.Z,{id:"generic.online"})):i.createElement(l.Z,{variant:"danger"},i.createElement(p.Z,{id:"generic.offline"}))),i.createElement("td",{style:a},r.moveJob?i.createElement(p.Z,{id:"view.instance.moving"}):r.path),i.createElement("td",{style:a},i.createElement(p.Z,{id:`view.instance.configmode.${r.configurationType.toString()}`})),i.createElement("td",{className:"align-middle p-1",style:a},!r.canAccess&&r.online?i.createElement(o.Z,{placement:"top",overlay:e=>i.createElement(d.Z,I({id:`grant-tooltop-${r.id}`},e),i.createElement(p.Z,{id:"view.instance.list.grant"+(t?"":".deny")}))},i.createElement(c.Z,{className:"mx-1",variant:"warning",onClick:()=>this.grantPermissions(r),disabled:!t},i.createElement(n.G,{icon:t?s.tAh:s.byT}))):i.createElement(i.Fragment,null),i.createElement(c.Z,{className:"mx-1",onClick:()=>{N.Mq.selectedinstanceid=r.id,this.props.history.push(N.$w.instanceedit.link??N.$w.instanceedit.route)},disabled:!r.canAccess},i.createElement(p.Z,{id:"generic.access"})),i.createElement(c.Z,{className:"mx-1",variant:r.online?"danger":"success",onClick:()=>this.setOnline(r),disabled:!e},i.createElement(p.Z,{id:"view.instance.list.set."+(r.online?"offline":"online")})))))))),i.createElement(C.Z,{selectPage:e=>this.setState({page:e}),totalPages:this.state.maxPage??1,currentPage:this.state.page}),i.createElement("div",{className:"align-middle"},i.createElement("div",{className:"mb-4"},this.renderAddInstance()),i.createElement(c.Z,{className:"mx-1",onClick:()=>{this.props.history.push(N.$w.instancejobs.link??N.$w.instancejobs.route)}},i.createElement(p.Z,{id:"routes.instancejobs"}))))}renderAddInstance(){const e=!!((0,y.Zg)(this.context.user).instanceManagerRights&g.c2.Create);return i.createElement(o.Z,{overlay:i.createElement(d.Z,{id:"create-instance-tooltip"},i.createElement(p.Z,{id:"perms.instance.create.warning"})),show:!e&&void 0},(({ref:t,...a})=>i.createElement(c.Z,I({ref:t,className:"mx-1",variant:"success",onClick:()=>{this.props.history.push(N.$w.instancecreate.link??N.$w.instancecreate.route)},disabled:!e},a),i.createElement("div",null,i.createElement(n.G,{className:"mr-2",icon:r.r8}),i.createElement(p.Z,{id:"routes.instancecreate"})))))}}S.contextType=Z.f,t.default=(0,h.EN)(S)},7977:function(e,t,a){var s=a(7462),r=a(3366),n=a(4184),i=a.n(n),l=a(7294),c=a(6792),o=["bsPrefix","variant","pill","className","as"],m=l.forwardRef((function(e,t){var a=e.bsPrefix,n=e.variant,m=e.pill,d=e.className,p=e.as,h=void 0===p?"span":p,u=(0,r.Z)(e,o),g=(0,c.vE)(a,"badge");return l.createElement(h,(0,s.Z)({ref:t},u,{className:i()(d,g,m&&g+"-pill",n&&g+"-"+n)}))}));m.displayName="Badge",m.defaultProps={pill:!1},t.Z=m},5147:function(e,t,a){var s=a(7462),r=a(3366),n=a(4184),i=a.n(n),l=a(7294),c=a(6792),o=["bsPrefix","className","striped","bordered","borderless","hover","size","variant","responsive"],m=l.forwardRef((function(e,t){var a=e.bsPrefix,n=e.className,m=e.striped,d=e.bordered,p=e.borderless,h=e.hover,u=e.size,g=e.variant,E=e.responsive,v=(0,r.Z)(e,o),f=(0,c.vE)(a,"table"),P=i()(n,f,g&&f+"-"+g,u&&f+"-"+u,m&&f+"-striped",d&&f+"-bordered",p&&f+"-borderless",h&&f+"-hover"),b=l.createElement("table",(0,s.Z)({},v,{className:P,ref:t}));if(E){var Z=f+"-responsive";return"string"==typeof E&&(Z=Z+"-"+E),l.createElement("div",{className:Z},b)}return b}));t.Z=m}}]);
//# sourceMappingURL=670.20c1fb9083ad0c6138a4.bundle.js.map