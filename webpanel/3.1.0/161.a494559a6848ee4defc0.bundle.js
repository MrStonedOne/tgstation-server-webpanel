"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[161],{9905:function(e,t,s){s.d(t,{Z:function(){return O}});var a=s(7814),r=s(7294),n=s(5005),i=s(2258),o=s(5293),l=s(7462),c=s(3366),m=s(4184),d=s.n(m),p=s(6792),h=s(8358),u=["active","disabled","className","style","activeLabel","children"],v=["children"],g=r.forwardRef((function(e,t){var s=e.active,a=e.disabled,n=e.className,i=e.style,o=e.activeLabel,m=e.children,p=(0,c.Z)(e,u),v=s||a?"span":h.Z;return r.createElement("li",{ref:t,style:i,className:d()(n,"page-item",{active:s,disabled:a})},r.createElement(v,(0,l.Z)({className:"page-link",disabled:a},p),m,s&&o&&r.createElement("span",{className:"sr-only"},o)))}));g.defaultProps={active:!1,disabled:!1,activeLabel:"(current)"},g.displayName="PageItem";var E=g;function f(e,t,s){function a(e){var a=e.children,n=(0,c.Z)(e,v);return r.createElement(g,n,r.createElement("span",{"aria-hidden":"true"},a||t),r.createElement("span",{className:"sr-only"},s))}return void 0===s&&(s=e),a.displayName=e,a}var P=f("First","\xab"),y=f("Prev","\u2039","Previous"),b=f("Ellipsis","\u2026","More"),w=f("Next","\u203a"),Z=f("Last","\xbb"),x=["bsPrefix","className","children","size"],N=r.forwardRef((function(e,t){var s=e.bsPrefix,a=e.className,n=e.children,i=e.size,o=(0,c.Z)(e,x),m=(0,p.vE)(s,"pagination");return r.createElement("ul",(0,l.Z)({ref:t},o,{className:d()(a,m,i&&m+"-"+i)}),n)}));N.First=P,N.Prev=y,N.Ellipsis=b,N.Item=E,N.Next=w,N.Last=Z;var V=N,S=(s(5638),["as","bsPrefix","className","children"]),C=r.forwardRef((function(e,t){var s=e.as,a=void 0===s?"div":s,n=e.bsPrefix,i=e.className,o=e.children,m=(0,c.Z)(e,S);return n=(0,p.vE)(n,"popover-header"),r.createElement(a,(0,l.Z)({ref:t},m,{className:d()(n,i)}),o)})),k=["as","bsPrefix","className","children"],_=r.forwardRef((function(e,t){var s=e.as,a=void 0===s?"div":s,n=e.bsPrefix,i=e.className,o=e.children,m=(0,c.Z)(e,k);return n=(0,p.vE)(n,"popover-body"),r.createElement(a,(0,l.Z)({ref:t},m,{className:d()(i,n)}),o)})),F=["bsPrefix","placement","className","style","children","content","arrowProps","popper","show"],A=r.forwardRef((function(e,t){var s=e.bsPrefix,a=e.placement,n=e.className,i=e.style,o=e.children,m=e.content,h=e.arrowProps,u=(e.popper,e.show,(0,c.Z)(e,F)),v=(0,p.vE)(s,"popover"),g=((null==a?void 0:a.split("-"))||[])[0];return r.createElement("div",(0,l.Z)({ref:t,role:"tooltip",style:i,"x-placement":g,className:d()(n,v,g&&"bs-popover-"+g)},u),r.createElement("div",(0,l.Z)({className:"arrow"},h)),m?r.createElement(_,null,o):o)}));A.defaultProps={placement:"right"},A.Title=C,A.Content=_;var G=A,I=s(4012);function M(){return M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},M.apply(this,arguments)}class O extends r.PureComponent{constructor(e){super(e),this.state={showGoto:!1,gotoValue:e.currentPage}}render(){const e=[],t=Math.max(this.props.totalPages-this.props.currentPage-1,0),s=Math.max(this.props.currentPage-2,0),l=Math.max(this.props.currentPage-Math.max(5-Number(this.props.currentPage!==this.props.totalPages)-t,2),2),c=Math.min(this.props.currentPage+Math.max(5-Number(1!==this.props.currentPage)-s,2),this.props.totalPages-1);for(let t=l;t<=c;t++)e.push(r.createElement(V.Item,{key:t,active:t===this.props.currentPage,onClick:()=>this.props.selectPage(t)},t));const m=this.props.totalPages>7?r.createElement(V.Ellipsis,{disabled:!0}):null,d=r.createElement(G,{id:"popover-gotopage"},r.createElement(G.Title,null,r.createElement(I.Z,{id:"generic.goto.title"})),r.createElement(G.Content,null,r.createElement("form",{className:"d-flex",onSubmit:e=>{e.preventDefault(),this.props.selectPage(this.state.gotoValue),this.setState({showGoto:!1})}},r.createElement(i.Z.Control,{className:"mr-2",type:"number",min:1,max:this.props.totalPages,value:this.state.gotoValue,onChange:e=>this.setState({gotoValue:parseInt(e.target.value)}),custom:!0}),r.createElement(n.Z,{type:"submit"},r.createElement(I.Z,{id:"generic.goto"}))))),{selectPage:p,totalPages:h,currentPage:u,...v}=this.props;return r.createElement("div",M({className:"text-center",style:{position:"sticky",bottom:"1.5em"}},v),r.createElement(V,{className:"justify-content-center"},r.createElement(V.Prev,{disabled:this.props.currentPage<=1,onClick:()=>this.props.selectPage(Math.max(this.props.currentPage-1,1))}),r.createElement(V.Item,{active:this.props.currentPage<=1,onClick:()=>this.props.selectPage(1)},"1"),m,e,m,this.props.totalPages>=2?r.createElement(V.Item,{active:this.props.currentPage>=this.props.totalPages,onClick:()=>this.props.selectPage(this.props.totalPages)},this.props.totalPages):null,this.props.totalPages>7?r.createElement(o.Z,{show:this.state.showGoto,placement:"top",overlay:d},r.createElement(V.Item,{onClick:()=>this.setState((e=>({showGoto:!e.showGoto})))},r.createElement(a.G,{icon:"search"}))):null,r.createElement(V.Next,{disabled:this.props.currentPage>=this.props.totalPages,onClick:()=>this.props.selectPage(Math.min(this.props.currentPage+1,this.props.totalPages))})))}}},161:function(e,t,s){s.r(t);var a=s(7814),r=s(7294),n=s(5005),i=s(2258),o=s(4716),l=s(2318),c=s(5293),m=s(3489),d=s(4012),p=s(6222),h=s(8509),u=s(6846),v=s(3803),g=s(6190),E=s(6964),f=s(1320),P=s(3e3),y=s(9635),b=s(8425),w=s(5855),Z=s(9905);function x(){return x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},x.apply(this,arguments)}class N extends r.Component{constructor(e){super(e),this.state={versions:[],errors:[],activeVersion:"",latestVersion:"",selectedVersion:"",loading:!0,page:f.Mq.byondlistpage??1}}addError(e){this.setState((t=>{const s=Array.from(t.errors);return s.push(e),{errors:s}}))}async loadVersions(){if((0,E.n5)(this.context.instancePermissionSet,h.D8.ListInstalled)){const e=await p.Z.listAllVersions(this.context.instance.id,{page:this.state.page});if(e.code===v.G.OK){if(this.state.page>e.payload.totalPages&&0!==e.payload.totalPages)return void this.setState({page:1});this.setState({versions:e.payload.content,maxPage:e.payload.totalPages})}else this.addError(e.error)}if((0,E.n5)(this.context.instancePermissionSet,h.D8.ReadActive)){const e=await p.Z.getActiveVersion(this.context.instance.id);e.code===v.G.OK?this.setState({activeVersion:e.payload.version}):this.addError(e.error)}}async componentDidUpdate(e,t){t.page!==this.state.page&&(f.Mq.byondlistpage=this.state.page,await this.loadVersions())}async componentDidMount(){await this.loadVersions(),fetch("https://secure.byond.com/download/version.txt").then((e=>e.text())).then((e=>e.split("\n"))).then((e=>e[0])).then((e=>{this.setState({latestVersion:e,selectedVersion:e,loading:!1})})).catch((e=>{this.addError(new u.ZP(u.jK.APP_FAIL,{jsError:Error(e)})),this.setState({loading:!1})}))}render(){if(this.state.loading)return r.createElement(w.Z,{text:"loading.instance"});const e=(0,E.n5)(this.context.instancePermissionSet,h.D8.ListInstalled),t=(0,E.n5)(this.context.instancePermissionSet,h.D8.ReadActive),s=(0,E.n5)(this.context.instancePermissionSet,h.D8.InstallCustomVersion),u=(0,E.n5)(this.context.instancePermissionSet,h.D8.InstallOfficialOrChangeActiveVersion),g=e=>e?r.createElement(m.Z,{id:e},r.createElement(d.Z,{id:e})):r.createElement(r.Fragment,null);return r.createElement("div",{className:"text-center"},r.createElement(b.t,{obj:this.state.versions}),r.createElement("h1",null,r.createElement(d.Z,{id:"view.instance.byond"})),this.state.errors.map(((e,t)=>{if(e)return r.createElement(P.ZP,{key:t,error:e,onClose:()=>this.setState((e=>{const s=Array.from(e.errors);return s[t]=void 0,{errors:s}}))})})),e?r.createElement(r.Fragment,null,t?null:r.createElement(y.Z,{title:"view.instance.byond.current_denied"}),r.createElement("div",{onChange:async e=>{this.setState({loading:!0});const t=await p.Z.switchActive(this.context.instance.id,e.target.value);t.code===v.G.OK?await this.loadVersions():this.addError(t.error),this.setState({loading:!1})}},this.state.versions.map((e=>r.createElement(l.Z,{className:"w-md-25 mb-1 mx-auto d-flex",key:e.version},u||t?r.createElement(l.Z.Prepend,null,r.createElement(l.Z.Radio,{name:"byond",id:e.version,value:e.version,disabled:!u,defaultChecked:e.version===this.state.activeVersion})):null,r.createElement("label",{className:"flex-grow-1 m-0",htmlFor:e.version},r.createElement(c.Z,{overlay:g("view.instance.byond.custom"),show:!e.version.endsWith(".0")&&void 0},(({ref:t,...s})=>r.createElement(l.Z.Text,x({className:"w-100"},s),e.version.endsWith(".0")?e.version.substr(0,e.version.length-2):e.version,e.version.endsWith(".0")?null:r.createElement("div",{className:"ml-auto",ref:t},r.createElement(a.G,{fixedWidth:!0,icon:"info"})))))))))),r.createElement(Z.Z,{className:"mt-4",selectPage:e=>this.setState({page:e}),totalPages:this.state.maxPage??1,currentPage:this.state.page})):t?r.createElement(r.Fragment,null,r.createElement(y.Z,{title:"view.instance.byond.list_denied"}),r.createElement(d.Z,{id:"view.instance.byond.current_version",values:{version:this.state.activeVersion}})):r.createElement(y.Z,{title:"view.instance.byond.current_and_list_denied"}),r.createElement("hr",null),r.createElement("h4",null,r.createElement(d.Z,{id:"view.instance.byond.add"})),r.createElement(l.Z,{className:"w-md-50 w-lg-25 mb-3 mx-auto"},r.createElement(o.Z,{type:"number",defaultValue:this.state.latestVersion.split(".")[0],onChange:e=>{this.setState((t=>{const s=t.selectedVersion.split(".");return s[0]=e.target.value,{selectedVersion:s.join(".")}}))}}),r.createElement(l.Z.Text,{className:"rounded-0"},"."),r.createElement(o.Z,{type:"number",defaultValue:this.state.latestVersion.split(".")[1],onChange:e=>{this.setState((t=>{const s=t.selectedVersion.split(".");return s[1]=e.target.value,{selectedVersion:s.join(".")}}))}}),r.createElement(l.Z.Append,null,r.createElement(c.Z,{overlay:g("generic.no_perm"),show:!u&&void 0},r.createElement(n.Z,{variant:u?"success":"danger",disabled:!u,onClick:async()=>{this.setState({loading:!0});const e=await p.Z.switchActive(this.context.instance.id,this.state.selectedVersion,this.state.customFile?await this.state.customFile.arrayBuffer():void 0);e.code===v.G.ERROR?this.addError(e.error):(this.setState({customFile:null}),await this.loadVersions()),this.setState({loading:!1})}},r.createElement(a.G,{icon:"plus"}))))),r.createElement(i.Z,null,r.createElement(c.Z,{overlay:g("generic.no_perm"),show:!s&&void 0},r.createElement(i.Z.File,{custom:!0,id:"test",disabled:!s,className:"w-md-50 w-lg-25 text-left",label:this.state.customFile?this.state.customFile.name:r.createElement(d.Z,{id:"view.instance.byond.upload"}),accept:".zip",onChange:e=>{this.setState({customFile:e.target.files?e.target.files[0]:null})}}))))}}N.contextType=g.g,t.default=N}}]);
//# sourceMappingURL=161.a494559a6848ee4defc0.bundle.js.map