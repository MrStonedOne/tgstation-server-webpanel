{"version":3,"sources":["webpack:///./src/ApiClient/AdminClient.ts"],"names":["_cachedAdminInfo","loadingAdminInfo","ServerClient","on","undefined","this","response","wait4Init","Promise","resolve","resolver","user","removeListener","apiClient","AdministrationController_Read","stat","res","InternalStatus","code","StatusCode","ERROR","error","emit","status","thing","OK","payload","data","errorMessage","InternalError","ErrorCode","ADMIN_GITHUB_RATE","ADMIN_GITHUB_ERROR","UNHANDLED_RESPONSE","axiosResponse","AdministrationController_Delete","ADMIN_WATCHDOG_UNAVAIL","newVersion","AdministrationController_Update","latestVersion","trackedRepositoryUrl","ADMIN_VERSION_NOT_FOUND","AdministrationController_ListLogs","pageSize","page","content","ADMIN_LOGS_IO_ERROR","logName","AdministrationController_GetLog","path","contents","TransferClient","Download","fileTicket","temp","Object","assign","ApiClient"],"mappings":"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","file":"3.fa56eebddc45eac2af97.js","sourcesContent":["import { ApiClient } from \"./_base\";\nimport { Components } from \"./generatedcode/_generated\";\nimport { DownloadedLog } from \"./models/DownloadedLog\";\nimport InternalError, { ErrorCode, GenericErrors } from \"./models/InternalComms/InternalError\";\nimport InternalStatus, { StatusCode } from \"./models/InternalComms/InternalStatus\";\nimport ServerClient from \"./ServerClient\";\nimport TransferClient, { DownloadErrors } from \"./TransferClient\";\n\ninterface IEvents {\n    loadAdminInfo: (\n        user: InternalStatus<Components.Schemas.Administration, AdminInfoErrors>\n    ) => void;\n}\n\nexport type AdminInfoErrors =\n    | GenericErrors\n    | ErrorCode.ADMIN_GITHUB_RATE\n    | ErrorCode.ADMIN_GITHUB_ERROR;\n\nexport type RestartErrors = GenericErrors | ErrorCode.ADMIN_WATCHDOG_UNAVAIL;\n\nexport type UpdateErrors =\n    | GenericErrors\n    | ErrorCode.ADMIN_WATCHDOG_UNAVAIL\n    | ErrorCode.ADMIN_VERSION_NOT_FOUND\n    | ErrorCode.ADMIN_GITHUB_RATE\n    | ErrorCode.ADMIN_GITHUB_ERROR;\n\nexport type LogsErrors = GenericErrors | ErrorCode.ADMIN_LOGS_IO_ERROR;\n\nexport type LogErrors = GenericErrors | ErrorCode.ADMIN_LOGS_IO_ERROR;\n\nexport default new (class AdminClient extends ApiClient<IEvents> {\n    private _cachedAdminInfo?: InternalStatus<Components.Schemas.Administration, ErrorCode.OK>;\n    public get cachedAdminInfo() {\n        return this._cachedAdminInfo;\n    }\n    private loadingAdminInfo = false;\n\n    public constructor() {\n        super();\n        ServerClient.on(\"purgeCache\", () => {\n            this._cachedAdminInfo = undefined;\n        });\n    }\n\n    public async getAdminInfo(): Promise<\n        InternalStatus<Components.Schemas.Administration, AdminInfoErrors>\n    > {\n        await ServerClient.wait4Init();\n        if (this._cachedAdminInfo) {\n            return this._cachedAdminInfo;\n        }\n\n        if (this.loadingAdminInfo) {\n            return await new Promise(resolve => {\n                const resolver = (\n                    user: InternalStatus<Components.Schemas.Administration, AdminInfoErrors>\n                ) => {\n                    resolve(user);\n                    this.removeListener(\"loadAdminInfo\", resolver);\n                };\n                this.on(\"loadAdminInfo\", resolver);\n            });\n        }\n\n        this.loadingAdminInfo = true;\n\n        let response;\n        try {\n            response = await ServerClient.apiClient!.AdministrationController_Read();\n        } catch (stat) {\n            const res = new InternalStatus<Components.Schemas.Administration, AdminInfoErrors>({\n                code: StatusCode.ERROR,\n                error: stat as InternalError<AdminInfoErrors>\n            });\n            this.emit(\"loadAdminInfo\", res);\n            this.loadingAdminInfo = false;\n            return res;\n        }\n\n        switch (response.status) {\n            case 200: {\n                const thing = new InternalStatus<Components.Schemas.Administration, ErrorCode.OK>({\n                    code: StatusCode.OK,\n                    payload: response.data as Components.Schemas.Administration\n                });\n\n                this._cachedAdminInfo = thing;\n                this.emit(\"loadAdminInfo\", thing);\n                this.loadingAdminInfo = false;\n                return thing;\n            }\n            case 424: {\n                const errorMessage = response.data as Components.Schemas.ErrorMessage;\n                const thing = new InternalStatus<\n                    Components.Schemas.Administration,\n                    ErrorCode.ADMIN_GITHUB_RATE\n                >({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.ADMIN_GITHUB_RATE,\n                        { errorMessage },\n                        response\n                    )\n                });\n                this.emit(\"loadAdminInfo\", thing);\n                this.loadingAdminInfo = false;\n                return thing;\n            }\n            case 429: {\n                const errorMessage = response.data as Components.Schemas.ErrorMessage;\n                const thing = new InternalStatus<\n                    Components.Schemas.Administration,\n                    ErrorCode.ADMIN_GITHUB_ERROR\n                >({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.ADMIN_GITHUB_ERROR,\n                        { errorMessage },\n                        response\n                    )\n                });\n                this.emit(\"loadAdminInfo\", thing);\n                this.loadingAdminInfo = false;\n                return thing;\n            }\n            default: {\n                const res = new InternalStatus<\n                    Components.Schemas.Administration,\n                    ErrorCode.UNHANDLED_RESPONSE\n                >({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.UNHANDLED_RESPONSE,\n                        { axiosResponse: response },\n                        response\n                    )\n                });\n                this.emit(\"loadAdminInfo\", res);\n                this.loadingAdminInfo = false;\n                return res;\n            }\n        }\n    }\n\n    public async restartServer(): Promise<InternalStatus<null, RestartErrors>> {\n        await ServerClient.wait4Init();\n\n        let response;\n        try {\n            response = await ServerClient.apiClient!.AdministrationController_Delete();\n        } catch (stat) {\n            return new InternalStatus({\n                code: StatusCode.ERROR,\n                error: stat as InternalError<RestartErrors>\n            });\n        }\n\n        switch (response.status) {\n            case 204: {\n                return new InternalStatus({ code: StatusCode.OK, payload: null });\n            }\n            case 422: {\n                const errorMessage = response.data as Components.Schemas.ErrorMessage;\n                return new InternalStatus({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.ADMIN_WATCHDOG_UNAVAIL,\n                        { errorMessage },\n                        response\n                    )\n                });\n            }\n            default: {\n                return new InternalStatus<null, ErrorCode.UNHANDLED_RESPONSE>({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.UNHANDLED_RESPONSE,\n                        { axiosResponse: response },\n                        response\n                    )\n                });\n            }\n        }\n    }\n\n    public async updateServer(newVersion: string): Promise<InternalStatus<null, UpdateErrors>> {\n        await ServerClient.wait4Init();\n\n        let response;\n        try {\n            response = await ServerClient.apiClient!.AdministrationController_Update(null, {\n                newVersion,\n                latestVersion: null,\n                trackedRepositoryUrl: null\n            });\n        } catch (stat) {\n            return new InternalStatus({\n                code: StatusCode.ERROR,\n                error: stat as InternalError<UpdateErrors>\n            });\n        }\n\n        switch (response.status) {\n            case 202: {\n                return new InternalStatus({ code: StatusCode.OK, payload: null });\n            }\n            case 410: {\n                const errorMessage = response.data as Components.Schemas.ErrorMessage;\n                return new InternalStatus({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.ADMIN_VERSION_NOT_FOUND,\n                        { errorMessage },\n                        response\n                    )\n                });\n            }\n            case 422: {\n                const errorMessage = response.data as Components.Schemas.ErrorMessage;\n                return new InternalStatus({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.ADMIN_WATCHDOG_UNAVAIL,\n                        { errorMessage },\n                        response\n                    )\n                });\n            }\n            case 424: {\n                const errorMessage = response.data as Components.Schemas.ErrorMessage;\n                return new InternalStatus<null, ErrorCode.ADMIN_GITHUB_RATE>({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.ADMIN_GITHUB_RATE,\n                        { errorMessage },\n                        response\n                    )\n                });\n            }\n            case 429: {\n                const errorMessage = response.data as Components.Schemas.ErrorMessage;\n                return new InternalStatus<null, ErrorCode.ADMIN_GITHUB_ERROR>({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.ADMIN_GITHUB_ERROR,\n                        { errorMessage },\n                        response\n                    )\n                });\n            }\n            default: {\n                return new InternalStatus<null, ErrorCode.UNHANDLED_RESPONSE>({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.UNHANDLED_RESPONSE,\n                        { axiosResponse: response },\n                        response\n                    )\n                });\n            }\n        }\n    }\n\n    public async getLogs(): Promise<InternalStatus<Components.Schemas.LogFile[], LogsErrors>> {\n        await ServerClient.wait4Init();\n\n        let response;\n        try {\n            response = await ServerClient.apiClient!.AdministrationController_ListLogs({\n                pageSize: 100,\n                page: 1\n            });\n        } catch (stat) {\n            return new InternalStatus({\n                code: StatusCode.ERROR,\n                error: stat as InternalError<LogsErrors>\n            });\n        }\n\n        switch (response.status) {\n            case 200: {\n                return new InternalStatus({\n                    code: StatusCode.OK,\n                    payload: (response.data as Components.Schemas.PaginatedLogFile)!.content\n                });\n            }\n            case 409: {\n                const errorMessage = response.data as Components.Schemas.ErrorMessage;\n                return new InternalStatus({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.ADMIN_LOGS_IO_ERROR,\n                        { errorMessage },\n                        response\n                    )\n                });\n            }\n            default: {\n                return new InternalStatus({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.UNHANDLED_RESPONSE,\n                        { axiosResponse: response },\n                        response\n                    )\n                });\n            }\n        }\n    }\n\n    public async getLog(\n        logName: string\n    ): Promise<InternalStatus<DownloadedLog, LogErrors | DownloadErrors>> {\n        await ServerClient.wait4Init();\n\n        let response;\n        try {\n            response = await ServerClient.apiClient!.AdministrationController_GetLog({\n                path: logName\n            });\n        } catch (stat) {\n            return new InternalStatus({\n                code: StatusCode.ERROR,\n                error: stat as InternalError<GenericErrors>\n            });\n        }\n        switch (response.status) {\n            case 200: {\n                const contents = await TransferClient.Download(\n                    (response.data as Components.Schemas.LogFile).fileTicket!\n                );\n                if (contents.code === StatusCode.OK) {\n                    //Object.assign() is a funky function but all it does is copy everything from the second object to the first object\n                    const temp: DownloadedLog = Object.assign(\n                        { content: contents.payload },\n                        response.data as Components.Schemas.LogFile\n                    );\n                    return new InternalStatus({\n                        code: StatusCode.OK,\n                        payload: temp\n                    });\n                } else {\n                    return new InternalStatus({\n                        code: StatusCode.ERROR,\n                        error: contents.error\n                    });\n                }\n            }\n            case 409: {\n                const errorMessage = response.data as Components.Schemas.ErrorMessage;\n                return new InternalStatus({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.ADMIN_LOGS_IO_ERROR,\n                        { errorMessage },\n                        response\n                    )\n                });\n            }\n            default: {\n                return new InternalStatus({\n                    code: StatusCode.ERROR,\n                    error: new InternalError(\n                        ErrorCode.UNHANDLED_RESPONSE,\n                        { axiosResponse: response },\n                        response\n                    )\n                });\n            }\n        }\n    }\n})();\n"],"sourceRoot":""}